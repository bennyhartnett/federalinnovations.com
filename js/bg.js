

var lh=Object.defineProperty;var ch=(i,t)=>{for(var e in t)lh(i,e,{get:t[e],enumerable:!0})};var os=class{constructor(t){this.gl=t}createTexture(t,e,s={}){let n=this.gl,{internalFormat:r=n.RGBA,format:o=n.RGBA,type:a=n.UNSIGNED_BYTE,minFilter:l=n.LINEAR,magFilter:c=n.LINEAR,wrapS:u=n.CLAMP_TO_EDGE,wrapT:h=n.CLAMP_TO_EDGE,data:p=null}=s,d=n.createTexture();return n.bindTexture(n.TEXTURE_2D,d),n.texImage2D(n.TEXTURE_2D,0,r,t,e,0,o,a,p),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,l),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,c),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,u),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,h),n.bindTexture(n.TEXTURE_2D,null),d}createFramebuffer(t){let e=this.gl,s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);let n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE)throw new Error(`Framebuffer incomplete: ${n}`);return e.bindFramebuffer(e.FRAMEBUFFER,null),s}createPingPongBuffers(t,e,s={}){let n=this.createTexture(t,e,s),r=this.createTexture(t,e,s),o=this.createFramebuffer(n),a=this.createFramebuffer(r);return{fb1:o,fb2:a,tex1:n,tex2:r}}clearFramebuffer(t,e=[0,0,0,1]){let s=this.gl,n=s.getParameter(s.FRAMEBUFFER_BINDING);s.bindFramebuffer(s.FRAMEBUFFER,t),s.clearColor(...e),s.clear(s.COLOR_BUFFER_BIT),s.bindFramebuffer(s.FRAMEBUFFER,n)}deleteFramebuffer(t,e){let s=this.gl;s.deleteFramebuffer(t),s.deleteTexture(e)}deletePingPongBuffers({fb1:t,fb2:e,tex1:s,tex2:n}){this.deleteFramebuffer(t,s),this.deleteFramebuffer(e,n)}};var as=class{constructor(t){this.gl=t,this.buffer=this.createBuffer()}createBuffer(){let t=this.gl,e=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),e}bind(t){let e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0)}render(t=null,e=0){let s=this.gl;t&&s.useProgram(t),this.bind(e),s.drawArrays(s.TRIANGLES,0,6)}destroy(){this.gl.deleteBuffer(this.buffer)}};var ls=class{constructor(t){this.gl=t,this.programCache=new Map}parseShaderSource(t){let e=[],s=[],n=/uniform\s+\w+\s+(\w+)\s*;/g,r;for(;(r=n.exec(t))!==null;)e.push(r[1]);let o=/attribute\s+\w+\s+(\w+)\s*;/g;for(;(r=o.exec(t))!==null;)s.push(r[1]);return{uniforms:e,attributes:s}}compileShader(t,e){let s=this.gl,n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){let r=s.getShaderInfoLog(n),o=e.split(`
`),a=this.extractErrorLine(r),l=`Shader compilation failed:
${r}`;throw a&&o[a-1]&&(l+=`
Line ${a}: ${o[a-1]}`),s.deleteShader(n),new Error(l)}return n}extractErrorLine(t){let e=t.match(/\d+:(\d+)/);return e?parseInt(e[1]):null}createProgram(t,e,s={}){let n=this.gl,{cache:r=!0}=s,o=r?`${t}::${e}`:null;if(r&&this.programCache.has(o))return this.programCache.get(o).program;let a=this.compileShader(n.VERTEX_SHADER,t),l=this.compileShader(n.FRAGMENT_SHADER,e),c=n.createProgram();if(n.attachShader(c,a),n.attachShader(c,l),n.linkProgram(c),!n.getProgramParameter(c,n.LINK_STATUS)){let u=n.getProgramInfoLog(c);throw n.deleteProgram(c),new Error(`Program linking failed: ${u}`)}if(n.deleteShader(a),n.deleteShader(l),r){let u={vertex:this.parseShaderSource(t),fragment:this.parseShaderSource(e)};this.programCache.set(o,{program:c,parsed:u})}return c}getAllLocations(t){let e=this.gl,s={},n=null;for(let[r,o]of this.programCache)if(o.program===t){n=o.parsed;break}if(n){let r=[...n.vertex.uniforms,...n.fragment.uniforms,...n.vertex.attributes,...n.fragment.attributes];[...new Set(r)].forEach(a=>{let l=e.getUniformLocation(t,a);if(l!==null)s[a]=l;else{let c=e.getAttribLocation(t,a);c!==-1&&(s[a]=c)}})}else{let r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let a=0;a<r;a++){let l=e.getActiveUniform(t,a);l&&(s[l.name]=e.getUniformLocation(t,l.name))}for(let a=0;a<o;a++){let l=e.getActiveAttrib(t,a);l&&(s[l.name]=e.getAttribLocation(t,l.name))}}return s}getUniformLocations(t,e){let s=this.gl,n={};return e.forEach(r=>{n[r]=s.getUniformLocation(t,r)}),n}getAttributeLocations(t,e){let s=this.gl,n={};return e.forEach(r=>{n[r]=s.getAttribLocation(t,r)}),n}setUniform(t,e,s){let n=this.gl,r=n.getUniformLocation(t,e);if(r===null){console.warn(`Uniform "${e}" not found in program`);return}if(typeof s=="number")n.uniform1f(r,s);else if(Array.isArray(s))switch(s.length){case 2:n.uniform2fv(r,s);break;case 3:n.uniform3fv(r,s);break;case 4:n.uniform4fv(r,s);break;case 16:n.uniformMatrix4fv(r,!1,s);break;default:console.warn(`Unsupported array length: ${s.length}`)}else(s instanceof Float32Array||s instanceof Int32Array)&&n.uniform1fv(r,s)}setUniforms(t,e){for(let[s,n]of Object.entries(e))this.setUniform(t,s,n)}deleteProgram(t){for(let[e,s]of this.programCache)if(s.program===t){this.programCache.delete(e);break}this.gl.deleteProgram(t)}clearCache(){this.programCache.clear()}};var Vt={particle:{vertex:`
            attribute vec2 a_position;
            attribute vec2 a_velocity;
            attribute float a_age;
            attribute float a_hueOffset;
            varying vec2 v_pos;
            varying float v_age;
            varying float v_speed;
            varying float v_hueOffset;
            uniform float u_size;

            void main() {
                gl_PointSize = u_size;
                gl_Position  = vec4(a_position, 0.0, 1.0);
                v_pos        = a_position;
                v_age        = a_age;
                v_speed      = length(a_velocity);
                v_hueOffset  = a_hueOffset;
            }
        `,fragment:`
            precision mediump float;
            varying vec2 v_pos;
            varying float v_age;
            varying float v_speed;
            varying float v_hueOffset;
            uniform float u_baseHue;
            uniform float u_hueRange;
            uniform float u_saturation;
            uniform float u_lightness;
            uniform float u_velocityBrightness;
            uniform float u_fadeOutDistance;

            vec3 hsl2rgb(vec3 hsl) {
                float h = hsl.x, s = hsl.y, l = hsl.z;
                float c = (1.0 - abs(2.0 * l - 1.0)) * s;
                float x = c * (1.0 - abs(mod(h * 6.0, 2.0) - 1.0));
                float m = l - c / 2.0;

                vec3 rgb;
                if      (h < 1.0/6.0) rgb = vec3(c, x, 0.0);
                else if (h < 2.0/6.0) rgb = vec3(x, c, 0.0);
                else if (h < 3.0/6.0) rgb = vec3(0.0, c, x);
                else if (h < 4.0/6.0) rgb = vec3(0.0, x, c);
                else if (h < 5.0/6.0) rgb = vec3(x, 0.0, c);
                else                  rgb = vec3(c, 0.0, x);

                return rgb + m;
            }

            // Add uniform for mode
            uniform float u_colorMode; // 0.0 = static, 1.0 = lifetime

            void main() {
                float dist = length(v_pos);

                float fadeIn  = smoothstep(0.0, 1.0, v_age);
                float fadeOut = smoothstep(0.0, u_fadeOutDistance, dist);
                float alpha   = fadeIn * fadeOut;

                float hue;
                if (u_colorMode < 0.5) {
                    // Static mode: random variation per particle
                    hue = u_baseHue + v_hueOffset * u_hueRange;
                } else {
                    // Lifetime mode: hue evolves over time + complementary offset
                    float lifetimeHueShift = v_age * u_hueRange;
                    float complementaryOffset = v_hueOffset < -0.6 ? 0.5 : 0.0;
                    hue = u_baseHue + lifetimeHueShift + complementaryOffset;
                }

                float speedBoost = v_speed * u_velocityBrightness;
                float brightness = u_lightness * (1.0 + speedBoost);

                vec3 color = hsl2rgb(vec3(fract(hue), u_saturation, brightness));
                gl_FragColor = vec4(color * alpha, alpha);
            }
        `},attractor:{vertex:`
            attribute vec2 a_position;
            varying vec2 v_uv;
            uniform float u_size;
            uniform vec2  u_attractorPos;
            uniform float u_aspect;

            void main() {
                v_uv = a_position;
                vec2 pos = a_position * vec2(u_size, u_size * u_aspect) + u_attractorPos;
                gl_Position = vec4(pos, 0.0, 1.0);
            }
        `,fragment:`
            precision mediump float;
            varying vec2 v_uv;

            void main() {
                float dist = length(v_uv);
                if (dist > 1.0) discard;
                gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
            }
        `},texture:{vertex:`
            attribute vec2 a_position;
            varying vec2 v_texCoord;
            void main() {
                v_texCoord = a_position * 0.5 + 0.5;
                gl_Position = vec4(a_position, 0, 1);
            }
        `,fragment:`
            precision mediump float;
            uniform sampler2D u_texture;
            varying vec2 v_texCoord;
            void main() {
                gl_FragColor = texture2D(u_texture, v_texCoord);
            }
        `},fade:{vertex:`
            attribute vec2 a_position;
            varying vec2 v_texCoord;
            void main() {
                v_texCoord = a_position * 0.5 + 0.5;
                gl_Position = vec4(a_position, 0, 1);
            }
        `,fragment:`
            precision mediump float;
            uniform sampler2D u_texture;
            uniform float u_fadeAmount;
            varying vec2 v_texCoord;
            void main() {
                vec4 color = texture2D(u_texture, v_texCoord);
                color.rgb  = max(color.rgb - u_fadeAmount, 0.0);
                gl_FragColor = color;
            }
        `}};var cs=class{constructor(t){this.gl=t,this.setupShaders(),this.mipChain=[]}setupShaders(){let t=this.gl,e=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,s=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_threshold;
      varying vec2 v_texCoord;

      void main() {
        vec4 color = texture2D(u_texture, v_texCoord);
        float brightness = max(color.r, max(color.g, color.b));
        
        // Smooth threshold with soft knee
        float soft = 0.5;
        float knee = u_threshold * soft;
        float curve = brightness - u_threshold + knee;
        curve = clamp(curve, 0.0, 2.0 * knee);
        curve = (curve * curve) / (4.0 * knee + 0.00001);
        
        float contribution = max(curve, brightness - u_threshold);
        contribution /= max(brightness, 0.00001);
        
        gl_FragColor = color * contribution;
      }
    `,n=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,r=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform vec2 u_resolution;
      uniform float u_radius;
      varying vec2 v_texCoord;

      void main() {
        vec2 texelSize = 1.0 / u_resolution;
        float offset = u_radius;
        
        // 5-tap pattern: center + 4 corners
        vec4 sum = texture2D(u_texture, v_texCoord) * 4.0;
        sum += texture2D(u_texture, v_texCoord + vec2(-offset, -offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(offset, -offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(-offset, offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(offset, offset) * texelSize);
        
        gl_FragColor = sum / 8.0;
      }
    `,o=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,a=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform vec2 u_resolution;
      uniform float u_radius;
      varying vec2 v_texCoord;

      void main() {
        vec2 texelSize = 1.0 / u_resolution;
        float offset = u_radius;
        
        // 9-tap tent filter
        vec4 sum = vec4(0.0);
        
        // Center (weight: 4)
        sum += texture2D(u_texture, v_texCoord) * 4.0;
        
        // Cardinals (weight: 2 each)
        sum += texture2D(u_texture, v_texCoord + vec2(-offset, 0.0) * texelSize) * 2.0;
        sum += texture2D(u_texture, v_texCoord + vec2(offset, 0.0) * texelSize) * 2.0;
        sum += texture2D(u_texture, v_texCoord + vec2(0.0, -offset) * texelSize) * 2.0;
        sum += texture2D(u_texture, v_texCoord + vec2(0.0, offset) * texelSize) * 2.0;
        
        // Diagonals (weight: 1 each)
        sum += texture2D(u_texture, v_texCoord + vec2(-offset, -offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(offset, -offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(-offset, offset) * texelSize);
        sum += texture2D(u_texture, v_texCoord + vec2(offset, offset) * texelSize);
        
        gl_FragColor = sum / 16.0;
      }
    `,l=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,c=`
      precision mediump float;
      uniform sampler2D u_original;
      uniform sampler2D u_bloom;
      uniform float u_intensity;
      varying vec2 v_texCoord;

      void main() {
        vec4 original = texture2D(u_original, v_texCoord);
        vec4 bloom = texture2D(u_bloom, v_texCoord);
        
        // Additive blend with intensity control
        gl_FragColor = original + bloom * u_intensity;
      }
    `;this.programs={threshold:this.createProgram(e,s),downsample:this.createProgram(n,r),upsample:this.createProgram(o,a),combine:this.createProgram(l,c)},this.uniforms={threshold:this.getUniforms(this.programs.threshold,["u_texture","u_threshold"]),downsample:this.getUniforms(this.programs.downsample,["u_texture","u_resolution","u_radius"]),upsample:this.getUniforms(this.programs.upsample,["u_texture","u_resolution","u_radius"]),combine:this.getUniforms(this.programs.combine,["u_original","u_bloom","u_intensity"])},this.quadBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}getMipChain(t,e,s){let n=this.gl,r=`${t}x${e}x${s}`;if(!this.mipChain[r]){let o=[],a=Math.floor(t/2),l=Math.floor(e/2);for(let h=0;h<s;h++){let p=this.createTexture(a,l),d=this.createFramebuffer(p);o.push({texture:p,framebuffer:d,width:a,height:l}),a=Math.max(1,Math.floor(a/2)),l=Math.max(1,Math.floor(l/2))}let c=this.createTexture(t,e),u=this.createFramebuffer(c);this.mipChain[r]={chain:o,result:{texture:c,framebuffer:u}}}return this.mipChain[r]}apply(t,e,s,n={}){let r=this.gl,o=n.intensity!==void 0?n.intensity:.8,a=n.threshold!==void 0?n.threshold:.3,l=n.radius!==void 0?n.radius:1,c=n.iterations!==void 0?n.iterations:5;if(o<=0)return t;let u=r.getParameter(r.VIEWPORT),h=r.getParameter(r.FRAMEBUFFER_BINDING);r.disable(r.BLEND);let p=this.getMipChain(e,s,c),d=p.chain,m=p.result;if(!d||d.length===0)return console.error("Bloom: Failed to create mip chain"),t;r.bindFramebuffer(r.FRAMEBUFFER,d[0].framebuffer),r.viewport(0,0,d[0].width,d[0].height),r.useProgram(this.programs.threshold),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniforms.threshold.u_texture,0),r.uniform1f(this.uniforms.threshold.u_threshold,a),this.drawQuad(this.programs.threshold),r.useProgram(this.programs.downsample);for(let v=1;v<c;v++)r.bindFramebuffer(r.FRAMEBUFFER,d[v].framebuffer),r.viewport(0,0,d[v].width,d[v].height),r.bindTexture(r.TEXTURE_2D,d[v-1].texture),r.uniform1i(this.uniforms.downsample.u_texture,0),r.uniform2f(this.uniforms.downsample.u_resolution,d[v-1].width,d[v-1].height),r.uniform1f(this.uniforms.downsample.u_radius,l),this.drawQuad(this.programs.downsample);r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE),r.useProgram(this.programs.upsample);for(let v=c-2;v>=0;v--)r.bindFramebuffer(r.FRAMEBUFFER,d[v].framebuffer),r.viewport(0,0,d[v].width,d[v].height),r.bindTexture(r.TEXTURE_2D,d[v+1].texture),r.uniform1i(this.uniforms.upsample.u_texture,0),r.uniform2f(this.uniforms.upsample.u_resolution,d[v+1].width,d[v+1].height),r.uniform1f(this.uniforms.upsample.u_radius,l),this.drawQuad(this.programs.upsample);return r.disable(r.BLEND),r.bindFramebuffer(r.FRAMEBUFFER,m.framebuffer),r.viewport(0,0,e,s),r.useProgram(this.programs.combine),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniforms.combine.u_original,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,d[0].texture),r.uniform1i(this.uniforms.combine.u_bloom,1),r.uniform1f(this.uniforms.combine.u_intensity,o),this.drawQuad(this.programs.combine),r.viewport(u[0],u[1],u[2],u[3]),r.bindFramebuffer(r.FRAMEBUFFER,h),m.texture}createTexture(t,e){let s=this.gl,n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}createFramebuffer(t){let e=this.gl,s=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),s}createProgram(t,e){let s=this.gl,n=this.compileShader(s.VERTEX_SHADER,t),r=this.compileShader(s.FRAGMENT_SHADER,e),o=s.createProgram();if(s.attachShader(o,n),s.attachShader(o,r),s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(o)||"Program link failed");return s.deleteShader(n),s.deleteShader(r),o}compileShader(t,e){let s=this.gl,n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(n)||"Shader compile failed");return n}getUniforms(t,e){let s=this.gl,n={};return e.forEach(r=>{n[r]=s.getUniformLocation(t,r)}),n}drawQuad(t){let e=this.gl,s=e.getAttribLocation(t,"a_position");e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,6)}destroy(){let t=this.gl;Object.values(this.mipChain).forEach(e=>{e.chain.forEach(s=>{t.deleteFramebuffer(s.framebuffer),t.deleteTexture(s.texture)}),e.result&&(t.deleteFramebuffer(e.result.framebuffer),t.deleteTexture(e.result.texture))}),this.mipChain=[],Object.values(this.programs).forEach(e=>{t.deleteProgram(e)}),t.deleteBuffer(this.quadBuffer)}};var us=class{constructor(t){this.gl=t,this.setupShaders(),this.fbCache=new Map}setupShaders(){let t=this.gl,e=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,s=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_intensity;
      uniform float u_radialAmount;
      uniform vec2 u_resolution;
      varying vec2 v_texCoord;

      void main() {
        vec2 center = vec2(0.5, 0.5);
        vec2 direction = v_texCoord - center;
        float distance = length(direction);
        
        // Radial falloff: more aberration at edges
        float radialFalloff = mix(1.0, distance * 2.0, u_radialAmount);
        vec2 offset = normalize(direction) * u_intensity * radialFalloff;
        
        // Sample each color channel with offset
        float r = texture2D(u_texture, v_texCoord + offset).r;
        float g = texture2D(u_texture, v_texCoord).g;
        float b = texture2D(u_texture, v_texCoord - offset).b;
        
        gl_FragColor = vec4(r, g, b, 1.0);
      }
    `;this.program=this.createProgram(e,s),this.uniforms={position:t.getAttribLocation(this.program,"a_position"),texture:t.getUniformLocation(this.program,"u_texture"),intensity:t.getUniformLocation(this.program,"u_intensity"),radialAmount:t.getUniformLocation(this.program,"u_radialAmount"),resolution:t.getUniformLocation(this.program,"u_resolution")},this.quadBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}getFramebuffer(t,e){let s=`${t}x${e}`;if(!this.fbCache.has(s)){let n=this.createTexture(t,e),r=this.createFramebuffer(n);this.fbCache.set(s,{texture:n,framebuffer:r})}return this.fbCache.get(s)}createTexture(t,e){let s=this.gl,n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}createFramebuffer(t){let e=this.gl,s=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),s}createProgram(t,e){let s=this.gl,n=this.compileShader(s.VERTEX_SHADER,t),r=this.compileShader(s.FRAGMENT_SHADER,e),o=s.createProgram();if(s.attachShader(o,n),s.attachShader(o,r),s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(o)||"Program link failed");return s.deleteShader(n),s.deleteShader(r),o}compileShader(t,e){let s=this.gl,n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(n)||"Shader compile failed");return n}apply(t,e,s,n={}){let r=this.gl,o=n.intensity!==void 0?n.intensity:.002,a=n.radialAmount!==void 0?n.radialAmount:.5;if(o<=0)return t;let l=r.getParameter(r.VIEWPORT),c=r.getParameter(r.FRAMEBUFFER_BINDING),{texture:u,framebuffer:h}=this.getFramebuffer(e,s);r.bindFramebuffer(r.FRAMEBUFFER,h);let p=r.checkFramebufferStatus(r.FRAMEBUFFER);if(p!==r.FRAMEBUFFER_COMPLETE){console.error(`Chromatic Aberration framebuffer incomplete: ${p}`);let d=`${e}x${s}`;if(this.fbCache.has(d)){let m=this.fbCache.get(d);r.deleteFramebuffer(m.framebuffer),r.deleteTexture(m.texture),this.fbCache.delete(d)}return r.bindFramebuffer(r.FRAMEBUFFER,c),t}return r.viewport(0,0,e,s),r.disable(r.BLEND),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.useProgram(this.program),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniforms.texture,0),r.uniform1f(this.uniforms.intensity,o),r.uniform1f(this.uniforms.radialAmount,a),r.uniform2f(this.uniforms.resolution,e,s),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer),r.enableVertexAttribArray(this.uniforms.position),r.vertexAttribPointer(this.uniforms.position,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,6),r.bindTexture(r.TEXTURE_2D,null),r.viewport(l[0],l[1],l[2],l[3]),r.bindFramebuffer(r.FRAMEBUFFER,c),u}invalidateCache(){let t=this.gl;for(let[e,{texture:s,framebuffer:n}]of this.fbCache)t.deleteTexture(s),t.deleteFramebuffer(n);this.fbCache.clear(),console.log("Chromatic Aberration cache invalidated")}destroy(){let t=this.gl;for(let[e,{texture:s,framebuffer:n}]of this.fbCache)t.deleteTexture(s),t.deleteFramebuffer(n);this.fbCache.clear(),t.deleteBuffer(this.quadBuffer),t.deleteProgram(this.program)}};var hs=class{constructor(t){this.gl=t,this.frameCount=0,this.setupShaders()}setupShaders(){let t=this.gl,e=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,s=`
      precision highp float;
      uniform sampler2D u_texture;
      uniform float u_intensity;
      uniform float u_size;
      uniform bool u_colored;
      uniform float u_lumaSensitivity;
      uniform float u_time;
      varying vec2 v_texCoord;

      // Hash function with time seed
      float hash(vec2 p, float seed) {
        vec3 p3 = fract(vec3(p.xyx) * 0.1031 + seed * 0.0001);
        p3 += dot(p3, p3.yzx + 33.33);
        return fract((p3.x + p3.y) * p3.z);
      }

      float noise(vec2 p, float seed) {
        vec2 i = floor(p);
        vec2 f = fract(p);
        f = f * f * (3.0 - 2.0 * f); // Smoothstep
        
        float a = hash(i, seed);
        float b = hash(i + vec2(1.0, 0.0), seed);
        float c = hash(i + vec2(0.0, 1.0), seed);
        float d = hash(i + vec2(1.0, 1.0), seed);
        
        return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
      }

      // Colored noise (RGB channels)
      vec3 coloredNoise(vec2 p, float seed) {
        return vec3(
          noise(p, seed),
          noise(p, seed + 13.57),
          noise(p, seed + 27.31)
        );
      }

      void main() {
        vec4 color = texture2D(u_texture, v_texCoord);
        
        // Calculate luminance (perceived brightness)
        float luma = dot(color.rgb, vec3(0.299, 0.587, 0.114));
        
        // Modulate grain intensity based on luminance
        // More grain in darker areas (film-accurate)
        // When lumaSensitivity = 0: uniform grain everywhere
        // When lumaSensitivity = 1: grain only in blacks, none in whites
        float lumaMod = 1.0 + (1.0 - luma) * u_lumaSensitivity;
        float grainIntensity = u_intensity * lumaMod;
        
        // Generate grain coordinates based on size
        vec2 grainCoord = v_texCoord * (1.0 / u_size) * 1000.0;
        
        // Use time as seed for animation (not coordinate offset)
        float timeSeed = floor(u_time);
        
        vec3 grain;
        if (u_colored) {
          // Colored (chromatic) grain
          grain = coloredNoise(grainCoord, timeSeed);
        } else {
          // Monochrome grain
          float grainValue = noise(grainCoord, timeSeed);
          grain = vec3(grainValue);
        }
        
        // Center grain around 0.5, then scale by intensity
        grain = (grain - 0.5) * grainIntensity;
        
        // Add grain to color and clamp to valid range
        vec3 result = clamp(color.rgb + grain, 0.0, 1.0);
        
        gl_FragColor = vec4(result, color.a);
      }
    `;this.program=this.createProgram(e,s),this.uniforms={position:t.getAttribLocation(this.program,"a_position"),texture:t.getUniformLocation(this.program,"u_texture"),intensity:t.getUniformLocation(this.program,"u_intensity"),size:t.getUniformLocation(this.program,"u_size"),colored:t.getUniformLocation(this.program,"u_colored"),lumaSensitivity:t.getUniformLocation(this.program,"u_lumaSensitivity"),time:t.getUniformLocation(this.program,"u_time")},this.quadBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),this.outputTexture=null,this.outputFramebuffer=null,this.currentWidth=0,this.currentHeight=0}createTexture(t,e){let s=this.gl,n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}createFramebuffer(t){let e=this.gl,s=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),s}ensureBufferSize(t,e){let s=this.gl;(this.currentWidth!==t||this.currentHeight!==e)&&(this.outputTexture&&s.deleteTexture(this.outputTexture),this.outputFramebuffer&&s.deleteFramebuffer(this.outputFramebuffer),this.outputTexture=this.createTexture(t,e),this.outputFramebuffer=this.createFramebuffer(this.outputTexture),this.currentWidth=t,this.currentHeight=e)}createProgram(t,e){let s=this.gl,n=this.compileShader(s.VERTEX_SHADER,t),r=this.compileShader(s.FRAGMENT_SHADER,e),o=s.createProgram();if(s.attachShader(o,n),s.attachShader(o,r),s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(o)||"Program link failed");return s.deleteShader(n),s.deleteShader(r),o}compileShader(t,e){let s=this.gl,n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(n)||"Shader compile failed");return n}apply(t,e,s,n={}){let r=this.gl,o=n.intensity!==void 0?n.intensity:.15,a=n.size!==void 0?n.size:1,l=n.colored!==void 0?n.colored:!1,c=n.animated!==void 0?n.animated:!0,u=n.lumaSensitivity!==void 0?n.lumaSensitivity:.5;if(o<=0)return t;c&&(this.frameCount++,this.frameCount>1e4&&(this.frameCount=0)),this.ensureBufferSize(e,s);let h=r.getParameter(r.VIEWPORT),p=r.getParameter(r.FRAMEBUFFER_BINDING);return r.bindFramebuffer(r.FRAMEBUFFER,this.outputFramebuffer),r.viewport(0,0,e,s),r.disable(r.BLEND),r.useProgram(this.program),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniforms.texture,0),r.uniform1f(this.uniforms.intensity,o),r.uniform1f(this.uniforms.size,a),r.uniform1i(this.uniforms.colored,l?1:0),r.uniform1f(this.uniforms.lumaSensitivity,u),r.uniform1f(this.uniforms.time,c?this.frameCount:0),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer),r.enableVertexAttribArray(this.uniforms.position),r.vertexAttribPointer(this.uniforms.position,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,6),r.viewport(h[0],h[1],h[2],h[3]),r.bindFramebuffer(r.FRAMEBUFFER,p),this.outputTexture}destroy(){let t=this.gl;this.outputTexture&&t.deleteTexture(this.outputTexture),this.outputFramebuffer&&t.deleteFramebuffer(this.outputFramebuffer),t.deleteBuffer(this.quadBuffer),t.deleteProgram(this.program)}};var ps=class{constructor(t){this.gl=t,this.setupShaders(),this.setupFramebuffers()}setupShaders(){let t=this.gl,e=`
      attribute vec2 a_position;
      varying vec2 v_texCoord;
      void main() {
        v_texCoord = a_position * 0.5 + 0.5;
        gl_Position = vec4(a_position, 0, 1);
      }
    `,s=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform vec2 u_resolution;
      uniform float u_radius;
      varying vec2 v_texCoord;

      void main() {
        vec4 sum = vec4(0.0);
        float blurSize = u_radius / u_resolution.x;
        
        // 9-tap Gaussian kernel
        sum += texture2D(u_texture, vec2(v_texCoord.x - 4.0*blurSize, v_texCoord.y)) * 0.05;
        sum += texture2D(u_texture, vec2(v_texCoord.x - 3.0*blurSize, v_texCoord.y)) * 0.09;
        sum += texture2D(u_texture, vec2(v_texCoord.x - 2.0*blurSize, v_texCoord.y)) * 0.12;
        sum += texture2D(u_texture, vec2(v_texCoord.x - blurSize, v_texCoord.y)) * 0.15;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 0.18;
        sum += texture2D(u_texture, vec2(v_texCoord.x + blurSize, v_texCoord.y)) * 0.15;
        sum += texture2D(u_texture, vec2(v_texCoord.x + 2.0*blurSize, v_texCoord.y)) * 0.12;
        sum += texture2D(u_texture, vec2(v_texCoord.x + 3.0*blurSize, v_texCoord.y)) * 0.09;
        sum += texture2D(u_texture, vec2(v_texCoord.x + 4.0*blurSize, v_texCoord.y)) * 0.05;
        
        gl_FragColor = sum;
      }
    `,n=`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform vec2 u_resolution;
      uniform float u_radius;
      varying vec2 v_texCoord;

      void main() {
        vec4 sum = vec4(0.0);
        float blurSize = u_radius / u_resolution.y;
        
        // 9-tap Gaussian kernel
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y - 4.0*blurSize)) * 0.05;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y - 3.0*blurSize)) * 0.09;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y - 2.0*blurSize)) * 0.12;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y - blurSize)) * 0.15;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 0.18;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y + blurSize)) * 0.15;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y + 2.0*blurSize)) * 0.12;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y + 3.0*blurSize)) * 0.09;
        sum += texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y + 4.0*blurSize)) * 0.05;
        
        gl_FragColor = sum;
      }
    `;this.programH=this.createProgram(e,s),this.programV=this.createProgram(e,n),this.uniformsH={position:t.getAttribLocation(this.programH,"a_position"),texture:t.getUniformLocation(this.programH,"u_texture"),resolution:t.getUniformLocation(this.programH,"u_resolution"),radius:t.getUniformLocation(this.programH,"u_radius")},this.uniformsV={position:t.getAttribLocation(this.programV,"a_position"),texture:t.getUniformLocation(this.programV,"u_texture"),resolution:t.getUniformLocation(this.programV,"u_resolution"),radius:t.getUniformLocation(this.programV,"u_radius")},this.quadBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}setupFramebuffers(){let t=this.gl;this.fbCache=new Map}getFramebuffer(t,e){let s=`${t}x${e}`;if(!this.fbCache.has(s)){let n=this.gl,r=n.createFramebuffer(),o=n.createFramebuffer(),a=this.createTexture(t,e),l=this.createTexture(t,e);n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0),this.fbCache.set(s,{fb1:r,fb2:o,tex1:a,tex2:l})}return this.fbCache.get(s)}createTexture(t,e){let s=this.gl,n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}createProgram(t,e){let s=this.gl,n=this.compileShader(s.VERTEX_SHADER,t),r=this.compileShader(s.FRAGMENT_SHADER,e),o=s.createProgram();if(s.attachShader(o,n),s.attachShader(o,r),s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(o)||"Program link failed");return o}compileShader(t,e){let s=this.gl,n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(n)||"Shader compile failed");return n}blur(t,e,s,n=2){if(n<=0)return t;let r=this.gl,{fb1:o,fb2:a,tex1:l,tex2:c}=this.getFramebuffer(e,s),u=r.getParameter(r.VIEWPORT),h=r.getParameter(r.FRAMEBUFFER_BINDING);return r.viewport(0,0,e,s),r.disable(r.BLEND),r.bindFramebuffer(r.FRAMEBUFFER,o),r.useProgram(this.programH),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniformsH.texture,0),r.uniform2f(this.uniformsH.resolution,e,s),r.uniform1f(this.uniformsH.radius,n),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer),r.enableVertexAttribArray(this.uniformsH.position),r.vertexAttribPointer(this.uniformsH.position,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,6),r.bindFramebuffer(r.FRAMEBUFFER,a),r.useProgram(this.programV),r.bindTexture(r.TEXTURE_2D,l),r.uniform1i(this.uniformsV.texture,0),r.uniform2f(this.uniformsV.resolution,e,s),r.uniform1f(this.uniformsV.radius,n),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer),r.enableVertexAttribArray(this.uniformsV.position),r.vertexAttribPointer(this.uniformsV.position,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,6),r.viewport(u[0],u[1],u[2],u[3]),r.bindFramebuffer(r.FRAMEBUFFER,h),c}destroy(){let t=this.gl;for(let[e,{fb1:s,fb2:n,tex1:r,tex2:o}]of this.fbCache)t.deleteFramebuffer(s),t.deleteFramebuffer(n),t.deleteTexture(r),t.deleteTexture(o);this.fbCache.clear(),t.deleteBuffer(this.quadBuffer),t.deleteProgram(this.programH),t.deleteProgram(this.programV)}};var Re={name:"Memento Mori",file_name:"memento_mori",version:"1.0.0",isDev:!1},ds={attractorPulseSpeed:{default:.5,min:.1,max:2,step:.1,label:"Pulse Speed",category:"Attractor"},attractorPulseAmount:{default:.3,min:0,max:1,step:.05,label:"Pulse Amount",category:"Attractor"},attractorSize:{default:.12,min:.02,max:.3,step:.01,label:"Attractor Size",category:"Attractor"},attractionStrength:{default:1e-6,min:1e-6,max:1e-4,step:1e-6,label:"Attraction Force",category:"Physics"},maxSpeed:{default:.0015,min:1e-4,max:.01,step:1e-4,label:"Max Speed",category:"Physics"},fadeOutDistance:{default:.12,min:.05,max:.3,step:.01,label:"Fade Out Distance",category:null},spawnRadius:{default:.95,min:.5,max:1.5,step:.05,label:"Spawn Radius",category:null},flowFieldStrength:{default:2e-5,min:0,max:1e-4,step:1e-6,label:"Flow Field",category:"Physics"},particleSize:{default:3.6,min:.1,max:10,step:.1,label:"Particle Size",category:"Particles",scalesWithResolution:!0},trailFade:{default:.047,min:.001,max:.1,step:.001,label:"Trail Fade",category:"Particles"},velocityBrightness:{default:2,min:.5,max:5,step:.1,label:"Velocity Brightness",category:null},spawnRandom:{default:1,min:0,max:1,step:1,label:"Random Spawn",category:"Particles",isBoolean:!0},particleColor:{default:"hsl(216, 70%, 15%)",category:"Particles",label:"Color (HSL)",onChange:(i,t)=>{let e=i.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(e){let s=parseInt(e[1]),n=parseInt(e[2]),r=parseInt(e[3]);t.baseHue=s/360,t.saturation=n/100;let o=.001,a=.1;t.lightness=o+r/100*(a-o)}}},hueRange:{default:.08,min:0,max:.3,step:.01,label:"Hue Range",category:null},colorMode:{default:"lifetime",category:"Particles",label:"Color Mode",options:{Static:"static","Lifetime Shift":"lifetime"}},baseHue:{default:.6,min:0,max:1,step:.01,label:"Base Hue",category:null},saturation:{default:.7,min:0,max:1,step:.01,label:"Saturation",category:null},lightness:{default:.015,min:.001,max:.1,step:.001,label:"Lightness",category:null},noiseScale:{default:2,min:.1,max:10,step:.1,label:"Noise Scale",category:"Noise"},noiseSpeed:{default:.1,min:0,max:2,step:.05,label:"Noise Morph Speed",category:"Noise"},bloomIntensity:{default:1.5,min:0,max:3,step:.05,label:"Glow Intensity",category:"Glow"},bloomThreshold:{default:.3,min:0,max:1,step:.05,label:"Glow Threshold",category:"Glow"},bloomRadius:{default:1.8,min:.5,max:2,step:.1,label:"Glow Softness",category:"Glow"},bloomQuality:{default:7,min:3,max:8,step:1,label:"Glow Quality",category:"Glow"},blurIntensity:{default:.4,min:0,max:2,step:.1,label:"Blur Amount",category:"Blur"},blurRadius:{default:5,min:0,max:15,step:.5,label:"Blur Radius",category:"Blur",scalesWithResolution:!0},chromaticIntensity:{default:.01,min:0,max:.02,step:1e-4,label:"Aberration Strength",category:"Chromatic Aberration"},chromaticRadial:{default:.3,min:0,max:1,step:.05,label:"Aberration Radial",category:"Chromatic Aberration"},grainIntensity:{default:.18,min:0,max:.5,step:.01,label:"Grain Intensity",category:"Film Grain"},grainSize:{default:.6,min:.2,max:1,step:.1,label:"Grain Size",category:"Film Grain"},grainColored:{default:0,min:0,max:1,step:1,label:"Colored Grain",category:"Film Grain",isBoolean:!0},grainLuma:{default:0,min:0,max:1,step:.05,label:"Grain Luma",category:"Film Grain"},backgroundColor:{default:[0,0,0,1],category:null},particleCount:{default:32e3,category:null},canvasResolutionMultiplier:{default:2,category:null},metricsInterval:{default:1e3,category:null}},ms={particleCount:12e3,particleSize:2.5,blurRadius:5,bloomQuality:5};(function(i){var t=i.noise={};function e(p,d,m){this.x=p,this.y=d,this.z=m}e.prototype.dot2=function(p,d){return this.x*p+this.y*d},e.prototype.dot3=function(p,d,m){return this.x*p+this.y*d+this.z*m};var s=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=new Array(512),o=new Array(512);t.seed=function(p){p>0&&p<1&&(p*=65536),(p=Math.floor(p))<256&&(p|=p<<8);for(var d=0;d<256;d++){var m;m=1&d?n[d]^255&p:n[d]^p>>8&255,r[d]=r[d+256]=m,o[d]=o[d+256]=s[m%12]}},t.seed(0);var a=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,c=1/6;function u(p){return p*p*p*(p*(6*p-15)+10)}function h(p,d,m){return(1-m)*p+m*d}t.simplex2=function(p,d){var m,v,E=(p+d)*a,P=Math.floor(p+E),D=Math.floor(d+E),B=(P+D)*l,U=p-P+B,it=d-D+B;U>it?(m=1,v=0):(m=0,v=1);var st=U-m+l,nt=it-v+l,rt=U-1+2*l,St=it-1+2*l,q=o[(P&=255)+r[D&=255]],Z=o[P+m+r[D+v]],G=o[P+1+r[D+1]],Nt=.5-U*U-it*it,Kt=.5-st*st-nt*nt,$t=.5-rt*rt-St*St;return 70*((Nt<0?0:(Nt*=Nt)*Nt*q.dot2(U,it))+(Kt<0?0:(Kt*=Kt)*Kt*Z.dot2(st,nt))+($t<0?0:($t*=$t)*$t*G.dot2(rt,St)))},t.simplex3=function(p,d,m){var v,E,P,D,B,U,it=(p+d+m)*.3333333333333333,st=Math.floor(p+it),nt=Math.floor(d+it),rt=Math.floor(m+it),St=(st+nt+rt)*c,q=p-st+St,Z=d-nt+St,G=m-rt+St;q>=Z?Z>=G?(v=1,E=0,P=0,D=1,B=1,U=0):q>=G?(v=1,E=0,P=0,D=1,B=0,U=1):(v=0,E=0,P=1,D=1,B=0,U=1):Z<G?(v=0,E=0,P=1,D=0,B=1,U=1):q<G?(v=0,E=1,P=0,D=0,B=1,U=1):(v=0,E=1,P=0,D=1,B=1,U=0);var Nt=q-v+c,Kt=Z-E+c,$t=G-P+c,Ln=q-D+2*c,Fn=Z-B+2*c,Mn=G-U+2*c,Dn=q-1+.5,Bn=Z-1+.5,On=G-1+.5,nh=o[(st&=255)+r[(nt&=255)+r[rt&=255]]],rh=o[st+v+r[nt+E+r[rt+P]]],oh=o[st+D+r[nt+B+r[rt+U]]],ah=o[st+1+r[nt+1+r[rt+1]]],is=.6-q*q-Z*Z-G*G,ss=.6-Nt*Nt-Kt*Kt-$t*$t,ns=.6-Ln*Ln-Fn*Fn-Mn*Mn,rs=.6-Dn*Dn-Bn*Bn-On*On;return 32*((is<0?0:(is*=is)*is*nh.dot3(q,Z,G))+(ss<0?0:(ss*=ss)*ss*rh.dot3(Nt,Kt,$t))+(ns<0?0:(ns*=ns)*ns*oh.dot3(Ln,Fn,Mn))+(rs<0?0:(rs*=rs)*rs*ah.dot3(Dn,Bn,On)))},t.perlin2=function(p,d){var m=Math.floor(p),v=Math.floor(d);p-=m,d-=v;var E=o[(m&=255)+r[v&=255]].dot2(p,d),P=o[m+r[v+1]].dot2(p,d-1),D=o[m+1+r[v]].dot2(p-1,d),B=o[m+1+r[v+1]].dot2(p-1,d-1),U=u(p);return h(h(E,D,U),h(P,B,U),u(d))},t.perlin3=function(p,d,m){var v=Math.floor(p),E=Math.floor(d),P=Math.floor(m);p-=v,d-=E,m-=P;var D=o[(v&=255)+r[(E&=255)+r[P&=255]]].dot3(p,d,m),B=o[v+r[E+r[P+1]]].dot3(p,d,m-1),U=o[v+r[E+1+r[P]]].dot3(p,d-1,m),it=o[v+r[E+1+r[P+1]]].dot3(p,d-1,m-1),st=o[v+1+r[E+r[P]]].dot3(p-1,d,m),nt=o[v+1+r[E+r[P+1]]].dot3(p-1,d,m-1),rt=o[v+1+r[E+1+r[P]]].dot3(p-1,d-1,m),St=o[v+1+r[E+1+r[P+1]]].dot3(p-1,d-1,m-1),q=u(p),Z=u(d),G=u(m);return h(h(h(D,st,q),h(B,nt,q),G),h(h(U,rt,q),h(it,St,q),G),Z)}})(window);var Tl=window.noise;var vs=class{constructor(t,e={}){this.canvas=t,this.resolutionMultiplier=e.resolutionMultiplier||2,this.device="desktop",this.isPortrait=!1,this.isTouchDevice=!1,this.isFullscreen=!1,this.displaySize={width:0,height:0},this.renderSize={width:0,height:0},this.aspectCorrection={x:1,y:1},this.onResize=null}init(){this._detect(),this._sizeCanvas(),this._calcAspectCorrection(),this._listenResize(),this._listenFullscreen(),console.log("ResponsiveManager init \u2014",this.device,`${this.displaySize.width}\xD7${this.displaySize.height}`,this.isPortrait?"portrait":"landscape")}_detect(){this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0;let t=window.innerWidth,e=window.innerHeight;this.isPortrait=e>t,t<=768?this.device="mobile":t<=1024&&this.isTouchDevice?this.device="tablet":this.device="desktop"}_sizeCanvas(){let t=window.innerWidth,e=window.innerHeight;if(this.isFullscreen){this.displaySize.width=t,this.displaySize.height=e;let s=this.device==="desktop"?1:this.resolutionMultiplier;this.renderSize.width=t*s,this.renderSize.height=e*s,this.canvas.width=this.renderSize.width,this.canvas.height=this.renderSize.height,this.canvas.style.width="",this.canvas.style.height="";return}if(this.device==="mobile"||this.device==="tablet")this.displaySize.width=t,this.displaySize.height=e;else{let s=Math.min(t,1200);this.displaySize.width=s,this.displaySize.height=s*.5}this.renderSize.width=this.displaySize.width*this.resolutionMultiplier,this.renderSize.height=this.displaySize.height*this.resolutionMultiplier,this.canvas.width=this.renderSize.width,this.canvas.height=this.renderSize.height,this.canvas.style.width=this.displaySize.width+"px",this.canvas.style.height=this.displaySize.height+"px"}_calcAspectCorrection(){let t=this.displaySize.width/this.displaySize.height;t>1?(this.aspectCorrection.x=1/t,this.aspectCorrection.y=1):(this.aspectCorrection.x=1,this.aspectCorrection.y=t)}_listenResize(){let t,e=()=>{clearTimeout(t),t=setTimeout(()=>this._onResize(),200)};window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}_onResize(){this._detect(),this._sizeCanvas(),this._calcAspectCorrection(),this.onResize&&this.onResize(),console.log("Resize \u2014",this.device,`${this.displaySize.width}\xD7${this.displaySize.height}`)}_listenFullscreen(){let t=document.querySelector("[data-fullscreen]");t&&t.addEventListener("click",()=>this.enterFullscreen());let e=document.querySelector("[data-fullscreen-exit]");e&&e.addEventListener("click",()=>this.exitFullscreen()),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(s=>document.addEventListener(s,()=>this._onFullscreenChange()))}async enterFullscreen(){let t=this.canvas.closest(".canvas-wrap")||document.documentElement;try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen()}catch(e){console.warn("Fullscreen request denied:",e)}}async exitFullscreen(){try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(t){console.warn("Exit fullscreen failed:",t)}}_onFullscreenChange(){this.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);let t=this.canvas.closest(".canvas-wrap");t&&t.classList.toggle("is-fullscreen",this.isFullscreen),setTimeout(()=>this._onResize(),100),console.log(this.isFullscreen?"Fullscreen ON":"Fullscreen OFF")}};var fs=class{constructor(t,e){this.gl=t,this.config=e,this.frameCount=0,this.lastTime=performance.now(),this.fps=0,this.minFps=1/0,this.maxFps=0,this.frameTimes=[],this.maxFrameTimeHistory=60,this.gpuTimings={},this.gpuSupported=!1,this.activeQuery=null,this.queryPool=[],this.pendingQueries=[],this.setupGPUTiming(),this.lastSampleTime=performance.now(),this.sampleData=null,this.customMetrics=new Map}setupGPUTiming(){let t=this.gl;this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query"),this.ext?(this.gpuSupported=!0,console.log("GPU profiling enabled")):console.warn("GPU profiling not supported (extension unavailable)")}getQuery(){if(this.queryPool.length>0)return this.queryPool.pop();let t=this.gl;return{query:t.createQuery?t.createQuery():this.ext.createQueryEXT(),name:null,resolved:!1}}returnQuery(t){t.name=null,t.resolved=!1,this.queryPool.push(t)}beginFrame(){this.frameStartTime=performance.now(),this.passTimings={}}beginPass(t){if(this.currentPassName=t,this.currentPassStart=performance.now(),!this.gpuSupported)return;let e=this.gl,s=this.getQuery();s.name=t,e.beginQuery?e.beginQuery(this.ext.TIME_ELAPSED_EXT,s.query):this.ext.beginQueryEXT(this.ext.TIME_ELAPSED_EXT,s.query),this.activeQuery=s}endPass(t){let e=performance.now()-this.currentPassStart;if(this.passTimings[t]={cpu:e},!this.gpuSupported||!this.activeQuery)return;let s=this.gl;s.endQuery?s.endQuery(this.ext.TIME_ELAPSED_EXT):this.ext.endQueryEXT(this.ext.TIME_ELAPSED_EXT),this.pendingQueries.push(this.activeQuery),this.activeQuery=null}endFrame(){let t=performance.now()-this.frameStartTime;this.frameTimes.push(t),this.frameTimes.length>this.maxFrameTimeHistory&&this.frameTimes.shift(),this.frameCount++,this.gpuSupported&&this.processPendingQueries();let e=performance.now(),s=e-this.lastTime;s>=1e3&&(this.fps=Math.round(this.frameCount/s*1e3),this.minFps=Math.min(this.minFps,this.fps),this.maxFps=Math.max(this.maxFps,this.fps),this.frameCount=0,this.lastTime=e);let n=this.config.metricsInterval||1e3;e-this.lastSampleTime>=n&&(this.takeSample(),this.lastSampleTime=e)}processPendingQueries(){let t=this.gl,e=t.QUERY_RESULT_AVAILABLE||this.ext.QUERY_RESULT_AVAILABLE_EXT,s=t.QUERY_RESULT||this.ext.QUERY_RESULT_EXT;if(t.getParameter(this.ext.GPU_DISJOINT_EXT)){this.pendingQueries.forEach(r=>this.returnQuery(r)),this.pendingQueries=[];return}let n=[];for(let r of this.pendingQueries)if(t.getQueryParameter?t.getQueryParameter(r.query,e):this.ext.getQueryObjectEXT(r.query,e)){let l=(t.getQueryParameter?t.getQueryParameter(r.query,s):this.ext.getQueryObjectEXT(r.query,s))/1e6;this.gpuTimings[r.name]||(this.gpuTimings[r.name]=[]),this.gpuTimings[r.name].push(l),this.gpuTimings[r.name].length>10&&this.gpuTimings[r.name].shift(),this.returnQuery(r)}else n.push(r);this.pendingQueries=n}takeSample(){let t=this.frameTimes.reduce((r,o)=>r+o,0)/this.frameTimes.length,e=Math.min(...this.frameTimes),s=Math.max(...this.frameTimes),n={};for(let[r,o]of Object.entries(this.gpuTimings)){let a=o.reduce((l,c)=>l+c,0)/o.length;n[r]=a.toFixed(2)}this.sampleData={fps:this.fps,minFps:this.minFps===1/0?this.fps:this.minFps,maxFps:this.maxFps||this.fps,avgFrameTime:t.toFixed(2),minFrameTime:e.toFixed(2),maxFrameTime:s.toFixed(2),cpuPassTimings:{...this.passTimings},gpuPassTimings:n,customMetrics:this.getCustomMetrics()}}getCustomMetrics(){let t={};for(let[e,s]of this.customMetrics)try{t[e]=s()}catch{t[e]="Error"}return t}addMetric(t,e){this.customMetrics.set(t,e)}removeMetric(t){this.customMetrics.delete(t)}reset(){this.minFps=1/0,this.maxFps=0,this.frameTimes=[]}destroy(){let t=this.gl,e=s=>{t.deleteQuery?t.deleteQuery(s.query):this.ext&&this.ext.deleteQueryEXT(s.query)};this.queryPool.forEach(e),this.pendingQueries.forEach(e),this.queryPool=[],this.pendingQueries=[]}};var bs=class{constructor(t={}){this.schema=t,this.config={},this.defaults={},this.pane=null,this._buildFromSchema()}_buildFromSchema(){for(let[t,e]of Object.entries(this.schema)){let s=e.default!==void 0?e.default:e.value;this.config[t]=Array.isArray(s)?[...s]:s,this.defaults[t]=Array.isArray(s)?[...s]:s}}setPaneRef(t){this.pane=t}_refreshPane(){this.pane&&typeof this.pane.refresh=="function"&&this.pane.refresh()}getConfig(){return{...this.config}}getDefaults(){return{...this.defaults}}updateConfig(t){Object.assign(this.config,t),this._refreshPane()}reset(){for(let[t,e]of Object.entries(this.defaults))this.config[t]=Array.isArray(e)?[...e]:e;this._refreshPane(),console.log("Settings reset to defaults")}exportConfig(){try{return btoa(JSON.stringify(this.config))}catch(t){return console.error("Export failed:",t),null}}async exportToClipboard(){let t=this.exportConfig();if(!t)return!1;try{return await navigator.clipboard.writeText(t),console.log("Settings copied to clipboard"),!0}catch(e){return console.error("Clipboard write failed:",e),!1}}importConfig(t){try{let e=JSON.parse(atob(t));for(let s of Object.keys(this.schema))e[s]!==void 0&&(this.config[s]=e[s]);return this._refreshPane(),console.log("Settings loaded successfully"),!0}catch(e){return console.error("Invalid settings string:",e),!1}}setupPasteListener(t=null){window.addEventListener("paste",e=>{if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")return;let s=e.clipboardData.getData("text");s&&s.length>20&&this.importConfig(s)&&(e.preventDefault(),t&&t(this.config))})}setupKeyboardShortcuts(t=null,e=null){window.addEventListener("keydown",s=>{s.target.tagName==="INPUT"||s.target.tagName==="TEXTAREA"||((s.ctrlKey||s.metaKey)&&s.key==="c"&&(s.preventDefault(),this.exportToClipboard().then(n=>{n&&t&&t(this.config)})),(s.ctrlKey||s.metaKey)&&s.key==="r"&&(s.preventDefault(),this.reset(),e&&e(this.config)))})}};function S(i){return i==null}function _o(i){return i!==null&&typeof i=="object"}function Gn(i){return i!==null&&typeof i=="object"}function uh(i,t){if(i.length!==t.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==t[e])return!1;return!0}function pe(i,t){return Array.from(new Set([...Object.keys(i),...Object.keys(t)])).reduce((s,n)=>{let r=i[n],o=t[n];return Gn(r)&&Gn(o)?Object.assign(Object.assign({},s),{[n]:pe(r,o)}):Object.assign(Object.assign({},s),{[n]:n in t?o:r})},{})}function go(i){return _o(i)?"target"in i:!1}var hh={alreadydisposed:()=>"View has been already disposed",invalidparams:i=>`Invalid parameters for '${i.name}'`,nomatchingcontroller:i=>`No matching controller for '${i.key}'`,nomatchingview:i=>`No matching view for '${JSON.stringify(i.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:i=>`Not compatible with  plugin '${i.id}'`,propertynotfound:i=>`Property '${i.name}' not found`,shouldneverhappen:()=>"This error should never happen"},j=class i{static alreadyDisposed(){return new i({type:"alreadydisposed"})}static notBindable(){return new i({type:"notbindable"})}static notCompatible(t,e){return new i({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new i({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new i({type:"shouldneverhappen"})}constructor(t){var e;this.message=(e=hh[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}},xs=class i{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return!(t===null||typeof t!="object"&&typeof t!="function")}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){let s=this.read();if(!i.isBindable(s))throw j.notBindable();if(!(t in s))throw j.propertyNotFound(t);s[t]=e}},L=class{constructor(){this.observers_={}}on(t,e,s){var n;let r=this.observers_[t];return r||(r=this.observers_[t]=[]),r.push({handler:e,key:(n=s?.key)!==null&&n!==void 0?n:e}),this}off(t,e){let s=this.observers_[t];return s&&(this.observers_[t]=s.filter(n=>n.key!==e)),this}emit(t,e){let s=this.observers_[t];s&&s.forEach(n=>{n.handler(e)})}},Hn=class{constructor(t,e){var s;this.constraint_=e?.constraint,this.equals_=(s=e?.equals)!==null&&s!==void 0?s:((n,r)=>n===r),this.emitter=new L,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let s=e??{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(t):t,r=this.rawValue_;this.equals_(r,n)&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:s,previousRawValue:r,rawValue:n,sender:this}))}},Xn=class{constructor(t){this.emitter=new L,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let s=e??{forceEmit:!1,last:!0},n=this.value_;n===t&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:s,previousRawValue:n,rawValue:this.value_,sender:this}))}},Yn=class{constructor(t){this.emitter=new L,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}};function V(i,t){let e=t?.constraint,s=t?.equals;return!e&&!s?new Xn(i):new Hn(i,t)}function ph(i){return[new Yn(i),(t,e)=>{i.setRawValue(t,e)}]}var g=class i{constructor(t){this.emitter=new L,this.valMap_=t;for(let e in this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((s,n)=>Object.assign(s,{[n]:V(t[n])}),{})}static fromObject(t){let e=this.createCore(t);return new i(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}},de=class{constructor(t){this.values=g.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),s=this.values.get("min");return Math.min(Math.max(t,s),e)}},Qn=class{constructor(t){this.values=g.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),s=this.values.get("min"),n=t;return S(s)||(n=Math.max(n,s)),S(e)||(n=Math.min(n,e)),n}},Wn=class{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){let e=this.origin%this.step,s=Math.round((t-e)/this.step);return e+s*this.step}},Jn=class{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}},dh={"**":(i,t)=>Math.pow(i,t),"*":(i,t)=>i*t,"/":(i,t)=>i/t,"%":(i,t)=>i%t,"+":(i,t)=>i+t,"-":(i,t)=>i-t,"<<":(i,t)=>i<<t,">>":(i,t)=>i>>t,">>>":(i,t)=>i>>>t,"&":(i,t)=>i&t,"^":(i,t)=>i^t,"|":(i,t)=>i|t},Zn=class{constructor(t,e,s){this.left=e,this.operator=t,this.right=s}evaluate(){let t=dh[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}},mh={"+":i=>i,"-":i=>-i,"~":i=>~i},tr=class{constructor(t,e){this.operator=t,this.expression=e}evaluate(){let t=mh[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function wo(i){return(t,e)=>{for(let s=0;s<i.length;s++){let n=i[s](t,e);if(n!=="")return n}return""}}function ai(i,t){var e;let s=i.substr(t).match(/^\s+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function vh(i,t){let e=i.substr(t,1);return e.match(/^[1-9]$/)?e:""}function li(i,t){var e;let s=i.substr(t).match(/^[0-9]+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function fh(i,t){let e=li(i,t);if(e!=="")return e;let s=i.substr(t,1);if(t+=1,s!=="-"&&s!=="+")return"";let n=li(i,t);return n===""?"":s+n}function xo(i,t){let e=i.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";let s=fh(i,t);return s===""?"":e+s}function tc(i,t){let e=i.substr(t,1);if(e==="0")return e;let s=vh(i,t);return t+=s.length,s===""?"":s+li(i,t)}function bh(i,t){let e=tc(i,t);if(t+=e.length,e==="")return"";let s=i.substr(t,1);if(t+=s.length,s!==".")return"";let n=li(i,t);return t+=n.length,e+s+n+xo(i,t)}function _h(i,t){let e=i.substr(t,1);if(t+=e.length,e!==".")return"";let s=li(i,t);return t+=s.length,s===""?"":e+s+xo(i,t)}function gh(i,t){let e=tc(i,t);return t+=e.length,e===""?"":e+xo(i,t)}var wh=wo([bh,_h,gh]);function xh(i,t){var e;let s=i.substr(t).match(/^[01]+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function Ch(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";let s=xh(i,t);return s===""?"":e+s}function yh(i,t){var e;let s=i.substr(t).match(/^[0-7]+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function Eh(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";let s=yh(i,t);return s===""?"":e+s}function Ph(i,t){var e;let s=i.substr(t).match(/^[0-9a-f]+/i);return(e=s&&s[0])!==null&&e!==void 0?e:""}function kh(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";let s=Ph(i,t);return s===""?"":e+s}var Sh=wo([Ch,Eh,kh]),Vh=wo([Sh,wh]);function Th(i,t){let e=Vh(i,t);return t+=e.length,e===""?null:{evaluable:new Jn(e),cursor:t}}function Ah(i,t){let e=i.substr(t,1);if(t+=e.length,e!=="(")return null;let s=ic(i,t);if(!s)return null;t=s.cursor,t+=ai(i,t).length;let n=i.substr(t,1);return t+=n.length,n!==")"?null:{evaluable:s.evaluable,cursor:t}}function Rh(i,t){var e;return(e=Th(i,t))!==null&&e!==void 0?e:Ah(i,t)}function ec(i,t){let e=Rh(i,t);if(e)return e;let s=i.substr(t,1);if(t+=s.length,s!=="+"&&s!=="-"&&s!=="~")return null;let n=ec(i,t);return n?(t=n.cursor,{cursor:t,evaluable:new tr(s,n.evaluable)}):null}function Lh(i,t,e){e+=ai(t,e).length;let s=i.filter(n=>t.startsWith(n,e))[0];return s?(e+=s.length,e+=ai(t,e).length,{cursor:e,operator:s}):null}function Fh(i,t){return(e,s)=>{let n=i(e,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){let o=Lh(t,e,s);if(!o)break;s=o.cursor;let a=i(e,s);if(!a)return null;s=a.cursor,r=new Zn(o.operator,r,a.evaluable)}return r?{cursor:s,evaluable:r}:null}}var Mh=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((i,t)=>Fh(i,t),ec);function ic(i,t){return t+=ai(i,t).length,Mh(i,t)}function Dh(i){let t=ic(i,0);return!t||t.cursor+ai(i,t.cursor).length!==i.length?null:t.evaluable}function Lt(i){var t;let e=Dh(i);return(t=e?.evaluate())!==null&&t!==void 0?t:null}function sc(i){if(typeof i=="number")return i;if(typeof i=="string"){let t=Lt(i);if(!S(t))return t}return 0}function Bh(i){return String(i)}function J(i){return t=>t.toFixed(Math.max(Math.min(i,20),0))}function y(i,t,e,s,n){let r=(i-t)/(e-t);return s+r*(n-s)}function Al(i){return String(i.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function I(i,t,e){return Math.min(Math.max(i,t),e)}function nc(i,t){return(i%t+t)%t}function Oh(i,t){return S(i.step)?Math.max(Al(t),2):Al(i.step)}function rc(i){var t;return(t=i.step)!==null&&t!==void 0?t:1}function oc(i,t){var e;let s=Math.abs((e=i.step)!==null&&e!==void 0?e:t);return s===0?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function ac(i,t){return S(i.step)?null:new Wn(i.step,t)}function lc(i){return!S(i.max)&&!S(i.min)?new de({max:i.max,min:i.min}):!S(i.max)||!S(i.min)?new Qn({max:i.max,min:i.min}):null}function cc(i,t){var e,s,n;return{formatter:(e=i.format)!==null&&e!==void 0?e:J(Oh(i,t)),keyScale:(s=i.keyScale)!==null&&s!==void 0?s:rc(i),pointerScale:(n=i.pointerScale)!==null&&n!==void 0?n:oc(i,t)}}function uc(i){return{format:i.optional.function,keyScale:i.optional.number,max:i.optional.number,min:i.optional.number,pointerScale:i.optional.number,step:i.optional.number}}function Co(i){return{constraint:i.constraint,textProps:g.fromObject(cc(i.params,i.initialValue))}}var Ft=class{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}},Me=class{constructor(t){this.target=t}},me=class extends Me{constructor(t,e,s){super(t),this.value=e,this.last=s??!0}},er=class extends Me{constructor(t,e){super(t),this.expanded=e}},ir=class extends Me{constructor(t,e){super(t),this.index=e}},sr=class extends Me{constructor(t,e){super(t),this.native=e}},ve=class extends Ft{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new L,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){let e=this.controller.value;this.emitter_.emit("change",new me(this,e.binding.target.read(),t.options.last))}},nr=class{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new L}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}};function Uh(i){if(!("binding"in i))return!1;let t=i.binding;return go(t)&&"read"in t&&"write"in t}function Ih(i,t){let s=Object.keys(t).reduce((n,r)=>{if(n===void 0)return;let o=t[r],a=o(i[r]);return a.succeeded?Object.assign(Object.assign({},n),{[r]:a.value}):void 0},{});return s}function jh(i,t){return i.reduce((e,s)=>{if(e===void 0)return;let n=t(s);if(!(!n.succeeded||n.value===void 0))return[...e,n.value]},[])}function zh(i){return i===null?!1:typeof i=="object"}function Tt(i){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};let s=i(e);return s!==void 0?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function Rl(i){return{custom:t=>Tt(t)(i),boolean:Tt(t=>typeof t=="boolean"?t:void 0)(i),number:Tt(t=>typeof t=="number"?t:void 0)(i),string:Tt(t=>typeof t=="string"?t:void 0)(i),function:Tt(t=>typeof t=="function"?t:void 0)(i),constant:t=>Tt(e=>e===t?t:void 0)(i),raw:Tt(t=>t)(i),object:t=>Tt(e=>{if(zh(e))return Ih(e,t)})(i),array:t=>Tt(e=>{if(Array.isArray(e))return jh(e,t)})(i)}}var rr={optional:Rl(!0),required:Rl(!1)};function A(i,t){let e=t(rr),s=rr.required.object(e)(i);return s.succeeded?s.value:void 0}function tt(i,t,e,s){if(t&&!t(i))return!1;let n=A(i,e);return n?s(n):!1}function et(i,t){var e;return pe((e=i?.())!==null&&e!==void 0?e:{},t)}function he(i){return"value"in i}function hc(i){if(!_o(i)||!("binding"in i))return!1;let t=i.binding;return go(t)}var gt="http://www.w3.org/2000/svg";function Cs(i){i.offsetHeight}function Nh(i,t){let e=i.style.transition;i.style.transition="none",t(),i.style.transition=e}function yo(i){return i.ontouchstart!==void 0}function Kh(){return globalThis}function $h(){return Kh().document}function qh(i){let t=i.ownerDocument.defaultView;return t&&"document"in t?i.getContext("2d",{willReadFrequently:!0}):null}var Gh={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Bs(i,t){let e=i.createElementNS(gt,"svg");return e.innerHTML=Gh[t],e}function pc(i,t,e){i.insertBefore(t,i.children[e])}function Eo(i){i.parentElement&&i.parentElement.removeChild(i)}function dc(i){for(;i.children.length>0;)i.removeChild(i.children[0])}function Hh(i){for(;i.childNodes.length>0;)i.removeChild(i.childNodes[0])}function mc(i){return i.relatedTarget?i.relatedTarget:"explicitOriginalTarget"in i?i.explicitOriginalTarget:null}function Rt(i,t){i.emitter.on("change",e=>{t(e.rawValue)}),t(i.rawValue)}function xt(i,t,e){Rt(i.value(t),e)}var Xh="tp";function w(i){return(e,s)=>[Xh,"-",i,"v",e?`_${e}`:"",s?`-${s}`:""].join("")}var si=w("lbl");function Yh(i,t){let e=i.createDocumentFragment();return t.split(`
`).map(n=>i.createTextNode(n)).forEach((n,r)=>{r>0&&e.appendChild(i.createElement("br")),e.appendChild(n)}),e}var ys=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(si()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(si("l")),xt(e.props,"label",r=>{S(r)?this.element.classList.add(si(void 0,"nol")):(this.element.classList.remove(si(void 0,"nol")),Hh(s),s.appendChild(Yh(t,r)))}),this.element.appendChild(s),this.labelElement=s;let n=t.createElement("div");n.classList.add(si("v")),this.element.appendChild(n),this.valueElement=n}},Es=class{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new ys(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return tt(t,null,e=>({label:e.optional.string}),e=>(this.props.set("label",e.label),!0))}exportProps(){return et(null,{label:this.props.get("label")})}};function Qh(){return["veryfirst","first","last","verylast"]}var Ll=w(""),Fl={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"},De=class{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;let e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Qh().forEach(s=>{e.classList.remove(Ll(void 0,Fl[s]))}),this.blade.get("positions").forEach(s=>{e.classList.add(Ll(void 0,Fl[s]))})}),this.viewProps.handleDispose(()=>{Eo(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return tt(t,null,e=>({disabled:e.required.boolean,hidden:e.required.boolean}),e=>(this.viewProps.importState(e),!0))}exportState(){return et(null,Object.assign({},this.viewProps.exportState()))}},Mt=class extends De{constructor(t,e){if(e.value!==e.valueController.value)throw j.shouldNeverHappen();let s=e.valueController.viewProps,n=new Es(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new ys(t,{props:e.props,viewProps:s}),viewProps:s})),this.labelController=n,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return tt(t,e=>{var s,n,r;return super.importState(e)&&this.labelController.importProps(e)&&((r=(n=(s=this.valueController).importProps)===null||n===void 0?void 0:n.call(s,t))!==null&&r!==void 0?r:!0)},e=>({value:e.optional.raw}),e=>(e.value&&(this.value.rawValue=e.value),!0))}exportState(){var t,e,s;return et(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(s=(e=(t=this.valueController).exportProps)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:{}))}};function Ml(i){let t=Object.assign({},i);return delete t.value,t}var Ps=class extends Mt{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return tt(t,e=>super.importState(Ml(t)),e=>({tag:e.optional.string}),e=>(this.tag=e.tag,!0))}exportState(){return et(()=>Ml(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}};function Wh(i){return he(i)&&hc(i.value)}var or=class extends Ps{importState(t){return tt(t,e=>super.importState(e),e=>({binding:e.required.object({value:e.required.raw})}),e=>(this.value.binding.inject(e.binding.value),this.value.fetch(),!0))}};function Jh(i){return he(i)&&Uh(i.value)}function vc(i,t){for(;i.length<t;)i.push(void 0)}function Zh(i){let t=[];return vc(t,i),t}function tp(i){let t=i.indexOf(void 0);return t<0?i:i.slice(0,t)}function ep(i,t){let e=[...tp(i),t];return e.length>i.length?e.splice(0,e.length-i.length):vc(e,i.length),e}var ar=class{constructor(t){this.emitter=new L,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=V(Zh(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=ep(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}};function ip(i){if(!("binding"in i))return!1;let t=i.binding;return go(t)&&"read"in t&&!("write"in t)}var lr=class extends Ps{exportState(){return et(()=>super.exportState(),{binding:{readonly:!0}})}};function sp(i){return he(i)&&ip(i.value)}var cr=class extends Ft{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return(t=this.controller.buttonController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){let s=e.bind(this);return this.controller.buttonController.emitter.on(t,r=>{s(new sr(this,r.nativeEvent))}),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}};function np(i,t,e){e?i.classList.add(t):i.classList.remove(t)}function Ue(i,t){return e=>{np(i,t,e)}}function Po(i,t){Rt(i,e=>{t.textContent=e??""})}var Un=w("btn"),ur=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Un()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("button");s.classList.add(Un("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(Un("t")),Po(e.props.value("title"),n),this.buttonElement.appendChild(n)}},hr=class{constructor(t,e){this.emitter=new L,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new ur(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return tt(t,null,e=>({title:e.optional.string}),e=>(this.props.set("title",e.title),!0))}exportProps(){return et(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}},ks=class extends De{constructor(t,e){let s=new hr(t,{props:e.buttonProps,viewProps:e.viewProps}),n=new Es(t,{blade:e.blade,props:e.labelProps,valueController:s});super({blade:e.blade,view:n.view,viewProps:e.viewProps}),this.buttonController=s,this.labelController=n}importState(t){return tt(t,e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e),()=>({}),()=>!0)}exportState(){return et(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},Ss=class{constructor(t){let[e,s]=t.split("-"),n=e.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=s??null}toString(){let t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}},Ie=new Ss("2.0.5");function X(i){return Object.assign({core:Ie},i)}var rp=X({id:"button",type:"blade",accept(i){let t=A(i,e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string}));return t?{params:t}:null},controller(i){return new ks(i.document,{blade:i.blade,buttonProps:g.fromObject({title:i.params.title}),labelProps:g.fromObject({label:i.params.label}),viewProps:i.viewProps})},api(i){return i.controller instanceof ks?new cr(i.controller):null}});function op(i,t){return i.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function ap(i,t){return i.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function lp(i,t){return i.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}function cp(i){return _o(i)?"refresh"in i&&typeof i.refresh=="function":!1}function up(i,t){if(!xs.isBindable(i))throw j.notBindable();return new xs(i,t)}var pr=class{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new L,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,s){let n=s??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,up(t,e),n),a=this.pool_.createBindingApi(o);return this.add(a,n.index)}addFolder(t){return ap(this,t)}addButton(t){return op(this,t)}addTab(t){return lp(this,t)}add(t,e){let s=t.controller;return this.controller_.rack.add(s,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){let e=this.controller_.element.ownerDocument,s=this.pool_.createBlade(e,t),n=this.pool_.createApi(s);return this.add(n,t.index)}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach(t=>{cp(t)&&t.refresh()})}onRackValueChange_(t){let e=t.bladeController,s=this.pool_.createApi(e),n=hc(e.value)?e.value.binding:null;this.emitter_.emit("change",new me(s,n?n.target.read():e.value.rawValue,t.options.last))}},ci=class extends Ft{constructor(t,e){super(t),this.rackApi_=new pr(t.rackController,e)}refresh(){this.rackApi_.refresh()}},ui=class extends De{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return tt(t,e=>super.importState(e),e=>({children:e.required.array(e.required.raw)}),e=>this.rackController.rack.children.every((s,n)=>s.importState(e.children[n])))}exportState(){return et(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}};function dr(i){return"rackController"in i}var mr=class{constructor(t){this.emitter=new L,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(let e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw j.shouldNeverHappen();let s=e!==void 0?e:this.items_.length;this.items_.splice(s,0,t),this.cache_.add(t);let n=this.extract_(t);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:s,item:t,root:this,target:this})}remove(t){let e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);let s=this.extract_(t);s&&(s.allItems().forEach(n=>{this.cache_.delete(n)}),s.emitter.off("add",this.onSubListAdd_),s.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}};function hp(i,t){for(let e=0;e<i.length;e++){let s=i[e];if(he(s)&&s.value===t)return s}return null}function pp(i){return dr(i)?i.rackController.rack.bcSet_:null}var vr=class{constructor(t){var e,s;this.emitter=new L,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(e=t.blade)!==null&&e!==void 0?e:null,(s=this.blade_)===null||s===void 0||s.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new mr(pp),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var s;(s=t.parent)===null||s===void 0||s.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;let s=t.item;if(s.viewProps.emitter.on("change",this.onChildViewPropsChange_),s.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),s.viewProps.handleDispose(this.onChildDispose_),he(s))s.value.emitter.on("change",this.onChildValueChange_);else if(dr(s)){let n=s.rackController.rack;if(n){let r=n.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;let s=t.item;if(he(s))s.value.emitter.off("change",this.onChildValueChange_);else if(dr(s)){let n=s.rackController.rack;if(n){let r=n.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){let t=this.bcSet_.items.filter(n=>!n.viewProps.get("hidden")),e=t[0],s=t[t.length-1];this.bcSet_.items.forEach(n=>{let r=[];n===e&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),n===s&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),n.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildValueChange_(t){let e=hp(this.find(he),t.sender);if(!e)throw j.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},hi=class{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;let e=new vr({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let s=this.rack.children.length-1;s>=0;s--)this.rack.children[s].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&pc(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&Eo(t.bladeController.view.element)}};function je(){return new g({positions:V([],{equals:uh})})}var pi=class i extends g{constructor(t){super(t)}static create(t){let e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=g.createCore(e);return new i(s)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!S(t)?`${t}px`:"auto"}bindExpandedClass(t,e){let s=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};xt(this,"expanded",s),xt(this,"temporaryExpanded",s)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function dp(i,t){let e=0;return Nh(t,()=>{i.set("expandedHeight",null),i.set("temporaryExpanded",!0),Cs(t),e=t.clientHeight,i.set("temporaryExpanded",null),Cs(t)}),e}function Dl(i,t){t.style.height=i.styleHeight}function ko(i,t){i.value("expanded").emitter.on("beforechange",()=>{if(i.set("completed",!1),S(i.get("expandedHeight"))){let e=dp(i,t);e>0&&i.set("expandedHeight",e)}i.set("shouldFixHeight",!0),Cs(t)}),i.emitter.on("change",()=>{Dl(i,t)}),Dl(i,t),t.addEventListener("transitionend",e=>{e.propertyName==="height"&&i.cleanUpTransition()})}var Vs=class extends ci{constructor(t,e){super(t,e),this.emitter_=new L,this.controller.foldable.value("expanded").emitter.on("change",s=>{this.emitter_.emit("fold",new er(this,s.sender.rawValue))}),this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,s){return this.rackApi_.addBinding(t,e,s)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}},fc=w("cnt"),fr=class{constructor(t,e){var s;this.className_=w((s=e.viewName)!==null&&s!==void 0?s:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),fc()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),xt(this.foldable_,"completed",Ue(this.element,this.className_(void 0,"cpl")));let n=t.createElement("button");n.classList.add(this.className_("b")),xt(e.props,"title",c=>{S(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;let r=t.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);let o=t.createElement("div");o.classList.add(this.className_("t")),Po(e.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;let a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);let l=t.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}},di=class extends ui{constructor(t,e){var s;let n=pi.create((s=e.expanded)!==null&&s!==void 0?s:!0),r=new fr(t,{foldable:n,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new hi({blade:e.blade,element:r.containerElement,root:e.root,viewProps:e.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=n,ko(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return tt(t,e=>super.importState(e),e=>({expanded:e.required.boolean,title:e.optional.string}),e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0))}exportState(){return et(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}},mp=X({id:"folder",type:"blade",accept(i){let t=A(i,e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean}));return t?{params:t}:null},controller(i){return new di(i.document,{blade:i.blade,expanded:i.params.expanded,props:g.fromObject({title:i.params.title}),viewProps:i.viewProps})},api(i){return i.controller instanceof di?new Vs(i.controller,i.pool):null}}),vp=w("");function Bl(i,t){return Ue(i,vp(void 0,t))}var Dt=class i extends g{constructor(t){var e;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ph(V(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,s,n;let r=t??{};return new i(g.createCore({disabled:(e=r.disabled)!==null&&e!==void 0?e:!1,disposed:!1,hidden:(s=r.hidden)!==null&&s!==void 0?s:!1,parent:(n=r.parent)!==null&&n!==void 0?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){Rt(this.globalDisabled_,Bl(t,"disabled")),xt(this,"hidden",Bl(t,"hidden"))}bindDisabled(t){Rt(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){Rt(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){let t=this.get("parent");return(t?t.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;let s=t.previousRawValue;s?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}},Ol=w("tbp"),br=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ol()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Ol("c")),this.element.appendChild(s),this.containerElement=s}},ni=w("tbi"),_r=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ni()),e.viewProps.bindClassModifiers(this.element),xt(e.props,"selected",r=>{r?this.element.classList.add(ni(void 0,"sel")):this.element.classList.remove(ni(void 0,"sel"))});let s=t.createElement("button");s.classList.add(ni("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(ni("t")),Po(e.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}},gr=class{constructor(t,e){this.emitter=new L,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new _r(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},mi=class extends ui{constructor(t,e){let s=new br(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new hi({blade:e.blade,element:s.containerElement,viewProps:e.viewProps}),view:s})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new gr(t,{props:e.itemProps,viewProps:Dt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,xt(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}importState(t){return tt(t,e=>super.importState(e),e=>({selected:e.required.boolean,title:e.required.string}),e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0))}exportState(){return et(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},wr=class extends ci{constructor(t,e){super(t,e),this.emitter_=new L,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){let e=this.controller.view.element.ownerDocument,s=new mi(e,{blade:je(),itemProps:g.fromObject({selected:!1,title:t.title}),props:g.fromObject({selected:!1}),viewProps:Dt.create()}),n=this.pool_.createApi(s);return this.rackApi_.add(n,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new ir(this,t.rawValue))}},xr=class extends ci{get title(){var t;return(t=this.controller.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,s){return this.rackApi_.addBinding(t,e,s)}addBlade(t){return this.rackApi_.addBlade(t)}},Ul=-1,Cr=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=V(!0),this.selectedIndex=V(Ul),this.items_=[]}add(t,e){let s=e??this.items_.length;this.items_.splice(s,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){let e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ul,this.empty.rawValue=!0;return}let t=this.items_.findIndex(e=>e.rawValue);t<0?(this.items_.forEach((e,s)=>{e.rawValue=s===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,s)=>{e.rawValue=s===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){let e=this.items_.findIndex(s=>s===t.sender);this.items_.forEach((s,n)=>{s.rawValue=n===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}},ri=w("tab"),yr=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ri(),fc()),e.viewProps.bindClassModifiers(this.element),Rt(e.empty,Ue(this.element,ri(void 0,"nop")));let s=t.createElement("div");s.classList.add(ri("t")),this.element.appendChild(s),this.itemsElement=s;let n=t.createElement("div");n.classList.add(ri("i")),this.element.appendChild(n);let r=t.createElement("div");r.classList.add(ri("c")),this.element.appendChild(r),this.contentsElement=r}},Ts=class extends ui{constructor(t,e){let s=new Cr,n=new yr(t,{empty:s.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new hi({blade:e.blade,element:n.contentsElement,viewProps:e.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=s}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;let e=t.bladeController;pc(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;let e=t.bladeController;Eo(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}},bc=X({id:"tab",type:"blade",accept(i){let t=A(i,e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")}));return!t||t.pages.length===0?null:{params:t}},controller(i){let t=new Ts(i.document,{blade:i.blade,viewProps:i.viewProps});return i.params.pages.forEach(e=>{let s=new mi(i.document,{blade:je(),itemProps:g.fromObject({selected:!1,title:e.title}),props:g.fromObject({selected:!1}),viewProps:Dt.create()});t.add(s)}),t},api(i){return i.controller instanceof Ts?new wr(i.controller,i.pool):i.controller instanceof mi?new xr(i.controller,i.pool):null}});function fp(i,t){let e=i.accept(t.params);if(!e)return null;let s=A(t.params,n=>({disabled:n.optional.boolean,hidden:n.optional.boolean}));return i.controller({blade:je(),document:t.document,params:Object.assign(Object.assign({},e.params),{disabled:s?.disabled,hidden:s?.hidden}),viewProps:Dt.create({disabled:s?.disabled,hidden:s?.hidden})})}var vi=class extends ve{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}},Er=class{constructor(){this.disabled=!1,this.emitter=new L}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},Pr=class{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new L,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;let t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},fe=class{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((e,s)=>s.constrain(e),t)}};function As(i,t){if(i instanceof t)return i;if(i instanceof fe){let e=i.constraints.reduce((s,n)=>s||(n instanceof t?n:null),null);if(e)return e}return null}var be=class{constructor(t){this.values=g.fromObject({options:t})}constrain(t){let e=this.values.get("options");return e.length===0||e.filter(n=>n.value===t).length>0?t:e[0].value}};function Ei(i){var t;let e=rr;if(Array.isArray(i))return(t=A({items:i},s=>({items:s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))})))===null||t===void 0?void 0:t.items;if(typeof i=="object")return e.required.raw(i).value}function So(i){if(Array.isArray(i))return i;let t=[];return Object.keys(i).forEach(e=>{t.push({text:e,value:i[e]})}),t}function Vo(i){return S(i)?null:new be(So(i))}var In=w("lst"),kr=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(In()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("select");s.classList.add(In("s")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.selectElement=s;let n=t.createElement("div");n.classList.add(In("m")),n.appendChild(Bs(t,"dropdown")),this.element.appendChild(n),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,xt(this.props_,"options",r=>{dc(this.selectElement),r.forEach(o=>{let a=t.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){let t=this.props_.get("options").map(e=>e.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Ct=class{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new kr(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){let e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return tt(t,null,e=>({options:e.required.custom(Ei)}),e=>(this.props.set("options",So(e.options)),!0))}exportProps(){return et(null,{options:this.props.get("options")})}},Il=w("pop"),Sr=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Il()),e.viewProps.bindClassModifiers(this.element),Rt(e.shows,Ue(this.element,Il(void 0,"v")))}},Rs=class{constructor(t,e){this.shows=V(!1),this.viewProps=e.viewProps,this.view=new Sr(t,{shows:this.shows,viewProps:this.viewProps})}},jl=w("txt"),Vr=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(jl()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);let s=t.createElement("input");s.classList.add(jl("i")),s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}},_e=class{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Vr(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let s=t.currentTarget.value,n=this.parser_(s);S(n)||(this.value.rawValue=n),this.view.refresh()}};function bp(i){return String(i)}function _c(i){return i==="false"?!1:!!i}function zl(i){return bp(i)}function _p(i){return t=>i.reduce((e,s)=>e!==null?e:s(t),null)}var gp=J(0);function Ls(i){return gp(i)+"%"}function gc(i){return String(i)}function Tr(i){return i}function ze({primary:i,secondary:t,forward:e,backward:s}){let n=!1;function r(o){n||(n=!0,o(),n=!1)}i.emitter.on("change",o=>{r(()=>{t.setRawValue(e(i.rawValue,t.rawValue),o.options)})}),t.emitter.on("change",o=>{r(()=>{i.setRawValue(s(i.rawValue,t.rawValue),o.options)}),r(()=>{t.setRawValue(e(i.rawValue,t.rawValue),o.options)})}),r(()=>{t.setRawValue(e(i.rawValue,t.rawValue),{forceEmit:!1,last:!0})})}function W(i,t){let e=i*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function fi(i){return{altKey:i.altKey,downKey:i.key==="ArrowDown",shiftKey:i.shiftKey,upKey:i.key==="ArrowUp"}}function Bt(i){return{altKey:i.altKey,downKey:i.key==="ArrowLeft",shiftKey:i.shiftKey,upKey:i.key==="ArrowRight"}}function wp(i){return i==="ArrowUp"||i==="ArrowDown"}function wc(i){return wp(i)||i==="ArrowLeft"||i==="ArrowRight"}function jn(i,t){var e,s;let n=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:i.pageX-(((e=n&&n.scrollX)!==null&&e!==void 0?e:0)+r.left),y:i.pageY-(((s=n&&n.scrollY)!==null&&s!==void 0?s:0)+r.top)}}var Ot=class{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new L,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){let e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();let s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(jn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(jn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){let e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(jn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();let e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){let e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;let s=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(s?{x:s.clientX-n.left,y:s.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey})}},ot=w("txt"),Ar=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(ot(),ot(void 0,"num")),e.arrayPosition&&this.element.classList.add(ot(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("input");s.classList.add(ot("i")),s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ot()),this.inputElement.classList.add(ot("i"));let n=t.createElement("div");n.classList.add(ot("k")),this.element.appendChild(n),this.knobElement=n;let r=t.createElementNS(gt,"svg");r.classList.add(ot("g")),this.knobElement.appendChild(r);let o=t.createElementNS(gt,"path");o.classList.add(ot("gb")),r.appendChild(o),this.guideBodyElem_=o;let a=t.createElementNS(gt,"path");a.classList.add(ot("gh")),r.appendChild(a),this.guideHeadElem_=a;let l=t.createElement("div");l.classList.add(w("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(ot(void 0,"drg"));return}this.element.classList.add(ot(void 0,"drg"));let e=t.rawValue/this.props_.get("pointerScale"),s=e+(e>0?-1:e<0?1:0),n=I(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+n},0 L${s},4 L${s+n},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);let r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}},ge=class{constructor(t,e){var s;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=(s=e.sliderProps)!==null&&s!==void 0?s:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=V(null),this.view=new Ar(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let n=new Ot(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,s;let n=(e=this.sliderProps_)===null||e===void 0?void 0:e.get("min"),r=(s=this.sliderProps_)===null||s===void 0?void 0:s.get("max"),o=t;return n!==void 0&&(o=Math.max(o,n)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(t){let s=t.currentTarget.value,n=this.parser_(s);S(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(t){let e=W(this.props.get("keyScale"),fi(t));e!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){W(this.props.get("keyScale"),fi(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;let e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}},zn=w("sld"),Rr=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(zn()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(zn("t")),e.viewProps.bindTabIndex(s),this.element.appendChild(s),this.trackElement=s;let n=t.createElement("div");n.classList.add(zn("k")),this.trackElement.appendChild(n),this.knobElement=n,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){let t=I(y(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}},Lr=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Rr(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ot(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(y(I(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=W(this.props.get("keyScale"),Bt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){W(this.props.get("keyScale"),Bt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Nn=w("sldtxt"),Fr=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Nn());let s=t.createElement("div");s.classList.add(Nn("s")),this.sliderView_=e.sliderView,s.appendChild(this.sliderView_.element),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(Nn("t")),this.textView_=e.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}},Be=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Lr(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new ge(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new Fr(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return tt(t,null,e=>({max:e.required.number,min:e.required.number}),e=>{let s=this.sliderC_.props;return s.set("max",e.max),s.set("min",e.min),!0})}exportProps(){let t=this.sliderC_.props;return et(null,{max:t.get("max"),min:t.get("min")})}};function xc(i){return{sliderProps:new g({keyScale:i.keyScale,max:i.max,min:i.min}),textProps:new g({formatter:V(i.formatter),keyScale:i.keyScale,pointerScale:V(i.pointerScale)})}}var xp={containerUnitSize:"cnt-usz"};function Cc(i){return`--${xp[i]}`}function bi(i){return uc(i)}function Xt(i){if(Gn(i))return A(i,bi)}function At(i,t){if(!i)return;let e=[],s=ac(i,t);s&&e.push(s);let n=lc(i);return n&&e.push(n),new fe(e)}function Cp(i){return i?i.major===Ie.major:!1}function yc(i){if(i==="inline"||i==="popup")return i}function Pi(i,t){i.write(t)}var _s=w("ckb"),Mr=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(_s()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("label");s.classList.add(_s("l")),this.element.appendChild(s),this.labelElement=s;let n=t.createElement("input");n.classList.add(_s("i")),n.type="checkbox",this.labelElement.appendChild(n),this.inputElement=n,e.viewProps.bindDisabled(this.inputElement);let r=t.createElement("div");r.classList.add(_s("w")),this.labelElement.appendChild(r);let o=Bs(t,"check");r.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},Dr=class{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Mr(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){let e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}};function yp(i){let t=[],e=Vo(i.options);return e&&t.push(e),new fe(t)}var Ep=X({id:"input-bool",type:"input",accept:(i,t)=>{if(typeof i!="boolean")return null;let e=A(t,s=>({options:s.optional.custom(Ei),readonly:s.optional.constant(!1)}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>_c,constraint:i=>yp(i.params),writer:i=>Pi},controller:i=>{let t=i.document,e=i.value,s=i.constraint,n=s&&As(s,be);return n?new Ct(t,{props:new g({options:n.values.value("options")}),value:e,viewProps:i.viewProps}):new Dr(t,{value:e,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="boolean"?null:i.controller.valueController instanceof Ct?new vi(i.controller):null}}),ue=w("col"),Br=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ue()),e.foldable.bindExpandedClass(this.element,ue(void 0,"expanded")),xt(e.foldable,"completed",Ue(this.element,ue(void 0,"cpl")));let s=t.createElement("div");s.classList.add(ue("h")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(ue("s")),s.appendChild(n),this.swatchElement=n;let r=t.createElement("div");if(r.classList.add(ue("t")),s.appendChild(r),this.textElement=r,e.pickerLayout==="inline"){let o=t.createElement("div");o.classList.add(ue("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Pp(i,t,e){let s=I(i/255,0,1),n=I(t/255,0,1),r=I(e/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a,c=0,u=0,h=(a+o)/2;return l!==0&&(u=l/(1-Math.abs(o+a-1)),s===o?c=(n-r)/l:n===o?c=2+(r-s)/l:c=4+(s-n)/l,c=c/6+(c<0?1:0)),[c*360,u*100,h*100]}function kp(i,t,e){let s=(i%360+360)%360,n=I(t/100,0,1),r=I(e/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o/2,c,u,h;return s>=0&&s<60?[c,u,h]=[o,a,0]:s>=60&&s<120?[c,u,h]=[a,o,0]:s>=120&&s<180?[c,u,h]=[0,o,a]:s>=180&&s<240?[c,u,h]=[0,a,o]:s>=240&&s<300?[c,u,h]=[a,0,o]:[c,u,h]=[o,0,a],[(c+l)*255,(u+l)*255,(h+l)*255]}function Sp(i,t,e){let s=I(i/255,0,1),n=I(t/255,0,1),r=I(e/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a,c;l===0?c=0:o===s?c=60*(((n-r)/l%6+6)%6):o===n?c=60*((r-s)/l+2):c=60*((s-n)/l+4);let u=o===0?0:l/o,h=o;return[c,u*100,h*100]}function Ec(i,t,e){let s=nc(i,360),n=I(t/100,0,1),r=I(e/100,0,1),o=r*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o,c,u,h;return s>=0&&s<60?[c,u,h]=[o,a,0]:s>=60&&s<120?[c,u,h]=[a,o,0]:s>=120&&s<180?[c,u,h]=[0,o,a]:s>=180&&s<240?[c,u,h]=[0,a,o]:s>=240&&s<300?[c,u,h]=[a,0,o]:[c,u,h]=[o,0,a],[(c+l)*255,(u+l)*255,(h+l)*255]}function Vp(i,t,e){let s=e+t*(100-Math.abs(2*e-100))/200;return[i,s!==0?t*(100-Math.abs(2*e-100))/s:0,e+t*(100-Math.abs(2*e-100))/200]}function Tp(i,t,e){let s=100-Math.abs(e*(200-t)/100-100);return[i,s!==0?t*e/s:0,e*(200-t)/200]}function yt(i){return[i[0],i[1],i[2]]}function Os(i,t){return[i[0],i[1],i[2],t]}var Ap={hsl:{hsl:(i,t,e)=>[i,t,e],hsv:Vp,rgb:kp},hsv:{hsl:Tp,hsv:(i,t,e)=>[i,t,e],rgb:Ec},rgb:{hsl:Pp,hsv:Sp,rgb:(i,t,e)=>[i,t,e]}};function Oe(i,t){return[t==="float"?1:i==="rgb"?255:360,t==="float"?1:i==="rgb"?255:100,t==="float"?1:i==="rgb"?255:100]}function Rp(i,t){return i===t?t:nc(i,t)}function Pc(i,t,e){var s;let n=Oe(t,e);return[t==="rgb"?I(i[0],0,n[0]):Rp(i[0],n[0]),I(i[1],0,n[1]),I(i[2],0,n[2]),I((s=i[3])!==null&&s!==void 0?s:1,0,1)]}function Nl(i,t,e,s){let n=Oe(t,e),r=Oe(t,s);return i.map((o,a)=>o/n[a]*r[a])}function kc(i,t,e){let s=Nl(i,t.mode,t.type,"int"),n=Ap[t.mode][e.mode](...s);return Nl(n,e.mode,"int",e.type)}var x=class i{static black(){return new i([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Pc(t,e,this.type)}getComponents(t){return Os(kc(yt(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}},qt=w("colp"),Or=class{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(qt()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(qt("hsv"));let n=t.createElement("div");n.classList.add(qt("sv")),this.svPaletteView_=e.svPaletteView,n.appendChild(this.svPaletteView_.element),s.appendChild(n);let r=t.createElement("div");r.classList.add(qt("h")),this.hPaletteView_=e.hPaletteView,r.appendChild(this.hPaletteView_.element),s.appendChild(r),this.element.appendChild(s);let o=t.createElement("div");if(o.classList.add(qt("rgb")),this.textsView_=e.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};let a=t.createElement("div");a.classList.add(qt("a"));let l=t.createElement("div");l.classList.add(qt("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);let c=t.createElement("div");c.classList.add(qt("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){let t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(e=>e.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}};function Lp(i){return i==="int"?"int":i==="float"?"float":void 0}function To(i){return A(i,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Lp)}),expanded:t.optional.boolean,picker:t.optional.custom(yc),readonly:t.optional.constant(!1)}))}function we(i){return i?.1:1}function Sc(i){var t;return(t=i.color)===null||t===void 0?void 0:t.type}var _i=class{constructor(t,e){this.type="float",this.mode=e,this.comps_=Pc(t,e,this.type)}getComponents(t){return Os(kc(yt(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}},Fp={int:(i,t)=>new x(i,t),float:(i,t)=>new _i(i,t)};function Ao(i,t,e){return Fp[e](i,t)}function Mp(i){return i.type==="float"}function Dp(i){return i.type==="int"}function Bp(i){let t=i.getComponents(),e=Oe(i.mode,"int");return new x([Math.round(y(t[0],0,1,0,e[0])),Math.round(y(t[1],0,1,0,e[1])),Math.round(y(t[2],0,1,0,e[2])),t[3]],i.mode)}function Op(i){let t=i.getComponents(),e=Oe(i.mode,"int");return new _i([y(t[0],0,e[0],0,1),y(t[1],0,e[1],0,1),y(t[2],0,e[2],0,1),t[3]],i.mode)}function H(i,t){if(i.type===t)return i;if(Dp(i)&&t==="float")return Op(i);if(Mp(i)&&t==="int")return Bp(i);throw j.shouldNeverHappen()}function Up(i,t){return i.alpha===t.alpha&&i.mode===t.mode&&i.notation===t.notation&&i.type===t.type}function at(i,t){let e=i.match(/^(.+)%$/);return Math.min(e?parseFloat(e[1])*.01*t:parseFloat(i),t)}var Ip={deg:i=>i,grad:i=>i*360/400,rad:i=>i*360/(2*Math.PI),turn:i=>i*360};function Vc(i){let t=i.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(i);let e=parseFloat(t[1]),s=t[2];return Ip[s](e)}function Tc(i){let t=i.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[at(t[1],255),at(t[2],255),at(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function jp(i){let t=Tc(i);return t?new x(t,"rgb"):null}function Ac(i){let t=i.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[at(t[1],255),at(t[2],255),at(t[3],255),at(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function zp(i){let t=Ac(i);return t?new x(t,"rgb"):null}function Rc(i){let t=i.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Vc(t[1]),at(t[2],100),at(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Np(i){let t=Rc(i);return t?new x(t,"hsl"):null}function Lc(i){let t=i.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Vc(t[1]),at(t[2],100),at(t[3],100),at(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Kp(i){let t=Lc(i);return t?new x(t,"hsl"):null}function Fc(i){let t=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];let e=i.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function $p(i){let t=Fc(i);return t?new x(t,"rgb"):null}function Mc(i){let t=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),y(parseInt(t[4]+t[4],16),0,255,0,1)];let e=i.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),y(parseInt(e[4],16),0,255,0,1)]:null}function qp(i){let t=Mc(i);return t?new x(t,"rgb"):null}function Dc(i){let t=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Kl(i){return t=>{let e=Dc(t);return e?Ao(e,"rgb",i):null}}function Bc(i){let t=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function $l(i){return t=>{let e=Bc(t);return e?Ao(e,"rgb",i):null}}var Gp=[{parser:Fc,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Mc,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Tc,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ac,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Rc,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Lc,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Dc,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Bc,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Hp(i){return Gp.reduce((t,{parser:e,result:s})=>t||(e(i)?s:null),null)}function Xp(i,t="int"){let e=Hp(i);return e?e.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},e),{type:"int"}):e.notation==="func"?Object.assign(Object.assign({},e),{type:t}):null:null}function ki(i){let t=[$p,qp,jp,zp,Np,Kp];i==="int"&&t.push(Kl("int"),$l("int")),i==="float"&&t.push(Kl("float"),$l("float"));let e=_p(t);return s=>{let n=e(s);return n?H(n,i):null}}function Yp(i){let t=ki("int");if(typeof i!="string")return x.black();let e=t(i);return e??x.black()}function Oc(i){let t=I(Math.floor(i),0,255).toString(16);return t.length===1?`0${t}`:t}function Ro(i,t="#"){let e=yt(i.getComponents("rgb")).map(Oc).join("");return`${t}${e}`}function Lo(i,t="#"){let e=i.getComponents("rgb"),s=[e[0],e[1],e[2],e[3]*255].map(Oc).join("");return`${t}${s}`}function Uc(i){let t=J(0),e=H(i,"int");return`rgb(${yt(e.getComponents("rgb")).map(n=>t(n)).join(", ")})`}function gs(i){let t=J(2),e=J(0);return`rgba(${H(i,"int").getComponents("rgb").map((r,o)=>(o===3?t:e)(r)).join(", ")})`}function Qp(i){let t=[J(0),Ls,Ls],e=H(i,"int");return`hsl(${yt(e.getComponents("hsl")).map((n,r)=>t[r](n)).join(", ")})`}function Wp(i){let t=[J(0),Ls,Ls,J(2)];return`hsla(${H(i,"int").getComponents("hsl").map((n,r)=>t[r](n)).join(", ")})`}function Ic(i,t){let e=J(t==="float"?2:0),s=["r","g","b"],n=H(i,t);return`{${yt(n.getComponents("rgb")).map((o,a)=>`${s[a]}: ${e(o)}`).join(", ")}}`}function Jp(i){return t=>Ic(t,i)}function jc(i,t){let e=J(2),s=J(t==="float"?2:0),n=["r","g","b","a"];return`{${H(i,t).getComponents("rgb").map((a,l)=>{let c=l===3?e:s;return`${n[l]}: ${c(a)}`}).join(", ")}}`}function Zp(i){return t=>jc(t,i)}var td=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ro},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Lo},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Uc},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:gs},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Qp},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Wp},...["int","float"].reduce((i,t)=>[...i,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:Jp(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Zp(t)}],[])];function zc(i){return td.reduce((t,e)=>t||(Up(e.format,i)?e.stringifier:null),null)}var oi=w("apl"),Ur=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(oi()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("div");s.classList.add(oi("b")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(oi("c")),s.appendChild(n),this.colorElem_=n;let r=t.createElement("div");r.classList.add(oi("m")),this.element.appendChild(r),this.markerElem_=r;let o=t.createElement("div");o.classList.add(oi("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){let t=this.value.rawValue,e=t.getComponents("rgb"),s=new x([e[0],e[1],e[2],0],"rgb"),n=new x([e[0],e[1],e[2],255],"rgb"),r=["to right",gs(s),gs(n)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=gs(t);let o=y(e[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},Ir=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ur(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ot(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=t.point.x/t.bounds.width,n=this.value.rawValue,[r,o,a]=n.getComponents("hsv");this.value.setRawValue(new x([r,o,a,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=W(we(!0),Bt(t));if(e===0)return;let s=this.value.rawValue,[n,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new x([n,r,o,a+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){W(we(!0),Bt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Le=w("coltxt");function ed(i){let t=i.createElement("select"),e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return t.appendChild(e.reduce((s,n)=>{let r=i.createElement("option");return r.textContent=n.text,r.value=n.value,s.appendChild(r),s},i.createDocumentFragment())),t}var jr=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Le()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Le("m")),this.modeElem_=ed(t),this.modeElem_.classList.add(Le("ms")),s.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);let n=t.createElement("div");n.classList.add(Le("mm")),n.appendChild(Bs(t,"dropdown")),s.appendChild(n),this.element.appendChild(s);let r=t.createElement("div");r.classList.add(Le("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=e.inputViews,this.applyInputViews_(),Rt(e.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){dc(this.inputsElem_);let t=this.element.ownerDocument;this.inputViews_.forEach(e=>{let s=t.createElement("div");s.classList.add(Le("c")),s.appendChild(e.element),this.inputsElem_.appendChild(s)})}};function id(i){return J(i==="float"?2:0)}function sd(i,t,e){let s=Oe(i,t)[e];return new de({min:0,max:s})}function nd(i,t,e){return new ge(i,{arrayPosition:e===0?"fst":e===2?"lst":"mid",parser:t.parser,props:g.fromObject({formatter:id(t.colorType),keyScale:we(!1),pointerScale:t.colorType==="float"?.01:1}),value:V(0,{constraint:sd(t.colorMode,t.colorType,e)}),viewProps:t.viewProps})}function rd(i,t){let e={colorMode:t.colorMode,colorType:t.colorType,parser:Lt,viewProps:t.viewProps};return[0,1,2].map(s=>{let n=nd(i,e,s);return ze({primary:t.value,secondary:n.value,forward(r){return H(r,t.colorType).getComponents(t.colorMode)[s]},backward(r,o){let a=t.colorMode,c=H(r,t.colorType).getComponents(a);c[s]=o;let u=Ao(Os(yt(c),c[3]),a,t.colorType);return H(u,"int")}}),n})}function od(i,t){let e=new _e(i,{parser:ki("int"),props:g.fromObject({formatter:Ro}),value:V(x.black()),viewProps:t.viewProps});return ze({primary:t.value,secondary:e.value,forward:s=>new x(yt(s.getComponents()),s.mode),backward:(s,n)=>new x(Os(yt(n.getComponents(s.mode)),s.getComponents()[3]),s.mode)}),[e]}function ad(i){return i!=="hex"}var zr=class{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=V(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new jr(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){let e=this.colorMode.rawValue;return ad(e)?rd(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):od(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){let e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(s=>s.view)}},Kn=w("hpl"),Nr=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Kn()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("div");s.classList.add(Kn("c")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(Kn("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){let t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Uc(new x([e,100,100],"hsv"));let s=y(e,0,360,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}},Kr=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Nr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ot(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=y(I(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),n=this.value.rawValue,[,r,o,a]=n.getComponents("hsv");this.value.setRawValue(new x([s,r,o,a],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=W(we(!1),Bt(t));if(e===0)return;let s=this.value.rawValue,[n,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new x([n+e,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){W(we(!1),Bt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},$n=w("svp"),ql=64,$r=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add($n()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("canvas");s.height=ql,s.width=ql,s.classList.add($n("c")),this.element.appendChild(s),this.canvasElement=s;let n=t.createElement("div");n.classList.add($n("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){let t=qh(this.canvasElement);if(!t)return;let s=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,o=t.getImageData(0,0,n,r),a=o.data;for(let u=0;u<r;u++)for(let h=0;h<n;h++){let p=y(h,0,n,0,100),d=y(u,0,r,100,0),m=Ec(s[0],p,d),v=(u*n+h)*4;a[v]=m[0],a[v+1]=m[1],a[v+2]=m[2],a[v+3]=255}t.putImageData(o,0,0);let l=y(s[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;let c=y(s[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}},qr=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new $r(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ot(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=y(t.point.x,0,t.bounds.width,0,100),n=y(t.point.y,0,t.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new x([r,s,n,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){wc(t.key)&&t.preventDefault();let[e,s,n,r]=this.value.rawValue.getComponents("hsv"),o=we(!1),a=W(o,Bt(t)),l=W(o,fi(t));a===0&&l===0||this.value.setRawValue(new x([e,s+a,n+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){let e=we(!1),s=W(e,Bt(t)),n=W(e,fi(t));s===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Gr=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Kr(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new qr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Ir(t,{value:this.value,viewProps:this.viewProps}),text:new ge(t,{parser:Lt,props:g.fromObject({pointerScale:.01,keyScale:.1,formatter:J(2)}),value:V(0,{constraint:new de({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ze({primary:this.value,secondary:this.alphaIcs_.text.value,forward:s=>s.getComponents()[3],backward:(s,n)=>{let r=s.getComponents();return r[3]=n,new x(r,s.mode)}}),this.textsC_=new zr(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Or(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}},qn=w("colsw"),Hr=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(qn()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(qn("sw")),this.element.appendChild(s),this.swatchElem_=s;let n=t.createElement("button");n.classList.add(qn("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){let t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Lo(t)}onValueChange_(){this.update_()}},Xr=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Hr(t,{value:this.value,viewProps:this.viewProps})}},gi=class{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=pi.create(e.expanded),this.swatchC_=new Xr(t,{value:this.value,viewProps:this.viewProps});let s=this.swatchC_.view.buttonElement;s.addEventListener("blur",this.onButtonBlur_),s.addEventListener("click",this.onButtonClick_),this.textC_=new _e(t,{parser:e.parser,props:g.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Br(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Rs(t,{viewProps:this.viewProps}):null;let n=new Gr(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),ze({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ko(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,s=t.relatedTarget;(!s||!e.contains(s))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,s=mc(t);s&&e.contains(s)||s&&s===this.swatchC_.view.buttonElement&&!yo(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function ld(i){return yt(i.getComponents("rgb")).reduce((t,e)=>t<<8|Math.floor(e)&255,0)}function cd(i){return i.getComponents("rgb").reduce((t,e,s)=>{let n=Math.floor(s===3?e*255:e)&255;return t<<8|n},0)>>>0}function ud(i){return new x([i>>16&255,i>>8&255,i&255],"rgb")}function hd(i){return new x([i>>24&255,i>>16&255,i>>8&255,y(i&255,0,255,0,1)],"rgb")}function pd(i){return typeof i!="number"?x.black():ud(i)}function dd(i){return typeof i!="number"?x.black():hd(i)}function ws(i,t){return typeof i!="object"||S(i)?!1:t in i&&typeof i[t]=="number"}function Nc(i){return ws(i,"r")&&ws(i,"g")&&ws(i,"b")}function Kc(i){return Nc(i)&&ws(i,"a")}function $c(i){return Nc(i)}function Fo(i,t){if(i.mode!==t.mode||i.type!==t.type)return!1;let e=i.getComponents(),s=t.getComponents();for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function Gl(i){return"a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b]}function md(i){let t=zc(i);return t?(e,s)=>{Pi(e,t(s))}:null}function vd(i){let t=i?cd:ld;return(e,s)=>{Pi(e,t(s))}}function fd(i,t,e){let n=H(t,e).toRgbaObject();i.writeProperty("r",n.r),i.writeProperty("g",n.g),i.writeProperty("b",n.b),i.writeProperty("a",n.a)}function bd(i,t,e){let n=H(t,e).toRgbaObject();i.writeProperty("r",n.r),i.writeProperty("g",n.g),i.writeProperty("b",n.b)}function _d(i,t){return(e,s)=>{i?fd(e,s,t):bd(e,s,t)}}function gd(i){var t;return!!(!((t=i?.color)===null||t===void 0)&&t.alpha)}function wd(i){return i?t=>Lo(t,"0x"):t=>Ro(t,"0x")}function xd(i){return"color"in i||i.view==="color"}var Cd=X({id:"input-color-number",type:"input",accept:(i,t)=>{if(typeof i!="number"||!xd(t))return null;let e=To(t);return e?{initialValue:i,params:Object.assign(Object.assign({},e),{supportsAlpha:gd(t)})}:null},binding:{reader:i=>i.params.supportsAlpha?dd:pd,equals:Fo,writer:i=>vd(i.params.supportsAlpha)},controller:i=>{var t,e;return new gi(i.document,{colorType:"int",expanded:(t=i.params.expanded)!==null&&t!==void 0?t:!1,formatter:wd(i.params.supportsAlpha),parser:ki("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:i.params.supportsAlpha,value:i.value,viewProps:i.viewProps})}});function yd(i,t){if(!$c(i))return H(x.black(),t);if(t==="int"){let e=Gl(i);return new x(e,"rgb")}if(t==="float"){let e=Gl(i);return new _i(e,"rgb")}return H(x.black(),"int")}function Ed(i){return Kc(i)}function Pd(i){return t=>{let e=yd(t,i);return H(e,"int")}}function kd(i,t){return e=>i?jc(e,t):Ic(e,t)}var Sd=X({id:"input-color-object",type:"input",accept:(i,t)=>{var e;if(!$c(i))return null;let s=To(t);return s?{initialValue:i,params:Object.assign(Object.assign({},s),{colorType:(e=Sc(t))!==null&&e!==void 0?e:"int"})}:null},binding:{reader:i=>Pd(i.params.colorType),equals:Fo,writer:i=>_d(Ed(i.initialValue),i.params.colorType)},controller:i=>{var t,e;let s=Kc(i.initialValue);return new gi(i.document,{colorType:i.params.colorType,expanded:(t=i.params.expanded)!==null&&t!==void 0?t:!1,formatter:kd(s,i.params.colorType),parser:ki("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:s,value:i.value,viewProps:i.viewProps})}}),Vd=X({id:"input-color-string",type:"input",accept:(i,t)=>{if(typeof i!="string"||t.view==="text")return null;let e=Xp(i,Sc(t));if(!e)return null;let s=zc(e);if(!s)return null;let n=To(t);return n?{initialValue:i,params:Object.assign(Object.assign({},n),{format:e,stringifier:s})}:null},binding:{reader:()=>Yp,equals:Fo,writer:i=>{let t=md(i.params.format);if(!t)throw j.notBindable();return t}},controller:i=>{var t,e;return new gi(i.document,{colorType:i.params.format.type,expanded:(t=i.params.expanded)!==null&&t!==void 0?t:!1,formatter:i.params.stringifier,parser:ki("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:i.params.format.alpha,value:i.value,viewProps:i.viewProps})}}),wi=class{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){let e=this.asm_.toComponents(t).map((s,n)=>{var r,o;return(o=(r=this.components[n])===null||r===void 0?void 0:r.constrain(s))!==null&&o!==void 0?o:s});return this.asm_.fromComponents(e)}},Hl=w("pndtxt"),Yr=class{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Hl()),this.textViews.forEach(s=>{let n=t.createElement("div");n.classList.add(Hl("a")),n.appendChild(s.element),this.element.appendChild(n)})}};function Td(i,t,e){return new ge(i,{arrayPosition:e===0?"fst":e===t.axes.length-1?"lst":"mid",parser:t.parser,props:t.axes[e].textProps,value:V(0,{constraint:t.axes[e].constraint}),viewProps:t.viewProps})}var xi=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((s,n)=>Td(t,e,n)),this.acs_.forEach((s,n)=>{ze({primary:this.value,secondary:s.value,forward:r=>e.assembly.toComponents(r)[n],backward:(r,o)=>{let a=e.assembly.toComponents(r);return a[n]=o,e.assembly.fromComponents(a)}})}),this.view=new Yr(t,{textViews:this.acs_.map(s=>s.view)})}get textControllers(){return this.acs_}},Qr=class extends ve{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}};function Ad(i,t){let e=[],s=ac(i,t);s&&e.push(s);let n=lc(i);n&&e.push(n);let r=Vo(i.options);return r&&e.push(r),new fe(e)}var Rd=X({id:"input-number",type:"input",accept:(i,t)=>{if(typeof i!="number")return null;let e=A(t,s=>Object.assign(Object.assign({},uc(s)),{options:s.optional.custom(Ei),readonly:s.optional.constant(!1)}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>sc,constraint:i=>Ad(i.params,i.initialValue),writer:i=>Pi},controller:i=>{let t=i.value,e=i.constraint,s=e&&As(e,be);if(s)return new Ct(i.document,{props:new g({options:s.values.value("options")}),value:t,viewProps:i.viewProps});let n=cc(i.params,t.rawValue),r=e&&As(e,de);return r?new Be(i.document,Object.assign(Object.assign({},xc(Object.assign(Object.assign({},n),{keyScale:V(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Lt,value:t,viewProps:i.viewProps})):new ge(i.document,{parser:Lt,props:g.fromObject(n),value:t,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="number"?null:i.controller.valueController instanceof Be?new Qr(i.controller):i.controller.valueController instanceof Ct?new vi(i.controller):null}}),wt=class{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(S(t))return!1;let e=t.x,s=t.y;return!(typeof e!="number"||typeof s!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}},qc={toComponents:i=>i.getComponents(),fromComponents:i=>new wt(...i)},Fe=w("p2d"),Wr=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Fe()),e.viewProps.bindClassModifiers(this.element),Rt(e.expanded,Ue(this.element,Fe(void 0,"expanded")));let s=t.createElement("div");s.classList.add(Fe("h")),this.element.appendChild(s);let n=t.createElement("button");n.classList.add(Fe("b")),n.appendChild(Bs(t,"p2dpad")),e.viewProps.bindDisabled(n),s.appendChild(n),this.buttonElement=n;let r=t.createElement("div");if(r.classList.add(Fe("t")),s.appendChild(r),this.textElement=r,e.pickerLayout==="inline"){let o=t.createElement("div");o.classList.add(Fe("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}},Gt=w("p2dp"),Jr=class{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(Gt()),e.layout==="popup"&&this.element.classList.add(Gt(void 0,"p")),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Gt("p")),e.viewProps.bindTabIndex(s),this.element.appendChild(s),this.padElement=s;let n=t.createElementNS(gt,"svg");n.classList.add(Gt("g")),this.padElement.appendChild(n),this.svgElem_=n;let r=t.createElementNS(gt,"line");r.classList.add(Gt("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);let o=t.createElementNS(gt,"line");o.classList.add(Gt("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);let a=t.createElementNS(gt,"line");a.classList.add(Gt("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;let l=t.createElement("div");l.classList.add(Gt("m")),this.padElement.appendChild(l),this.markerElem_=l,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[t,e]=this.value.rawValue.getComponents(),s=this.props_.get("max"),n=y(t,-s,+s,0,100),r=y(e,-s,+s,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function Xl(i,t,e){return[W(t[0],Bt(i)),W(t[1],fi(i))*(e?1:-1)]}var Zr=class{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Jr(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ot(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=this.props.get("max"),n=y(t.point.x,0,t.bounds.width,-s,+s),r=y(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-s,+s);this.value.setRawValue(new wt(n,r),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){wc(t.key)&&t.preventDefault();let[e,s]=Xl(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&s===0||this.value.setRawValue(new wt(this.value.rawValue.x+e,this.value.rawValue.y+s),{forceEmit:!1,last:!1})}onPadKeyUp_(t){let[e,s]=Xl(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},to=class{constructor(t,e){var s,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=pi.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Rs(t,{viewProps:this.viewProps}):null;let r=new Zr(t,{layout:e.pickerLayout,props:new g({invertsY:V(e.invertsY),max:V(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new xi(t,{assembly:qc,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Wr(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("blur",this.onPadButtonBlur_),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ze({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ko(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,s=t.relatedTarget;(!s||!e.contains(s))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,s=mc(t);s&&e.contains(s)||s&&s===this.view.buttonElement&&!yo(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}};function Ld(i){return wt.isObject(i)?new wt(i.x,i.y):new wt}function Fd(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y)}function Md(i,t){return new wi({assembly:qc,components:[At(Object.assign(Object.assign({},i),i.x),t.x),At(Object.assign(Object.assign({},i),i.y),t.y)]})}function Yl(i,t){var e,s;if(!S(i.min)||!S(i.max))return Math.max(Math.abs((e=i.min)!==null&&e!==void 0?e:0),Math.abs((s=i.max)!==null&&s!==void 0?s:0));let n=rc(i);return Math.max(Math.abs(n)*10,Math.abs(t)*10)}function Dd(i,t){var e,s;let n=Yl(pe(i,(e=i.x)!==null&&e!==void 0?e:{}),t.x),r=Yl(pe(i,(s=i.y)!==null&&s!==void 0?s:{}),t.y);return Math.max(n,r)}function Bd(i){if(!("y"in i))return!1;let t=i.y;return t&&"inverted"in t?!!t.inverted:!1}var Od=X({id:"input-point2d",type:"input",accept:(i,t)=>{if(!wt.isObject(i))return null;let e=A(t,s=>Object.assign(Object.assign({},bi(s)),{expanded:s.optional.boolean,picker:s.optional.custom(yc),readonly:s.optional.constant(!1),x:s.optional.custom(Xt),y:s.optional.object(Object.assign(Object.assign({},bi(s)),{inverted:s.optional.boolean}))}));return e?{initialValue:i,params:e}:null},binding:{reader:()=>Ld,constraint:i=>Md(i.params,i.initialValue),equals:wt.equals,writer:()=>Fd},controller:i=>{var t,e;let s=i.document,n=i.value,r=i.constraint,o=[i.params.x,i.params.y];return new to(s,{axes:n.rawValue.getComponents().map((a,l)=>{var c;return Co({constraint:r.components[l],initialValue:a,params:pe(i.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(t=i.params.expanded)!==null&&t!==void 0?t:!1,invertsY:Bd(i.params),max:Dd(i.params,n.rawValue),parser:Lt,pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",value:n,viewProps:i.viewProps})}}),Yt=class{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(S(t))return!1;let e=t.x,s=t.y,n=t.z;return!(typeof e!="number"||typeof s!="number"||typeof n!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}},Gc={toComponents:i=>i.getComponents(),fromComponents:i=>new Yt(...i)};function Ud(i){return Yt.isObject(i)?new Yt(i.x,i.y,i.z):new Yt}function Id(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y),i.writeProperty("z",t.z)}function jd(i,t){return new wi({assembly:Gc,components:[At(Object.assign(Object.assign({},i),i.x),t.x),At(Object.assign(Object.assign({},i),i.y),t.y),At(Object.assign(Object.assign({},i),i.z),t.z)]})}var zd=X({id:"input-point3d",type:"input",accept:(i,t)=>{if(!Yt.isObject(i))return null;let e=A(t,s=>Object.assign(Object.assign({},bi(s)),{readonly:s.optional.constant(!1),x:s.optional.custom(Xt),y:s.optional.custom(Xt),z:s.optional.custom(Xt)}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>Ud,constraint:i=>jd(i.params,i.initialValue),equals:Yt.equals,writer:i=>Id},controller:i=>{let t=i.value,e=i.constraint,s=[i.params.x,i.params.y,i.params.z];return new xi(i.document,{assembly:Gc,axes:t.rawValue.getComponents().map((n,r)=>{var o;return Co({constraint:e.components[r],initialValue:n,params:pe(i.params,(o=s[r])!==null&&o!==void 0?o:{})})}),parser:Lt,value:t,viewProps:i.viewProps})}}),Qt=class{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.z=s,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(S(t))return!1;let e=t.x,s=t.y,n=t.z,r=t.w;return!(typeof e!="number"||typeof s!="number"||typeof n!="number"||typeof r!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}},Hc={toComponents:i=>i.getComponents(),fromComponents:i=>new Qt(...i)};function Nd(i){return Qt.isObject(i)?new Qt(i.x,i.y,i.z,i.w):new Qt}function Kd(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y),i.writeProperty("z",t.z),i.writeProperty("w",t.w)}function $d(i,t){return new wi({assembly:Hc,components:[At(Object.assign(Object.assign({},i),i.x),t.x),At(Object.assign(Object.assign({},i),i.y),t.y),At(Object.assign(Object.assign({},i),i.z),t.z),At(Object.assign(Object.assign({},i),i.w),t.w)]})}var qd=X({id:"input-point4d",type:"input",accept:(i,t)=>{if(!Qt.isObject(i))return null;let e=A(t,s=>Object.assign(Object.assign({},bi(s)),{readonly:s.optional.constant(!1),w:s.optional.custom(Xt),x:s.optional.custom(Xt),y:s.optional.custom(Xt),z:s.optional.custom(Xt)}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>Nd,constraint:i=>$d(i.params,i.initialValue),equals:Qt.equals,writer:i=>Kd},controller:i=>{let t=i.value,e=i.constraint,s=[i.params.x,i.params.y,i.params.z,i.params.w];return new xi(i.document,{assembly:Hc,axes:t.rawValue.getComponents().map((n,r)=>{var o;return Co({constraint:e.components[r],initialValue:n,params:pe(i.params,(o=s[r])!==null&&o!==void 0?o:{})})}),parser:Lt,value:t,viewProps:i.viewProps})}});function Gd(i){let t=[],e=Vo(i.options);return e&&t.push(e),new fe(t)}var Hd=X({id:"input-string",type:"input",accept:(i,t)=>{if(typeof i!="string")return null;let e=A(t,s=>({readonly:s.optional.constant(!1),options:s.optional.custom(Ei)}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>gc,constraint:i=>Gd(i.params),writer:i=>Pi},controller:i=>{let t=i.document,e=i.value,s=i.constraint,n=s&&As(s,be);return n?new Ct(t,{props:new g({options:n.values.value("options")}),value:e,viewProps:i.viewProps}):new _e(t,{parser:r=>r,props:g.fromObject({formatter:Tr}),value:e,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="string"?null:i.controller.valueController instanceof Ct?new vi(i.controller):null}}),Si={monitor:{defaultInterval:200,defaultRows:3}},Ql=w("mll"),eo=class{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Ql()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("textarea");s.classList.add(Ql("i")),s.style.height=`calc(var(${Cc("containerUnitSize")}) * ${e.rows})`,s.readOnly=!0,e.viewProps.bindDisabled(s),this.element.appendChild(s),this.textareaElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,s=[];this.value.rawValue.forEach(n=>{n!==void 0&&s.push(this.formatter_(n))}),t.textContent=s.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}},Ci=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new eo(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}},Wl=w("sgl"),io=class{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Wl()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("input");s.classList.add(Wl("i")),s.readOnly=!0,s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}},yi=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new io(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}},Xd=X({id:"monitor-bool",type:"monitor",accept:(i,t)=>{if(typeof i!="boolean")return null;let e=A(t,s=>({readonly:s.required.constant(!0),rows:s.optional.number}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>_c},controller:i=>{var t;return i.value.rawValue.length===1?new yi(i.document,{formatter:zl,value:i.value,viewProps:i.viewProps}):new Ci(i.document,{formatter:zl,rows:(t=i.params.rows)!==null&&t!==void 0?t:Si.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}}),so=class extends ve{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}},Ht=w("grl"),no=class{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ht()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let s=t.createElementNS(gt,"svg");s.classList.add(Ht("g")),s.style.height=`calc(var(${Cc("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(s),this.svgElem_=s;let n=t.createElementNS(gt,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;let r=t.createElement("div");r.classList.add(Ht("t"),w("tt")()),this.element.appendChild(r),this.tooltipElem_=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let{clientWidth:t,clientHeight:e}=this.element,s=this.value.rawValue.length-1,n=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((h,p)=>{if(h===void 0)return;let d=y(p,0,s,0,t),m=y(h,n,r,e,0);o.push([d,m].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));let a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(Ht("t","a"));return}let c=y(this.cursor_.rawValue,0,s,0,t),u=y(l,n,r,e,0);a.style.left=`${c}px`,a.style.top=`${u}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(Ht("t","a"))||(a.classList.add(Ht("t","a"),Ht("t","in")),Cs(a),a.classList.remove(Ht("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Fs=class{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=V(-1),this.view=new no(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!yo(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{let s=new Ot(this.view.element);s.emitter.on("down",this.onGraphPointerDown_),s.emitter.on("move",this.onGraphPointerMove_),s.emitter.on("up",this.onGraphPointerUp_)}}importProps(t){return tt(t,null,e=>({max:e.required.number,min:e.required.number}),e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0))}exportProps(){return et(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){let{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(y(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(y(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function ro(i){return S(i.format)?J(2):i.format}function Yd(i){var t;return i.value.rawValue.length===1?new yi(i.document,{formatter:ro(i.params),value:i.value,viewProps:i.viewProps}):new Ci(i.document,{formatter:ro(i.params),rows:(t=i.params.rows)!==null&&t!==void 0?t:Si.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}function Qd(i){var t,e,s;return new Fs(i.document,{formatter:ro(i.params),rows:(t=i.params.rows)!==null&&t!==void 0?t:Si.monitor.defaultRows,props:g.fromObject({max:(e=i.params.max)!==null&&e!==void 0?e:100,min:(s=i.params.min)!==null&&s!==void 0?s:0}),value:i.value,viewProps:i.viewProps})}function Jl(i){return i.view==="graph"}var Wd=X({id:"monitor-number",type:"monitor",accept:(i,t)=>{if(typeof i!="number")return null;let e=A(t,s=>({format:s.optional.function,max:s.optional.number,min:s.optional.number,readonly:s.required.constant(!0),rows:s.optional.number,view:s.optional.string}));return e?{initialValue:i,params:e}:null},binding:{defaultBufferSize:i=>Jl(i)?64:1,reader:i=>sc},controller:i=>Jl(i.params)?Qd(i):Yd(i),api:i=>i.controller.valueController instanceof Fs?new so(i.controller):null}),Jd=X({id:"monitor-string",type:"monitor",accept:(i,t)=>{if(typeof i!="string")return null;let e=A(t,s=>({multiline:s.optional.boolean,readonly:s.required.constant(!0),rows:s.optional.number}));return e?{initialValue:i,params:e}:null},binding:{reader:i=>gc},controller:i=>{var t;let e=i.value;return e.rawValue.length>1||i.params.multiline?new Ci(i.document,{formatter:Tr,rows:(t=i.params.rows)!==null&&t!==void 0?t:Si.monitor.defaultRows,value:e,viewProps:i.viewProps}):new yi(i.document,{formatter:Tr,value:e,viewProps:i.viewProps})}}),oo=class{constructor(){this.map_=new Map}get(t){var e;return(e=this.map_.get(t))!==null&&e!==void 0?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),e}},ao=class{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}};function Zd(i,t){var e;let s=i.accept(t.target.read(),t.params);if(S(s))return null;let n={target:t.target,initialValue:s.initialValue,params:s.params},r=A(t.params,h=>({disabled:h.optional.boolean,hidden:h.optional.boolean,label:h.optional.string,tag:h.optional.string})),o=i.binding.reader(n),a=i.binding.constraint?i.binding.constraint(n):void 0,l=new ao({reader:o,target:t.target,writer:i.binding.writer(n)}),c=new nr(V(o(s.initialValue),{constraint:a,equals:i.binding.equals}),l),u=i.controller({constraint:a,document:t.document,initialValue:s.initialValue,params:s.params,value:c,viewProps:Dt.create({disabled:r?.disabled,hidden:r?.hidden})});return new or(t.document,{blade:je(),props:g.fromObject({label:"label"in t.params?(e=r?.label)!==null&&e!==void 0?e:null:t.target.key}),tag:r?.tag,value:c,valueController:u})}var lo=class{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}};function tm(i,t){return t===0?new Er:new Pr(i,t??Si.monitor.defaultInterval)}function em(i,t){var e,s,n;let r=i.accept(t.target.read(),t.params);if(S(r))return null;let o={target:t.target,initialValue:r.initialValue,params:r.params},a=A(t.params,p=>({bufferSize:p.optional.number,disabled:p.optional.boolean,hidden:p.optional.boolean,interval:p.optional.number,label:p.optional.string})),l=i.binding.reader(o),c=(s=(e=a?.bufferSize)!==null&&e!==void 0?e:i.binding.defaultBufferSize&&i.binding.defaultBufferSize(r.params))!==null&&s!==void 0?s:1,u=new ar({binding:new lo({reader:l,target:t.target}),bufferSize:c,ticker:tm(t.document,a?.interval)}),h=i.controller({document:t.document,params:r.params,value:u,viewProps:Dt.create({disabled:a?.disabled,hidden:a?.hidden})});return h.viewProps.bindDisabled(u.ticker),h.viewProps.handleDispose(()=>{u.ticker.dispose()}),new lr(t.document,{blade:je(),props:g.fromObject({label:"label"in t.params?(n=a?.label)!==null&&n!==void 0?n:null:t.target.key}),value:u,valueController:h})}var co=class{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!Cp(e.core))throw j.notCompatible(t,e.id);e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,s){return this.pluginsMap_.inputs.reduce((n,r)=>n??Zd(r,{document:t,target:e,params:s}),null)}createMonitor_(t,e,s){return this.pluginsMap_.monitors.reduce((n,r)=>n??em(r,{document:t,params:s,target:e}),null)}createBinding(t,e,s){let n=e.read();if(S(n))throw new j({context:{key:e.key},type:"nomatchingcontroller"});let r=this.createInput_(t,e,s);if(r)return r;let o=this.createMonitor_(t,e,s);if(o)return o;throw new j({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){let s=this.pluginsMap_.blades.reduce((n,r)=>n??fp(r,{document:t,params:e}),null);if(!s)throw new j({type:"nomatchingview",context:{params:e}});return s}createInputBindingApi_(t){let e=this.pluginsMap_.inputs.reduce((s,n)=>{var r,o;return s||((o=(r=n.api)===null||r===void 0?void 0:r.call(n,{controller:t}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(t,e??new ve(t))}createMonitorBindingApi_(t){let e=this.pluginsMap_.monitors.reduce((s,n)=>{var r,o;return s||((o=(r=n.api)===null||r===void 0?void 0:r.call(n,{controller:t}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(t,e??new ve(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(Jh(t))return this.createInputBindingApi_(t);if(sp(t))return this.createMonitorBindingApi_(t);throw j.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(Wh(t))return this.createBindingApi(t);let e=this.pluginsMap_.blades.reduce((s,n)=>s??n.api({controller:t,pool:this}),null);if(!e)throw j.shouldNeverHappen();return this.apiCache_.add(t,e)}},im=new oo;function sm(){let i=new co(im);return[Od,zd,qd,Hd,Rd,Vd,Sd,Cd,Ep,Xd,Jd,Wd,rp,mp,bc].forEach(t=>{i.register("core",t)}),i}var uo=class extends Ft{constructor(t){super(t),this.emitter_=new L,this.controller.value.emitter.on("change",e=>{this.emitter_.emit("change",new me(this,e.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}},ho=class extends Ft{},po=class extends Ft{constructor(t){super(t),this.emitter_=new L,this.controller.value.emitter.on("change",e=>{this.emitter_.emit("change",new me(this,e.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}},mo=class extends Ft{constructor(t){super(t),this.emitter_=new L,this.controller.value.emitter.on("change",e=>{this.emitter_.emit("change",new me(this,e.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let s=e.bind(this);return this.emitter_.on(t,n=>{s(n)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}},nm=(function(){return{id:"list",type:"blade",core:Ie,accept(i){let t=A(i,e=>({options:e.required.custom(Ei),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string}));return t?{params:t}:null},controller(i){let t=new be(So(i.params.options)),e=V(i.params.value,{constraint:t}),s=new Ct(i.document,{props:new g({options:t.values.value("options")}),value:e,viewProps:i.viewProps});return new Mt(i.document,{blade:i.blade,props:g.fromObject({label:i.params.label}),value:e,valueController:s})},api(i){return!(i.controller instanceof Mt)||!(i.controller.valueController instanceof Ct)?null:new uo(i.controller)}}})(),vo=class extends Vs{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}},fo=class extends di{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}},Zl=w("spr"),bo=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Zl()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("hr");s.classList.add(Zl("r")),this.element.appendChild(s)}},Ms=class extends De{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new bo(t,{viewProps:e.viewProps})}))}},rm={id:"separator",type:"blade",core:Ie,accept(i){let t=A(i,e=>({view:e.required.constant("separator")}));return t?{params:t}:null},controller(i){return new Ms(i.document,{blade:i.blade,viewProps:i.viewProps})},api(i){return i.controller instanceof Ms?new ho(i.controller):null}},om={id:"slider",type:"blade",core:Ie,accept(i){let t=A(i,e=>({max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number}));return t?{params:t}:null},controller(i){var t,e;let s=(t=i.params.value)!==null&&t!==void 0?t:0,n=new de({max:i.params.max,min:i.params.min}),r=V(s,{constraint:n}),o=new Be(i.document,Object.assign(Object.assign({},xc({formatter:(e=i.params.format)!==null&&e!==void 0?e:Bh,keyScale:V(1),max:n.values.value("max"),min:n.values.value("min"),pointerScale:oc(i.params,s)})),{parser:Lt,value:r,viewProps:i.viewProps}));return new Mt(i.document,{blade:i.blade,props:g.fromObject({label:i.params.label}),value:r,valueController:o})},api(i){return!(i.controller instanceof Mt)||!(i.controller.valueController instanceof Be)?null:new po(i.controller)}},am=(function(){return{id:"text",type:"blade",core:Ie,accept(i){let t=A(i,e=>({parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string}));return t?{params:t}:null},controller(i){var t;let e=V(i.params.value),s=new _e(i.document,{parser:i.params.parse,props:g.fromObject({formatter:(t=i.params.format)!==null&&t!==void 0?t:(n=>String(n))}),value:e,viewProps:i.viewProps});return new Mt(i.document,{blade:i.blade,props:g.fromObject({label:i.params.label}),value:e,valueController:s})},api(i){return!(i.controller instanceof Mt)||!(i.controller.valueController instanceof _e)?null:new mo(i.controller)}}})();function lm(i){let t=i.createElement("div");return t.classList.add(w("dfw")()),i.body&&i.body.appendChild(t),t}function cm(i,t,e){if(i.querySelector(`style[data-tp-style=${t}]`))return;let s=i.createElement("style");s.dataset.tpStyle=t,s.textContent=e,i.head.appendChild(s)}var Ds=class extends vo{constructor(t){var e,s;let n=t??{},r=(e=n.document)!==null&&e!==void 0?e:$h(),o=sm(),a=new fo(r,{expanded:n.expanded,blade:je(),props:g.fromObject({title:n.title}),viewProps:Dt.create()});super(a,o),this.pool_=o,this.containerElem_=(s=n.container)!==null&&s!==void 0?s:lm(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw j.alreadyDisposed();return this.doc_}dispose(){let t=this.containerElem_;if(!t)throw j.alreadyDisposed();if(this.usesDefaultWrapper_){let e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&cm(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(s=>{this.pool_.register(t.id,s)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[nm,rm,om,bc,am]})}},Kv=new Ss("4.0.5");var yl={};ch(yl,{ButtonCellApi:()=>Zs,ButtonGridApi:()=>tn,ButtonGridController:()=>en,CubicBezier:()=>kt,CubicBezierApi:()=>nn,CubicBezierAssembly:()=>wl,CubicBezierController:()=>Zi,CubicBezierGraphController:()=>cn,CubicBezierGraphView:()=>an,CubicBezierPickerController:()=>un,CubicBezierPickerView:()=>on,CubicBezierPreviewView:()=>ln,CubicBezierView:()=>rn,FpsGraphBladeApi:()=>hn,FpsGraphController:()=>mn,FpsView:()=>dn,Fpswatch:()=>pn,Interval:()=>Q,IntervalAssembly:()=>xl,IntervalConstraint:()=>ts,RadioCellApi:()=>wn,RadioController:()=>En,RadioGridApi:()=>Cn,RadioGridController:()=>Ze,RadioView:()=>yn,RangeSliderController:()=>_n,RangeSliderTextController:()=>gn,RangeSliderTextView:()=>fn,RangeSliderView:()=>bn,TpRadioGridChangeEvent:()=>xn,css:()=>Pv,id:()=>Ev,plugins:()=>kv});function T(i){return i==null}function Yo(i){return i!==null&&typeof i=="object"}function Qo(i){return i!==null&&typeof i=="object"}function um(i,t){if(i.length!==t.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==t[e])return!1;return!0}function Ee(i,t){return Array.from(new Set([...Object.keys(i),...Object.keys(t)])).reduce(((e,s)=>{let n=i[s],r=t[s];return Qo(n)&&Qo(r)?Object.assign(Object.assign({},e),{[s]:Ee(n,r)}):Object.assign(Object.assign({},e),{[s]:s in t?r:n})}),{})}var hm={alreadydisposed:()=>"View has been already disposed",invalidparams:i=>`Invalid parameters for '${i.name}'`,nomatchingcontroller:i=>`No matching controller for '${i.key}'`,nomatchingview:i=>`No matching view for '${JSON.stringify(i.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:i=>`Not compatible with  plugin '${i.id}'`,propertynotfound:i=>`Property '${i.name}' not found`,shouldneverhappen:()=>"This error should never happen"},dt=class i{static alreadyDisposed(){return new i({type:"alreadydisposed"})}static notBindable(){return new i({type:"notbindable"})}static notCompatible(t,e){return new i({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new i({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new i({type:"shouldneverhappen"})}constructor(t){var e;this.message=(e=hm[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}},$s=class i{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return t!==null&&(typeof t=="object"||typeof t=="function")}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){let s=this.read();if(!i.isBindable(s))throw dt.notBindable();if(!(t in s))throw dt.propertyNotFound(t);s[t]=e}},K=class{constructor(){this.observers_={}}on(t,e){let s=this.observers_[t];return s||(s=this.observers_[t]=[]),s.push({handler:e}),this}off(t,e){let s=this.observers_[t];return s&&(this.observers_[t]=s.filter((n=>n.handler!==e))),this}emit(t,e){let s=this.observers_[t];s&&s.forEach((n=>{n.handler(e)}))}},Wo=class{constructor(t,e){var s;this.constraint_=e?.constraint,this.equals_=(s=e?.equals)!==null&&s!==void 0?s:(n,r)=>n===r,this.emitter=new K,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let s=e??{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(t):t,r=this.rawValue_;(!this.equals_(r,n)||s.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:s,previousRawValue:r,rawValue:n,sender:this}))}},Jo=class{constructor(t){this.emitter=new K,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let s=e??{forceEmit:!1,last:!0},n=this.value_;(n!==t||s.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:s,previousRawValue:n,rawValue:this.value_,sender:this}))}},Zo=class{constructor(t){this.emitter=new K,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}};function F(i,t){let e=t?.constraint,s=t?.equals;return e||s?new Wo(i,t):new Jo(i)}var b=class i{constructor(t){this.emitter=new K,this.valMap_=t;for(let e in this.valMap_)this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}static createCore(t){return Object.keys(t).reduce(((e,s)=>Object.assign(e,{[s]:F(t[s])})),{})}static fromObject(t){let e=this.createCore(t);return new i(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}},Pe=class{constructor(t){this.values=b.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),s=this.values.get("min");return Math.min(Math.max(t,s),e)}},Oi=class{constructor(t){this.values=b.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),s=this.values.get("min"),n=t;return T(s)||(n=Math.max(n,s)),T(e)||(n=Math.min(n,e)),n}},ta=class{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){let e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}},ea=class{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}},pm={"**":(i,t)=>Math.pow(i,t),"*":(i,t)=>i*t,"/":(i,t)=>i/t,"%":(i,t)=>i%t,"+":(i,t)=>i+t,"-":(i,t)=>i-t,"<<":(i,t)=>i<<t,">>":(i,t)=>i>>t,">>>":(i,t)=>i>>>t,"&":(i,t)=>i&t,"^":(i,t)=>i^t,"|":(i,t)=>i|t},ia=class{constructor(t,e,s){this.left=e,this.operator=t,this.right=s}evaluate(){let t=pm[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}},dm={"+":i=>i,"-":i=>-i,"~":i=>~i},sa=class{constructor(t,e){this.operator=t,this.expression=e}evaluate(){let t=dm[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function nl(i){return(t,e)=>{for(let s=0;s<i.length;s++){let n=i[s](t,e);if(n!=="")return n}return""}}function Ui(i,t){var e;let s=i.substr(t).match(/^\s+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function Ii(i,t){var e;let s=i.substr(t).match(/^[0-9]+/);return(e=s&&s[0])!==null&&e!==void 0?e:""}function Mo(i,t){let e=i.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";let s=(function(n,r){let o=Ii(n,r);if(o!=="")return o;let a=n.substr(r,1);if(a!=="-"&&a!=="+")return"";let l=Ii(n,r+=1);return l===""?"":a+l})(i,t);return s===""?"":e+s}function Xc(i,t){let e=i.substr(t,1);if(e==="0")return e;let s=(function(n,r){let o=n.substr(r,1);return o.match(/^[1-9]$/)?o:""})(i,t);return t+=s.length,s===""?"":s+Ii(i,t)}var mm=nl([function(i,t){let e=Xc(i,t);if(t+=e.length,e==="")return"";let s=i.substr(t,1);if(t+=s.length,s!==".")return"";let n=Ii(i,t);return e+s+n+Mo(i,t+=n.length)},function(i,t){let e=i.substr(t,1);if(t+=e.length,e!==".")return"";let s=Ii(i,t);return t+=s.length,s===""?"":e+s+Mo(i,t)},function(i,t){let e=Xc(i,t);return t+=e.length,e===""?"":e+Mo(i,t)}]),vm=nl([function(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";let s=(function(n,r){var o;let a=n.substr(r).match(/^[01]+/);return(o=a&&a[0])!==null&&o!==void 0?o:""})(i,t);return s===""?"":e+s},function(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";let s=(function(n,r){var o;let a=n.substr(r).match(/^[0-7]+/);return(o=a&&a[0])!==null&&o!==void 0?o:""})(i,t);return s===""?"":e+s},function(i,t){let e=i.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";let s=(function(n,r){var o;let a=n.substr(r).match(/^[0-9a-f]+/i);return(o=a&&a[0])!==null&&o!==void 0?o:""})(i,t);return s===""?"":e+s}]),fm=nl([vm,mm]);function bm(i,t){var e;return(e=(function(s,n){let r=fm(s,n);return n+=r.length,r===""?null:{evaluable:new ea(r),cursor:n}})(i,t))!==null&&e!==void 0?e:(function(s,n){let r=s.substr(n,1);if(n+=r.length,r!=="(")return null;let o=xu(s,n);if(!o)return null;n=o.cursor,n+=Ui(s,n).length;let a=s.substr(n,1);return n+=a.length,a!==")"?null:{evaluable:o.evaluable,cursor:n}})(i,t)}function _m(i,t,e){e+=Ui(t,e).length;let s=i.filter((n=>t.startsWith(n,e)))[0];return s?(e+=s.length,{cursor:e+=Ui(t,e).length,operator:s}):null}var gm=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((i,t)=>(function(e,s){return(n,r)=>{let o=e(n,r);if(!o)return null;r=o.cursor;let a=o.evaluable;for(;;){let l=_m(s,n,r);if(!l)break;r=l.cursor;let c=e(n,r);if(!c)return null;r=c.cursor,a=new ia(l.operator,a,c.evaluable)}return a?{cursor:r,evaluable:a}:null}})(i,t)),(function i(t,e){let s=bm(t,e);if(s)return s;let n=t.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;let r=i(t,e);return r?{cursor:e=r.cursor,evaluable:new sa(n,r.evaluable)}:null}));function xu(i,t){return t+=Ui(i,t).length,gm(i,t)}function mt(i){var t;let e=(function(s){let n=xu(s,0);return n?n.cursor+Ui(s,n.cursor).length!==s.length?null:n.evaluable:null})(i);return(t=e?.evaluate())!==null&&t!==void 0?t:null}function rl(i){if(typeof i=="number")return i;if(typeof i=="string"){let t=mt(i);if(!T(t))return t}return 0}function $(i){return t=>t.toFixed(Math.max(Math.min(i,20),0))}function f(i,t,e,s,n){return s+(i-t)/(e-t)*(n-s)}function Yc(i){return String(i.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function R(i,t,e){return Math.min(Math.max(i,t),e)}function Cu(i,t){return(i%t+t)%t}function wm(i,t){return T(i.step)?Math.max(Yc(t),2):Yc(i.step)}function yu(i){var t;return(t=i.step)!==null&&t!==void 0?t:1}function xm(i,t){var e;let s=Math.abs((e=i.step)!==null&&e!==void 0?e:t);return s===0?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function ol(i,t){return T(i.step)?null:new ta(i.step,t)}function al(i){return T(i.max)||T(i.min)?T(i.max)&&T(i.min)?null:new Oi({max:i.max,min:i.min}):new Pe({max:i.max,min:i.min})}function ll(i,t){var e,s,n;return{formatter:(e=i.format)!==null&&e!==void 0?e:$(wm(i,t)),keyScale:(s=i.keyScale)!==null&&s!==void 0?s:yu(i),pointerScale:(n=i.pointerScale)!==null&&n!==void 0?n:xm(i,t)}}function cl(i){return{format:i.optional.function,keyScale:i.optional.number,max:i.optional.number,min:i.optional.number,pointerScale:i.optional.number,step:i.optional.number}}function ul(i){return{constraint:i.constraint,textProps:b.fromObject(ll(i.params,i.initialValue))}}var jt=class{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}},ne=class{constructor(t){this.target=t}},qe=class extends ne{constructor(t,e,s){super(t),this.value=e,this.last=s==null||s}},na=class extends ne{constructor(t,e){super(t),this.expanded=e}},ra=class extends ne{constructor(t,e){super(t),this.index=e}},ji=class extends jt{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new K,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){let s=e.bind(this);return this.emitter_.on(t,(n=>{s(n)})),this}refresh(){this.controller.value.fetch()}onValueChange_(t){let e=this.controller.value;this.emitter_.emit("change",new qe(this,e.binding.target.read(),t.options.last))}};function Ut(i){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};let s=i(e);return s!==void 0?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function Qc(i){return{custom:t=>Ut(t)(i),boolean:Ut((t=>typeof t=="boolean"?t:void 0))(i),number:Ut((t=>typeof t=="number"?t:void 0))(i),string:Ut((t=>typeof t=="string"?t:void 0))(i),function:Ut((t=>typeof t=="function"?t:void 0))(i),constant:t=>Ut((e=>e===t?t:void 0))(i),raw:Ut((t=>t))(i),object:t=>Ut((e=>{var s;if((s=e)!==null&&typeof s=="object")return(function(n,r){return Object.keys(r).reduce(((o,a)=>{if(o===void 0)return;let l=(0,r[a])(n[a]);return l.succeeded?Object.assign(Object.assign({},o),{[a]:l.value}):void 0}),{})})(e,t)}))(i),array:t=>Ut((e=>{var s;if(Array.isArray(e))return s=t,e.reduce(((n,r)=>{if(n===void 0)return;let o=s(r);return o.succeeded&&o.value!==void 0?[...n,o.value]:void 0}),[])}))(i)}}var oa={optional:Qc(!0),required:Qc(!1)};function M(i,t){let e=t(oa),s=oa.required.object(e)(i);return s.succeeded?s.value:void 0}function bt(i,t,e,s){if(t&&!t(i))return!1;let n=M(i,e);return!!n&&s(n)}function _t(i,t){var e;return Ee((e=i?.())!==null&&e!==void 0?e:{},t)}function Us(i){return"value"in i}function Cm(i){if(!Yo(i)||!("binding"in i))return!1;let t=i.binding;return!!Yo(e=t)&&"target"in e;var e}var z="http://www.w3.org/2000/svg";function zs(i){i.offsetHeight}function Pn(i){return i.ontouchstart!==void 0}var ym={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function kn(i,t){let e=i.createElementNS(z,"svg");return e.innerHTML=ym[t],e}function Eu(i,t,e){i.insertBefore(t,i.children[e])}function hl(i){i.parentElement&&i.parentElement.removeChild(i)}function Pu(i){for(;i.children.length>0;)i.removeChild(i.children[0])}function pl(i){return i.relatedTarget?i.relatedTarget:"explicitOriginalTarget"in i?i.explicitOriginalTarget:null}function ht(i,t){i.emitter.on("change",(e=>{t(e.rawValue)})),t(i.rawValue)}function pt(i,t,e){ht(i.value(t),e)}var Em="tp";function _(i){return(t,e)=>[Em,"-",i,"v",t?`_${t}`:"",e?`-${e}`:""].join("")}var Vi=_("lbl"),qs=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Vi()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Vi("l")),pt(e.props,"label",(r=>{T(r)?this.element.classList.add(Vi(void 0,"nol")):(this.element.classList.remove(Vi(void 0,"nol")),(function(o){for(;o.childNodes.length>0;)o.removeChild(o.childNodes[0])})(s),s.appendChild((function(o,a){let l=o.createDocumentFragment();return a.split(`
`).map((c=>o.createTextNode(c))).forEach(((c,u)=>{u>0&&l.appendChild(o.createElement("br")),l.appendChild(c)})),l})(t,r)))})),this.element.appendChild(s),this.labelElement=s;let n=t.createElement("div");n.classList.add(Vi("v")),this.element.appendChild(n),this.valueElement=n}},Ge=class{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new qs(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return bt(t,null,(e=>({label:e.optional.string})),(e=>(this.props.set("label",e.label),!0)))}exportProps(){return _t(null,{label:this.props.get("label")})}},Wc=_(""),Jc={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"},ke=class{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;let e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((s=>{e.classList.remove(Wc(void 0,Jc[s]))})),this.blade.get("positions").forEach((s=>{e.classList.add(Wc(void 0,Jc[s]))}))})),this.viewProps.handleDispose((()=>{hl(e)}))}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return bt(t,null,(e=>({disabled:e.required.boolean,hidden:e.required.boolean})),(e=>(this.viewProps.importState(e),!0)))}exportState(){return _t(null,Object.assign({},this.viewProps.exportState()))}},He=class extends ke{constructor(t,e){if(e.value!==e.valueController.value)throw dt.shouldNeverHappen();let s=e.valueController.viewProps,n=new Ge(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new qs(t,{props:e.props,viewProps:s}),viewProps:s})),this.labelController=n,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return bt(t,(e=>{var s,n,r;return super.importState(e)&&this.labelController.importProps(e)&&((r=(n=(s=this.valueController).importProps)===null||n===void 0?void 0:n.call(s,t))===null||r===void 0||r)}),(e=>({value:e.optional.raw})),(e=>(e.value&&(this.value.rawValue=e.value),!0)))}exportState(){var t,e,s;return _t((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(s=(e=(t=this.valueController).exportProps)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:{}))}};function ku(i,t){for(;i.length<t;)i.push(void 0)}function Pm(i){let t=[];return ku(t,i),t}function km(i){let t=i.indexOf(void 0);return t<0?i:i.slice(0,t)}var aa=class extends jt{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return(t=this.controller.buttonController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){let s=e.bind(this);return this.controller.buttonController.emitter.on(t,(()=>{s(new ne(this))})),this}};function ce(i,t){return e=>{(function(s,n,r){r?s.classList.add(n):s.classList.remove(n)})(i,t,e)}}function dl(i,t){ht(i,(e=>{t.textContent=e??""}))}var Do=_("btn"),la=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Do()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("button");s.classList.add(Do("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(Do("t")),dl(e.props.value("title"),n),this.buttonElement.appendChild(n)}},Gs=class{constructor(t,e){this.emitter=new K,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new la(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return bt(t,null,(e=>({title:e.optional.string})),(e=>(this.props.set("title",e.title),!0)))}exportProps(){return _t(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},Hs=class extends ke{constructor(t,e){let s=new Gs(t,{props:e.buttonProps,viewProps:e.viewProps}),n=new Ge(t,{blade:e.blade,props:e.labelProps,valueController:s});super({blade:e.blade,view:n.view,viewProps:e.viewProps}),this.buttonController=s,this.labelController=n}importState(t){return bt(t,(e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e)),(()=>({})),(()=>!0))}exportState(){return _t((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},Sm=new class{constructor(i){let[t,e]=i.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=e??null}toString(){let i=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[i,this.prerelease].join("-"):i}}("2.0.0-beta.2");function O(i){return Object.assign({core:Sm},i)}O({id:"button",type:"blade",accept(i){let t=M(i,(e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string})));return t?{params:t}:null},controller:i=>new Hs(i.document,{blade:i.blade,buttonProps:b.fromObject({title:i.params.title}),labelProps:b.fromObject({label:i.params.label}),viewProps:i.viewProps}),api:i=>i.controller instanceof Hs?new aa(i.controller):null});var ca=class{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new K,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((t=>this.pool_.createApi(t)))}addBinding(t,e,s){let n=s??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,(function(l,c){if(!$s.isBindable(l))throw dt.notBindable();return new $s(l,c)})(t,e),n),a=this.pool_.createBindingApi(o);return this.add(a,n.index)}addFolder(t){return(function(e,s){return e.addBlade(Object.assign(Object.assign({},s),{view:"folder"}))})(this,t)}addButton(t){return(function(e,s){return e.addBlade(Object.assign(Object.assign({},s),{view:"button"}))})(this,t)}addTab(t){return(function(e,s){return e.addBlade(Object.assign(Object.assign({},s),{view:"tab"}))})(this,t)}add(t,e){let s=t.controller;return this.controller_.rack.add(s,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){let e=this.controller_.element.ownerDocument,s=this.pool_.createBlade(e,t),n=this.pool_.createApi(s);return this.add(n,t.index)}on(t,e){let s=e.bind(this);return this.emitter_.on(t,(n=>{s(n)})),this}refresh(){this.children.forEach((t=>{var e;Yo(e=t)&&"refresh"in e&&typeof e.refresh=="function"&&t.refresh()}))}onRackValueChange_(t){let e=t.bladeController,s=this.pool_.createApi(e),n=Cm(e.value)?e.value.binding:null;this.emitter_.emit("change",new qe(s,n?n.target.read():e.value.rawValue,t.options.last))}},zi=class extends jt{constructor(t,e){super(t),this.rackApi_=new ca(t.rackController,e)}},Ni=class extends ke{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return bt(t,(e=>super.importState(e)),(e=>({children:e.required.array(e.required.raw)})),(e=>this.rackController.rack.children.every(((s,n)=>s.importState(e.children[n])))))}exportState(){return _t((()=>super.exportState()),{children:this.rackController.rack.children.map((t=>t.exportState()))})}};function ua(i){return"rackController"in i}var ha=class{constructor(t){this.emitter=new K,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(let e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw dt.shouldNeverHappen();let s=e!==void 0?e:this.items_.length;this.items_.splice(s,0,t),this.cache_.add(t);let n=this.extract_(t);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach((r=>{this.cache_.add(r)}))),this.emitter.emit("add",{index:s,item:t,root:this,target:this})}remove(t){let e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);let s=this.extract_(t);s&&(s.allItems().forEach((n=>{this.cache_.delete(n)})),s.emitter.off("add",this.onSubListAdd_),s.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}};function Vm(i){return ua(i)?i.rackController.rack.bcSet_:null}var pa=class{constructor(t){var e,s;this.emitter=new K,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(e=t.blade)!==null&&e!==void 0?e:null,(s=this.blade_)===null||s===void 0||s.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new ha(Vm),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var s;(s=t.parent)===null||s===void 0||s.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;let s=t.item;if(s.viewProps.emitter.on("change",this.onChildViewPropsChange_),s.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),s.viewProps.handleDispose(this.onChildDispose_),Us(s))s.value.emitter.on("change",this.onChildValueChange_);else if(ua(s)){let n=s.rackController.rack;if(n){let r=n.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;let s=t.item;if(Us(s))s.value.emitter.off("change",this.onChildValueChange_);else if(ua(s)){let n=s.rackController.rack;if(n){let r=n.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){let t=this.bcSet_.items.filter((n=>!n.viewProps.get("hidden"))),e=t[0],s=t[t.length-1];this.bcSet_.items.forEach((n=>{let r=[];n===e&&(r.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||r.push("veryfirst")),n===s&&(r.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||r.push("verylast")),n.blade.set("positions",r)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildValueChange_(t){let e=(function(s,n){for(let r=0;r<s.length;r++){let o=s[r];if(Us(o)&&o.value===n)return o}return null})(this.find(Us),t.sender);if(!e)throw dt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Ki=class{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;let e=new pa({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose((()=>{for(let s=this.rack.children.length-1;s>=0;s--)this.rack.children[s].viewProps.set("disposed",!0)}))}onRackAdd_(t){t.root&&Eu(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&hl(t.bladeController.view.element)}};function Su(){return new b({positions:F([],{equals:um})})}var Xe=class i extends b{constructor(t){super(t)}static create(t){let e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=b.createCore(e);return new i(s)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!T(t)?`${t}px`:"auto"}bindExpandedClass(t,e){let s=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};pt(this,"expanded",s),pt(this,"temporaryExpanded",s)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function Zc(i,t){t.style.height=i.styleHeight}function Sn(i,t){i.value("expanded").emitter.on("beforechange",(()=>{if(i.set("completed",!1),T(i.get("expandedHeight"))){let e=(function(s,n){let r=0;return(function(o,a){let l=o.style.transition;o.style.transition="none",a(),o.style.transition=l})(n,(()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),zs(n),r=n.clientHeight,s.set("temporaryExpanded",null),zs(n)})),r})(i,t);e>0&&i.set("expandedHeight",e)}i.set("shouldFixHeight",!0),zs(t)})),i.emitter.on("change",(()=>{Zc(i,t)})),Zc(i,t),t.addEventListener("transitionend",(e=>{e.propertyName==="height"&&i.cleanUpTransition()}))}var da=class extends zi{constructor(t,e){super(t,e),this.emitter_=new K,this.controller.foldable.value("expanded").emitter.on("change",(s=>{this.emitter_.emit("fold",new na(this,s.sender.rawValue))})),this.rackApi_.on("change",(s=>{this.emitter_.emit("change",s)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,s){return this.rackApi_.addBinding(t,e,s)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){let s=e.bind(this);return this.emitter_.on(t,(n=>{s(n)})),this}refresh(){this.rackApi_.refresh()}},Vu=_("cnt"),ma=class{constructor(t,e){var s;this.className_=_((s=e.viewName)!==null&&s!==void 0?s:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Vu()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),pt(this.foldable_,"completed",ce(this.element,this.className_(void 0,"cpl")));let n=t.createElement("button");n.classList.add(this.className_("b")),pt(e.props,"title",(c=>{T(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;let r=t.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);let o=t.createElement("div");o.classList.add(this.className_("t")),dl(e.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;let a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);let l=t.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}},Xs=class extends Ni{constructor(t,e){var s;let n=Xe.create((s=e.expanded)===null||s===void 0||s),r=new ma(t,{foldable:n,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Ki({blade:e.blade,element:r.containerElement,root:e.root,viewProps:e.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=n,Sn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return bt(t,(e=>super.importState(e)),(e=>({expanded:e.required.boolean,title:e.optional.string})),(e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0)))}exportState(){return _t((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};O({id:"folder",type:"blade",accept(i){let t=M(i,(e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean})));return t?{params:t}:null},controller:i=>new Xs(i.document,{blade:i.blade,expanded:i.params.expanded,props:b.fromObject({title:i.params.title}),viewProps:i.viewProps}),api:i=>i.controller instanceof Xs?new da(i.controller,i.pool):null});var Tm=_("");function tu(i,t){return ce(i,Tm(void 0,t))}var zt=class i extends b{constructor(t){var e,s;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(s=F(this.getGlobalDisabled_()),[new Zo(s),(n,r)=>{s.setRawValue(n,r)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,s,n;let r=t??{};return new i(b.createCore({disabled:(e=r.disabled)!==null&&e!==void 0&&e,disposed:!1,hidden:(s=r.hidden)!==null&&s!==void 0&&s,parent:(n=r.parent)!==null&&n!==void 0?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){ht(this.globalDisabled_,tu(t,"disabled")),pt(this,"hidden",tu(t,"hidden"))}bindDisabled(t){ht(this.globalDisabled_,(e=>{t.disabled=e}))}bindTabIndex(t){ht(this.globalDisabled_,(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){let t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;let s=t.previousRawValue;s?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}},eu=_("tbp"),va=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(eu()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(eu("c")),this.element.appendChild(s),this.containerElement=s}},Ti=_("tbi"),fa=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ti()),e.viewProps.bindClassModifiers(this.element),pt(e.props,"selected",(r=>{r?this.element.classList.add(Ti(void 0,"sel")):this.element.classList.remove(Ti(void 0,"sel"))}));let s=t.createElement("button");s.classList.add(Ti("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(Ti("t")),dl(e.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}},ba=class{constructor(t,e){this.emitter=new K,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new fa(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},$i=class extends Ni{constructor(t,e){let s=new va(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Ki({blade:e.blade,element:s.containerElement,viewProps:e.viewProps}),view:s})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ba(t,{props:e.itemProps,viewProps:zt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,pt(this.props,"selected",(n=>{this.itemController.props.set("selected",n),this.viewProps.set("hidden",!n)}))}get itemController(){return this.ic_}importState(t){return bt(t,(e=>super.importState(e)),(e=>({selected:e.required.boolean,title:e.required.string})),(e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0)))}exportState(){return _t((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},_a=class extends zi{constructor(t,e){super(t,e),this.emitter_=new K,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",(s=>{this.emitter_.emit("change",s)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){let e=this.controller.view.element.ownerDocument,s=new $i(e,{blade:Su(),itemProps:b.fromObject({selected:!1,title:t.title}),props:b.fromObject({selected:!1}),viewProps:zt.create()}),n=this.pool_.createApi(s);return this.rackApi_.add(n,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){let s=e.bind(this);return this.emitter_.on(t,(n=>{s(n)})),this}onSelect_(t){this.emitter_.emit("select",new ra(this,t.rawValue))}},ga=class extends zi{get title(){var t;return(t=this.controller.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,s){return this.rackApi_.addBinding(t,e,s)}addBlade(t){return this.rackApi_.addBlade(t)}refresh(){this.rackApi_.refresh()}},wa=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=F(!0),this.selectedIndex=F(-1),this.items_=[]}add(t,e){let s=e??this.items_.length;this.items_.splice(s,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){let e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);let t=this.items_.findIndex((e=>e.rawValue));t<0?(this.items_.forEach(((e,s)=>{e.rawValue=s===0})),this.selectedIndex.rawValue=0):(this.items_.forEach(((e,s)=>{e.rawValue=s===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){let e=this.items_.findIndex((s=>s===t.sender));this.items_.forEach(((s,n)=>{s.rawValue=n===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}},Ai=_("tab"),xa=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ai(),Vu()),e.viewProps.bindClassModifiers(this.element),ht(e.empty,ce(this.element,Ai(void 0,"nop")));let s=t.createElement("div");s.classList.add(Ai("t")),this.element.appendChild(s),this.itemsElement=s;let n=t.createElement("div");n.classList.add(Ai("i")),this.element.appendChild(n);let r=t.createElement("div");r.classList.add(Ai("c")),this.element.appendChild(r),this.contentsElement=r}},Ys=class extends Ni{constructor(t,e){let s=new wa,n=new xa(t,{empty:s.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new Ki({blade:e.blade,element:n.contentsElement,viewProps:e.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=s}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;let e=t.bladeController;Eu(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;let e=t.bladeController;hl(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}};O({id:"tab",type:"blade",accept(i){let t=M(i,(e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")})));return t&&t.pages.length!==0?{params:t}:null},controller(i){let t=new Ys(i.document,{blade:i.blade,viewProps:i.viewProps});return i.params.pages.forEach((e=>{let s=new $i(i.document,{blade:Su(),itemProps:b.fromObject({selected:!1,title:e.title}),props:b.fromObject({selected:!1}),viewProps:zt.create()});t.add(s)})),t},api:i=>i.controller instanceof Ys?new _a(i.controller,i.pool):i.controller instanceof $i?new ga(i.controller,i.pool):null});var qi=class extends ji{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}},Ca=class{constructor(){this.disabled=!1,this.emitter=new K}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},ya=class{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new K,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;let t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},re=class{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((e,s)=>s.constrain(e)),t)}};function Gi(i,t){if(i instanceof t)return i;if(i instanceof re){let e=i.constraints.reduce(((s,n)=>s||(n instanceof t?n:null)),null);if(e)return e}return null}var Ye=class{constructor(t){this.values=b.fromObject({options:t})}constrain(t){let e=this.values.get("options");return e.length===0||e.filter((s=>s.value===t)).length>0?t:e[0].value}};function Vn(i){var t;let e=oa;return Array.isArray(i)?(t=M({items:i},(s=>({items:s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))}))))===null||t===void 0?void 0:t.items:typeof i=="object"?e.required.raw(i).value:void 0}function Tu(i){if(Array.isArray(i))return i;let t=[];return Object.keys(i).forEach((e=>{t.push({text:e,value:i[e]})})),t}function ml(i){return T(i)?null:new Ye(Tu(i))}var Bo=_("lst"),Ea=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Bo()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("select");s.classList.add(Bo("s")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.selectElement=s;let n=t.createElement("div");n.classList.add(Bo("m")),n.appendChild(kn(t,"dropdown")),this.element.appendChild(n),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,pt(this.props_,"options",(r=>{Pu(this.selectElement),r.forEach((o=>{let a=t.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)})),this.update_()}))}update_(){let t=this.props_.get("options").map((e=>e.value));this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},oe=class{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ea(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){let e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return bt(t,null,(e=>({options:e.required.custom(Vn)})),(e=>(this.props.set("options",Tu(e.options)),!0)))}exportProps(){return _t(null,{options:this.props.get("options")})}},iu=_("pop"),Pa=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(iu()),e.viewProps.bindClassModifiers(this.element),ht(e.shows,ce(this.element,iu(void 0,"v")))}},Hi=class{constructor(t,e){this.shows=F(!1),this.viewProps=e.viewProps,this.view=new Pa(t,{shows:this.shows,viewProps:this.viewProps})}},su=_("txt"),ka=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(su()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);let s=t.createElement("input");s.classList.add(su("i")),s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}},Qe=class{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new ka(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget.value,s=this.parser_(e);T(s)||(this.value.rawValue=s),this.view.refresh()}};function vl(i){return i!=="false"&&!!i}function nu(i){return(function(t){return String(t)})(i)}var Am=$(0);function Is(i){return Am(i)+"%"}function fl(i){return String(i)}function Sa(i){return i}function Ae({primary:i,secondary:t,forward:e,backward:s}){let n=!1;function r(o){n||(n=!0,o(),n=!1)}i.emitter.on("change",(o=>{r((()=>{t.setRawValue(e(i.rawValue,t.rawValue),o.options)}))})),t.emitter.on("change",(o=>{r((()=>{i.setRawValue(s(i.rawValue,t.rawValue),o.options)})),r((()=>{t.setRawValue(e(i.rawValue,t.rawValue),o.options)}))})),r((()=>{t.setRawValue(e(i.rawValue,t.rawValue),{forceEmit:!1,last:!0})}))}function N(i,t){let e=i*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function Se(i){return{altKey:i.altKey,downKey:i.key==="ArrowDown",shiftKey:i.shiftKey,upKey:i.key==="ArrowUp"}}function vt(i){return{altKey:i.altKey,downKey:i.key==="ArrowLeft",shiftKey:i.shiftKey,upKey:i.key==="ArrowRight"}}function Qs(i){return(function(t){return t==="ArrowUp"||t==="ArrowDown"})(i)||i==="ArrowLeft"||i==="ArrowRight"}function Oo(i,t){var e,s;let n=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:i.pageX-(((e=n&&n.scrollX)!==null&&e!==void 0?e:0)+r.left),y:i.pageY-(((s=n&&n.scrollY)!==null&&s!==void 0?s:0)+r.top)}}var ft=class{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new K,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){let e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();let s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Oo(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Oo(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){let e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Oo(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();let e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){let e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;let s=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(s?{x:s.clientX-n.left,y:s.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey})}},lt=_("txt"),Va=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(lt(),lt(void 0,"num")),e.arrayPosition&&this.element.classList.add(lt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("input");s.classList.add(lt("i")),s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(lt()),this.inputElement.classList.add(lt("i"));let n=t.createElement("div");n.classList.add(lt("k")),this.element.appendChild(n),this.knobElement=n;let r=t.createElementNS(z,"svg");r.classList.add(lt("g")),this.knobElement.appendChild(r);let o=t.createElementNS(z,"path");o.classList.add(lt("gb")),r.appendChild(o),this.guideBodyElem_=o;let a=t.createElementNS(z,"path");a.classList.add(lt("gh")),r.appendChild(a),this.guideHeadElem_=a;let l=t.createElement("div");l.classList.add(_("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null)return void this.element.classList.remove(lt(void 0,"drg"));this.element.classList.add(lt(void 0,"drg"));let e=t.rawValue/this.props_.get("pointerScale"),s=e+(e>0?-1:e<0?1:0),n=R(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+n},0 L${s},4 L${s+n},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);let r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}},Ve=class{constructor(t,e){var s;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=(s=e.sliderProps)!==null&&s!==void 0?s:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=F(null),this.view=new Va(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let n=new ft(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,s;let n=(e=this.sliderProps_)===null||e===void 0?void 0:e.get("min"),r=(s=this.sliderProps_)===null||s===void 0?void 0:s.get("max"),o=t;return n!==void 0&&(o=Math.max(o,n)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(t){let e=t.currentTarget.value,s=this.parser_(e);T(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(t){let e=N(this.props.get("keyScale"),Se(t));e!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){N(this.props.get("keyScale"),Se(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;let e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}},Uo=_("sld"),Ta=class{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Uo()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Uo("t")),e.viewProps.bindTabIndex(s),this.element.appendChild(s),this.trackElement=s;let n=t.createElement("div");n.classList.add(Uo("k")),this.trackElement.appendChild(n),this.knobElement=n,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){let t=R(f(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}},Aa=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Ta(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ft(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(f(R(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(this.props.get("keyScale"),vt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){N(this.props.get("keyScale"),vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Io=_("sldtxt"),Ra=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Io());let s=t.createElement("div");s.classList.add(Io("s")),this.sliderView_=e.sliderView,s.appendChild(this.sliderView_.element),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(Io("t")),this.textView_=e.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}},Ws=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Aa(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ve(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new Ra(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return bt(t,null,(e=>({max:e.required.number,min:e.required.number})),(e=>{let s=this.sliderC_.props;return s.set("max",e.max),s.set("min",e.min),!0}))}exportProps(){let t=this.sliderC_.props;return _t(null,{max:t.get("max"),min:t.get("min")})}},Rm={containerUnitSize:"cnt-usz"};function Au(i){return`--${Rm[i]}`}var Js=class{constructor(t,e){let s=_(e.viewName);this.element=t.createElement("div"),this.element.classList.add(s()),e.viewProps.bindClassModifiers(this.element)}};function Xi(i){return cl(i)}function ee(i){if(Qo(i))return M(i,Xi)}function It(i,t){if(!i)return;let e=[],s=ol(i,t);s&&e.push(s);let n=al(i);return n&&e.push(n),new re(e)}function Ru(i){if(i==="inline"||i==="popup")return i}function ae(i,t){i.write(t)}var js=_("ckb"),La=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(js()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("label");s.classList.add(js("l")),this.element.appendChild(s);let n=t.createElement("input");n.classList.add(js("i")),n.type="checkbox",s.appendChild(n),this.inputElement=n,e.viewProps.bindDisabled(this.inputElement);let r=t.createElement("div");r.classList.add(js("w")),s.appendChild(r);let o=kn(t,"check");r.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},Fa=class{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new La(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget;this.value.rawValue=e.checked}};O({id:"input-bool",type:"input",accept:(i,t)=>{if(typeof i!="boolean")return null;let e=M(t,(s=>({options:s.optional.custom(Vn),readonly:s.optional.constant(!1)})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>vl,constraint:i=>(function(t){let e=[],s=ml(t.options);return s&&e.push(s),new re(e)})(i.params),writer:i=>ae},controller:i=>{let t=i.document,e=i.value,s=i.constraint,n=s&&Gi(s,Ye);return n?new oe(t,{props:new b({options:n.values.value("options")}),value:e,viewProps:i.viewProps}):new Fa(t,{value:e,viewProps:i.viewProps})},api:i=>typeof i.controller.value.rawValue!="boolean"?null:i.controller.valueController instanceof oe?new qi(i.controller):null});var xe=_("col"),Ma=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(xe()),e.foldable.bindExpandedClass(this.element,xe(void 0,"expanded")),pt(e.foldable,"completed",ce(this.element,xe(void 0,"cpl")));let s=t.createElement("div");s.classList.add(xe("h")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(xe("s")),s.appendChild(n),this.swatchElement=n;let r=t.createElement("div");if(r.classList.add(xe("t")),s.appendChild(r),this.textElement=r,e.pickerLayout==="inline"){let o=t.createElement("div");o.classList.add(xe("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Lu(i,t,e){let s=Cu(i,360),n=R(t/100,0,1),r=R(e/100,0,1),o=r*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o,c,u,h;return[c,u,h]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function Pt(i){return[i[0],i[1],i[2]]}function Tn(i,t){return[i[0],i[1],i[2],t]}var Lm={hsl:{hsl:(i,t,e)=>[i,t,e],hsv:function(i,t,e){let s=e+t*(100-Math.abs(2*e-100))/200;return[i,s!==0?t*(100-Math.abs(2*e-100))/s:0,e+t*(100-Math.abs(2*e-100))/200]},rgb:function(i,t,e){let s=(i%360+360)%360,n=R(t/100,0,1),r=R(e/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o/2,c,u,h;return[c,u,h]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}},hsv:{hsl:function(i,t,e){let s=100-Math.abs(e*(200-t)/100-100);return[i,s!==0?t*e/s:0,e*(200-t)/200]},hsv:(i,t,e)=>[i,t,e],rgb:Lu},rgb:{hsl:function(i,t,e){let s=R(i/255,0,1),n=R(t/255,0,1),r=R(e/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a,c=0,u=0,h=(a+o)/2;return l!==0&&(u=l/(1-Math.abs(o+a-1)),c=s===o?(n-r)/l:n===o?2+(r-s)/l:4+(s-n)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*h]},hsv:function(i,t,e){let s=R(i/255,0,1),n=R(t/255,0,1),r=R(e/255,0,1),o=Math.max(s,n,r),a=o-Math.min(s,n,r),l;return l=a===0?0:o===s?((n-r)/a%6+6)%6*60:o===n?60*((r-s)/a+2):60*((s-n)/a+4),[l,100*(o===0?0:a/o),100*o]},rgb:(i,t,e)=>[i,t,e]}};function We(i,t){return[t==="float"?1:i==="rgb"?255:360,t==="float"?1:i==="rgb"?255:100,t==="float"?1:i==="rgb"?255:100]}function Fu(i,t,e){var s;let n=We(t,e);return[t==="rgb"?R(i[0],0,n[0]):(r=i[0],o=n[0],r===o?o:Cu(r,o)),R(i[1],0,n[1]),R(i[2],0,n[2]),R((s=i[3])!==null&&s!==void 0?s:1,0,1)];var r,o}function ru(i,t,e,s){let n=We(t,e),r=We(t,s);return i.map(((o,a)=>o/n[a]*r[a]))}function Mu(i,t,e){let s=ru(i,t.mode,t.type,"int");return ru(Lm[t.mode][e.mode](...s),e.mode,"int",e.type)}var C=class i{static black(){return new i([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Fu(t,e,this.type)}getComponents(t){return Tn(Mu(Pt(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}},Wt=_("colp"),Da=class{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Wt()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Wt("hsv"));let n=t.createElement("div");n.classList.add(Wt("sv")),this.svPaletteView_=e.svPaletteView,n.appendChild(this.svPaletteView_.element),s.appendChild(n);let r=t.createElement("div");r.classList.add(Wt("h")),this.hPaletteView_=e.hPaletteView,r.appendChild(this.hPaletteView_.element),s.appendChild(r),this.element.appendChild(s);let o=t.createElement("div");if(o.classList.add(Wt("rgb")),this.textsView_=e.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};let a=t.createElement("div");a.classList.add(Wt("a"));let l=t.createElement("div");l.classList.add(Wt("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);let c=t.createElement("div");c.classList.add(Wt("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){let t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((e=>e.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}};function Fm(i){return i==="int"?"int":i==="float"?"float":void 0}function jo(i){return M(i,(t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Fm)}),expanded:t.optional.boolean,picker:t.optional.custom(Ru),readonly:t.optional.constant(!1)})))}function Te(i){return i?.1:1}function ou(i){var t;return(t=i.color)===null||t===void 0?void 0:t.type}var Yi=class{constructor(t,e){this.type="float",this.mode=e,this.comps_=Fu(t,e,this.type)}getComponents(t){return Tn(Mu(Pt(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}},Mm={int:(i,t)=>new C(i,t),float:(i,t)=>new Yi(i,t)};function bl(i,t,e){return Mm[e](i,t)}function Y(i,t){if(i.type===t)return i;if((function(e){return e.type==="int"})(i)&&t==="float")return(function(e){let s=e.getComponents(),n=We(e.mode,"int");return new Yi([f(s[0],0,n[0],0,1),f(s[1],0,n[1],0,1),f(s[2],0,n[2],0,1),s[3]],e.mode)})(i);if((function(e){return e.type==="float"})(i)&&t==="int")return(function(e){let s=e.getComponents(),n=We(e.mode,"int");return new C([Math.round(f(s[0],0,1,0,n[0])),Math.round(f(s[1],0,1,0,n[1])),Math.round(f(s[2],0,1,0,n[2])),s[3]],e.mode)})(i);throw dt.shouldNeverHappen()}function ut(i,t){let e=i.match(/^(.+)%$/);return Math.min(e?.01*parseFloat(e[1])*t:parseFloat(i),t)}var Dm={deg:i=>i,grad:i=>360*i/400,rad:i=>360*i/(2*Math.PI),turn:i=>360*i};function Du(i){let t=i.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(i);let e=parseFloat(t[1]),s=t[2];return Dm[s](e)}function Bu(i){let t=i.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[ut(t[1],255),ut(t[2],255),ut(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Bm(i){let t=Bu(i);return t?new C(t,"rgb"):null}function Ou(i){let t=i.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[ut(t[1],255),ut(t[2],255),ut(t[3],255),ut(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Om(i){let t=Ou(i);return t?new C(t,"rgb"):null}function Uu(i){let t=i.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Du(t[1]),ut(t[2],100),ut(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Um(i){let t=Uu(i);return t?new C(t,"hsl"):null}function Iu(i){let t=i.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Du(t[1]),ut(t[2],100),ut(t[3],100),ut(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Im(i){let t=Iu(i);return t?new C(t,"hsl"):null}function ju(i){let t=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];let e=i.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function jm(i){let t=ju(i);return t?new C(t,"rgb"):null}function zu(i){let t=i.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),f(parseInt(t[4]+t[4],16),0,255,0,1)];let e=i.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),f(parseInt(e[4],16),0,255,0,1)]:null}function zm(i){let t=zu(i);return t?new C(t,"rgb"):null}function Nu(i){let t=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function au(i){return t=>{let e=Nu(t);return e?bl(e,"rgb",i):null}}function Ku(i){let t=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function lu(i){return t=>{let e=Ku(t);return e?bl(e,"rgb",i):null}}var Nm=[{parser:ju,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:zu,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Bu,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ou,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Uu,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Iu,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Nu,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Ku,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Km(i,t="int"){let e=(function(s){return Nm.reduce(((n,{parser:r,result:o})=>n||(r(s)?o:null)),null)})(i);return e?e.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},e),{type:"int"}):e.notation==="func"?Object.assign(Object.assign({},e),{type:t}):null:null}function Mi(i){let t=[jm,zm,Bm,Om,Um,Im];i==="int"&&t.push(au("int"),lu("int")),i==="float"&&t.push(au("float"),lu("float"));let e=(function(s){return n=>s.reduce(((r,o)=>r!==null?r:o(n)),null)})(t);return s=>{let n=e(s);return n?Y(n,i):null}}function $m(i){let t=Mi("int");if(typeof i!="string")return C.black();let e=t(i);return e??C.black()}function $u(i){let t=R(Math.floor(i),0,255).toString(16);return t.length===1?`0${t}`:t}function _l(i,t="#"){return`${t}${Pt(i.getComponents("rgb")).map($u).join("")}`}function gl(i,t="#"){let e=i.getComponents("rgb");return`${t}${[e[0],e[1],e[2],255*e[3]].map($u).join("")}`}function qu(i){let t=$(0);return`rgb(${Pt(Y(i,"int").getComponents("rgb")).map((e=>t(e))).join(", ")})`}function Ns(i){let t=$(2),e=$(0);return`rgba(${Y(i,"int").getComponents("rgb").map(((s,n)=>(n===3?t:e)(s))).join(", ")})`}function Gu(i,t){let e=$(t==="float"?2:0),s=["r","g","b"];return`{${Pt(Y(i,t).getComponents("rgb")).map(((n,r)=>`${s[r]}: ${e(n)}`)).join(", ")}}`}function qm(i){return t=>Gu(t,i)}function Hu(i,t){let e=$(2),s=$(t==="float"?2:0),n=["r","g","b","a"];return`{${Y(i,t).getComponents("rgb").map(((r,o)=>`${n[o]}: ${(o===3?e:s)(r)}`)).join(", ")}}`}function Gm(i){return t=>Hu(t,i)}var Hm=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:_l},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:gl},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:qu},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Ns},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(i){let t=[$(0),Is,Is];return`hsl(${Pt(Y(i,"int").getComponents("hsl")).map(((e,s)=>t[s](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(i){let t=[$(0),Is,Is,$(2)];return`hsla(${Y(i,"int").getComponents("hsl").map(((e,s)=>t[s](e))).join(", ")})`}},...["int","float"].reduce(((i,t)=>[...i,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:qm(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Gm(t)}]),[])];function cu(i){return Hm.reduce(((t,e)=>{return t||(s=e.format,n=i,s.alpha===n.alpha&&s.mode===n.mode&&s.notation===n.notation&&s.type===n.type?e.stringifier:null);var s,n}),null)}var Ri=_("apl"),Ba=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ri()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("div");s.classList.add(Ri("b")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(Ri("c")),s.appendChild(n),this.colorElem_=n;let r=t.createElement("div");r.classList.add(Ri("m")),this.element.appendChild(r),this.markerElem_=r;let o=t.createElement("div");o.classList.add(Ri("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){let t=this.value.rawValue,e=t.getComponents("rgb"),s=new C([e[0],e[1],e[2],0],"rgb"),n=new C([e[0],e[1],e[2],255],"rgb"),r=["to right",Ns(s),Ns(n)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Ns(t);let o=f(e[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},Oa=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ba(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ft(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=t.point.x/t.bounds.width,n=this.value.rawValue,[r,o,a]=n.getComponents("hsv");this.value.setRawValue(new C([r,o,a,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(Te(!0),vt(t));if(e===0)return;let s=this.value.rawValue,[n,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new C([n,r,o,a+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){N(Te(!0),vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Ne=_("coltxt"),Ua=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ne()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Ne("m")),this.modeElem_=(function(o){let a=o.createElement("select");return a.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((l,c)=>{let u=o.createElement("option");return u.textContent=c.text,u.value=c.value,l.appendChild(u),l}),o.createDocumentFragment())),a})(t),this.modeElem_.classList.add(Ne("ms")),s.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);let n=t.createElement("div");n.classList.add(Ne("mm")),n.appendChild(kn(t,"dropdown")),s.appendChild(n),this.element.appendChild(s);let r=t.createElement("div");r.classList.add(Ne("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=e.inputViews,this.applyInputViews_(),ht(e.mode,(o=>{this.modeElem_.value=o}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){Pu(this.inputsElem_);let t=this.element.ownerDocument;this.inputViews_.forEach((e=>{let s=t.createElement("div");s.classList.add(Ne("c")),s.appendChild(e.element),this.inputsElem_.appendChild(s)}))}};function Xm(i,t,e){let s=We(i,t)[e];return new Pe({min:0,max:s})}function Ym(i,t){let e={colorMode:t.colorMode,colorType:t.colorType,parser:mt,viewProps:t.viewProps};return[0,1,2].map((s=>{let n=(function(r,o,a){return new Ve(r,{arrayPosition:a===0?"fst":a===2?"lst":"mid",parser:o.parser,props:b.fromObject({formatter:(l=o.colorType,$(l==="float"?2:0)),keyScale:Te(!1),pointerScale:o.colorType==="float"?.01:1}),value:F(0,{constraint:Xm(o.colorMode,o.colorType,a)}),viewProps:o.viewProps});var l})(i,e,s);return Ae({primary:t.value,secondary:n.value,forward:r=>Y(r,t.colorType).getComponents(t.colorMode)[s],backward(r,o){let a=t.colorMode,l=Y(r,t.colorType).getComponents(a);return l[s]=o,Y(bl(Tn(Pt(l),l[3]),a,t.colorType),"int")}}),n}))}var Ia=class{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=F(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Ua(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){let e=this.colorMode.rawValue;return(function(s){return s!=="hex"})(e)?Ym(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):(function(s,n){let r=new Qe(s,{parser:Mi("int"),props:b.fromObject({formatter:_l}),value:F(C.black()),viewProps:n.viewProps});return Ae({primary:n.value,secondary:r.value,forward:o=>new C(Pt(o.getComponents()),o.mode),backward:(o,a)=>new C(Tn(Pt(a.getComponents(o.mode)),o.getComponents()[3]),o.mode)}),[r]})(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){let e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((s=>s.view))}},zo=_("hpl"),ja=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(zo()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("div");s.classList.add(zo("c")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(zo("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){let t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=qu(new C([e,100,100],"hsv"));let s=f(e,0,360,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}},za=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ja(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ft(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=f(R(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),n=this.value.rawValue,[,r,o,a]=n.getComponents("hsv");this.value.setRawValue(new C([s,r,o,a],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(Te(!1),vt(t));if(e===0)return;let s=this.value.rawValue,[n,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new C([n+e,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){N(Te(!1),vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},No=_("svp"),Na=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(No()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("canvas");s.height=64,s.width=64,s.classList.add(No("c")),this.element.appendChild(s),this.canvasElement=s;let n=t.createElement("div");n.classList.add(No("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){let t=(function(c){let u=c.ownerDocument.defaultView;return u&&"document"in u?c.getContext("2d",{willReadFrequently:!0}):null})(this.canvasElement);if(!t)return;let e=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,n=this.canvasElement.height,r=t.getImageData(0,0,s,n),o=r.data;for(let c=0;c<n;c++)for(let u=0;u<s;u++){let h=f(u,0,s,0,100),p=f(c,0,n,100,0),d=Lu(e[0],h,p),m=4*(c*s+u);o[m]=d[0],o[m+1]=d[1],o[m+2]=d[2],o[m+3]=255}t.putImageData(r,0,0);let a=f(e[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;let l=f(e[2],0,100,100,0);this.markerElem_.style.top=`${l}%`}onValueChange_(){this.update_()}},Ka=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Na(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ft(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=f(t.point.x,0,t.bounds.width,0,100),n=f(t.point.y,0,t.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new C([r,s,n,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Qs(t.key)&&t.preventDefault();let[e,s,n,r]=this.value.rawValue.getComponents("hsv"),o=Te(!1),a=N(o,vt(t)),l=N(o,Se(t));a===0&&l===0||this.value.setRawValue(new C([e,s+a,n+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){let e=Te(!1),s=N(e,vt(t)),n=N(e,Se(t));s===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},$a=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new za(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ka(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Oa(t,{value:this.value,viewProps:this.viewProps}),text:new Ve(t,{parser:mt,props:b.fromObject({pointerScale:.01,keyScale:.1,formatter:$(2)}),value:F(0,{constraint:new Pe({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ae({primary:this.value,secondary:this.alphaIcs_.text.value,forward:s=>s.getComponents()[3],backward:(s,n)=>{let r=s.getComponents();return r[3]=n,new C(r,s.mode)}}),this.textsC_=new Ia(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Da(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}},Ko=_("colsw"),qa=class{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Ko()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Ko("sw")),this.element.appendChild(s),this.swatchElem_=s;let n=t.createElement("button");n.classList.add(Ko("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){let t=this.value.rawValue;this.swatchElem_.style.backgroundColor=gl(t)}onValueChange_(){this.update_()}},Ga=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new qa(t,{value:this.value,viewProps:this.viewProps})}},Di=class{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Xe.create(e.expanded),this.swatchC_=new Ga(t,{value:this.value,viewProps:this.viewProps});let s=this.swatchC_.view.buttonElement;s.addEventListener("blur",this.onButtonBlur_),s.addEventListener("click",this.onButtonClick_),this.textC_=new Qe(t,{parser:e.parser,props:b.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Ma(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Hi(t,{viewProps:this.viewProps}):null;let n=new $a(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach((r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),Ae({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Sn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,s=t.relatedTarget;s&&e.contains(s)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,s=pl(t);s&&e.contains(s)||s&&s===this.swatchC_.view.buttonElement&&!Pn(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function Qm(i){return Pt(i.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function Wm(i){return i.getComponents("rgb").reduce(((t,e,s)=>t<<8|255&Math.floor(s===3?255*e:e)),0)>>>0}function Jm(i){return typeof i!="number"?C.black():new C([(t=i)>>16&255,t>>8&255,255&t],"rgb");var t}function Zm(i){return typeof i!="number"?C.black():new C([(t=i)>>24&255,t>>16&255,t>>8&255,f(255&t,0,255,0,1)],"rgb");var t}function Ks(i,t){return typeof i=="object"&&!T(i)&&t in i&&typeof i[t]=="number"}function Xu(i){return Ks(i,"r")&&Ks(i,"g")&&Ks(i,"b")}function uu(i){return Xu(i)&&Ks(i,"a")}function Yu(i){return Xu(i)}function $o(i,t){if(i.mode!==t.mode||i.type!==t.type)return!1;let e=i.getComponents(),s=t.getComponents();for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function hu(i){return"a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b]}function tv(i,t){return(e,s)=>{i?(function(n,r,o){let a=Y(r,o).toRgbaObject();n.writeProperty("r",a.r),n.writeProperty("g",a.g),n.writeProperty("b",a.b),n.writeProperty("a",a.a)})(e,s,t):(function(n,r,o){let a=Y(r,o).toRgbaObject();n.writeProperty("r",a.r),n.writeProperty("g",a.g),n.writeProperty("b",a.b)})(e,s,t)}}function ev(i){return t=>{let e=(function(s,n){if(!Yu(s))return Y(C.black(),n);if(n==="int"){let r=hu(s);return new C(r,"rgb")}if(n==="float"){let r=hu(s);return new Yi(r,"rgb")}return Y(C.black(),"int")})(t,i);return Y(e,"int")}}function iv(i,t){return e=>i?Hu(e,t):Gu(e,t)}O({id:"input-color-number",type:"input",accept:(i,t)=>{if(typeof i!="number"||!(function(r){return"color"in r||r.view==="color"})(t))return null;let e=jo(t);return e?{initialValue:i,params:Object.assign(Object.assign({},e),{supportsAlpha:(s=t,!!(!((n=s?.color)===null||n===void 0)&&n.alpha))})}:null;var s,n},binding:{reader:i=>i.params.supportsAlpha?Zm:Jm,equals:$o,writer:i=>(function(t){let e=t?Wm:Qm;return(s,n)=>{ae(s,e(n))}})(i.params.supportsAlpha)},controller:i=>{var t,e,s;return new Di(i.document,{colorType:"int",expanded:(t=i.params.expanded)!==null&&t!==void 0&&t,formatter:(s=i.params.supportsAlpha,s?n=>gl(n,"0x"):n=>_l(n,"0x")),parser:Mi("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:i.params.supportsAlpha,value:i.value,viewProps:i.viewProps})}}),O({id:"input-color-object",type:"input",accept:(i,t)=>{var e;if(!Yu(i))return null;let s=jo(t);return s?{initialValue:i,params:Object.assign(Object.assign({},s),{colorType:(e=ou(t))!==null&&e!==void 0?e:"int"})}:null},binding:{reader:i=>ev(i.params.colorType),equals:$o,writer:i=>tv(uu(i.initialValue),i.params.colorType)},controller:i=>{var t,e;let s=uu(i.initialValue);return new Di(i.document,{colorType:i.params.colorType,expanded:(t=i.params.expanded)!==null&&t!==void 0&&t,formatter:iv(s,i.params.colorType),parser:Mi("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:s,value:i.value,viewProps:i.viewProps})}}),O({id:"input-color-string",type:"input",accept:(i,t)=>{if(typeof i!="string"||t.view==="text")return null;let e=Km(i,ou(t));if(!e)return null;let s=cu(e);if(!s)return null;let n=jo(t);return n?{initialValue:i,params:Object.assign(Object.assign({},n),{format:e,stringifier:s})}:null},binding:{reader:()=>$m,equals:$o,writer:i=>{let t=(function(e){let s=cu(e);return s?(n,r)=>{ae(n,s(r))}:null})(i.params.format);if(!t)throw dt.notBindable();return t}},controller:i=>{var t,e;return new Di(i.document,{colorType:i.params.format.type,expanded:(t=i.params.expanded)!==null&&t!==void 0&&t,formatter:i.params.stringifier,parser:Mi("int"),pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:i.params.format.alpha,value:i.value,viewProps:i.viewProps})}});var Je=class{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){let e=this.asm_.toComponents(t).map(((s,n)=>{var r,o;return(o=(r=this.components[n])===null||r===void 0?void 0:r.constrain(s))!==null&&o!==void 0?o:s}));return this.asm_.fromComponents(e)}},pu=_("pndtxt"),Ha=class{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(pu()),this.textViews.forEach((s=>{let n=t.createElement("div");n.classList.add(pu("a")),n.appendChild(s.element),this.element.appendChild(n)}))}},le=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((s,n)=>(function(r,o,a){return new Ve(r,{arrayPosition:a===0?"fst":a===o.axes.length-1?"lst":"mid",parser:o.parser,props:o.axes[a].textProps,value:F(0,{constraint:o.axes[a].constraint}),viewProps:o.viewProps})})(t,e,n))),this.acs_.forEach(((s,n)=>{Ae({primary:this.value,secondary:s.value,forward:r=>e.assembly.toComponents(r)[n],backward:(r,o)=>{let a=e.assembly.toComponents(r);return a[n]=o,e.assembly.fromComponents(a)}})})),this.view=new Ha(t,{textViews:this.acs_.map((s=>s.view))})}get textControllers(){return this.acs_}},Xa=class extends ji{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}};O({id:"input-number",type:"input",accept:(i,t)=>{if(typeof i!="number")return null;let e=M(t,(s=>Object.assign(Object.assign({},cl(s)),{options:s.optional.custom(Vn),readonly:s.optional.constant(!1)})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>rl,constraint:i=>(function(t,e){let s=[],n=ol(t,e);n&&s.push(n);let r=al(t);r&&s.push(r);let o=ml(t.options);return o&&s.push(o),new re(s)})(i.params,i.initialValue),writer:i=>ae},controller:i=>{let t=i.value,e=i.constraint,s=e&&Gi(e,Ye);if(s)return new oe(i.document,{props:new b({options:s.values.value("options")}),value:t,viewProps:i.viewProps});let n=ll(i.params,t.rawValue),r=e&&Gi(e,Pe);return r?new Ws(i.document,Object.assign(Object.assign({},(o=Object.assign(Object.assign({},n),{keyScale:F(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}),{sliderProps:new b({keyScale:o.keyScale,max:o.max,min:o.min}),textProps:new b({formatter:F(o.formatter),keyScale:o.keyScale,pointerScale:F(o.pointerScale)})})),{parser:mt,value:t,viewProps:i.viewProps})):new Ve(i.document,{parser:mt,props:b.fromObject(n),value:t,viewProps:i.viewProps});var o},api:i=>typeof i.controller.value.rawValue!="number"?null:i.controller.valueController instanceof Ws?new Xa(i.controller):i.controller.valueController instanceof oe?new qi(i.controller):null});var Et=class{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(T(t))return!1;let e=t.x,s=t.y;return typeof e=="number"&&typeof s=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}},Qu={toComponents:i=>i.getComponents(),fromComponents:i=>new Et(...i)},Ke=_("p2d"),Ya=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ke()),e.viewProps.bindClassModifiers(this.element),ht(e.expanded,ce(this.element,Ke(void 0,"expanded")));let s=t.createElement("div");s.classList.add(Ke("h")),this.element.appendChild(s);let n=t.createElement("button");n.classList.add(Ke("b")),n.appendChild(kn(t,"p2dpad")),e.viewProps.bindDisabled(n),s.appendChild(n),this.buttonElement=n;let r=t.createElement("div");if(r.classList.add(Ke("t")),s.appendChild(r),this.textElement=r,e.pickerLayout==="inline"){let o=t.createElement("div");o.classList.add(Ke("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}},Jt=_("p2dp"),Qa=class{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(Jt()),e.layout==="popup"&&this.element.classList.add(Jt(void 0,"p")),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Jt("p")),e.viewProps.bindTabIndex(s),this.element.appendChild(s),this.padElement=s;let n=t.createElementNS(z,"svg");n.classList.add(Jt("g")),this.padElement.appendChild(n),this.svgElem_=n;let r=t.createElementNS(z,"line");r.classList.add(Jt("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);let o=t.createElementNS(z,"line");o.classList.add(Jt("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);let a=t.createElementNS(z,"line");a.classList.add(Jt("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;let l=t.createElement("div");l.classList.add(Jt("m")),this.padElement.appendChild(l),this.markerElem_=l,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[t,e]=this.value.rawValue.getComponents(),s=this.props_.get("max"),n=f(t,-s,+s,0,100),r=f(e,-s,+s,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function du(i,t,e){return[N(t[0],vt(i)),N(t[1],Se(i))*(e?1:-1)]}var Wa=class{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Qa(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ft(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let s=this.props.get("max"),n=f(t.point.x,0,t.bounds.width,-s,+s),r=f(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-s,+s);this.value.setRawValue(new Et(n,r),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Qs(t.key)&&t.preventDefault();let[e,s]=du(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&s===0||this.value.setRawValue(new Et(this.value.rawValue.x+e,this.value.rawValue.y+s),{forceEmit:!1,last:!1})}onPadKeyUp_(t){let[e,s]=du(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Ja=class{constructor(t,e){var s,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Xe.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Hi(t,{viewProps:this.viewProps}):null;let r=new Wa(t,{layout:e.pickerLayout,props:new b({invertsY:F(e.invertsY),max:F(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach((o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=r,this.textC_=new le(t,{assembly:Qu,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Ya(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("blur",this.onPadButtonBlur_),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ae({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Sn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,s=t.relatedTarget;s&&e.contains(s)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,s=pl(t);s&&e.contains(s)||s&&s===this.view.buttonElement&&!Pn(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}};function sv(i){return Et.isObject(i)?new Et(i.x,i.y):new Et}function nv(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y)}function mu(i,t){var e,s;if(!T(i.min)||!T(i.max))return Math.max(Math.abs((e=i.min)!==null&&e!==void 0?e:0),Math.abs((s=i.max)!==null&&s!==void 0?s:0));let n=yu(i);return Math.max(10*Math.abs(n),10*Math.abs(t))}function rv(i,t){var e,s;let n=mu(Ee(i,(e=i.x)!==null&&e!==void 0?e:{}),t.x),r=mu(Ee(i,(s=i.y)!==null&&s!==void 0?s:{}),t.y);return Math.max(n,r)}function ov(i){if(!("y"in i))return!1;let t=i.y;return!!t&&"inverted"in t&&!!t.inverted}O({id:"input-point2d",type:"input",accept:(i,t)=>{if(!Et.isObject(i))return null;let e=M(t,(s=>Object.assign(Object.assign({},Xi(s)),{expanded:s.optional.boolean,picker:s.optional.custom(Ru),readonly:s.optional.constant(!1),x:s.optional.custom(ee),y:s.optional.object(Object.assign(Object.assign({},Xi(s)),{inverted:s.optional.boolean}))})));return e?{initialValue:i,params:e}:null},binding:{reader:()=>sv,constraint:i=>{return t=i.params,e=i.initialValue,new Je({assembly:Qu,components:[It(Object.assign(Object.assign({},t),t.x),e.x),It(Object.assign(Object.assign({},t),t.y),e.y)]});var t,e},equals:Et.equals,writer:()=>nv},controller:i=>{var t,e;let s=i.document,n=i.value,r=i.constraint,o=[i.params.x,i.params.y];return new Ja(s,{axes:n.rawValue.getComponents().map(((a,l)=>{var c;return ul({constraint:r.components[l],initialValue:a,params:Ee(i.params,(c=o[l])!==null&&c!==void 0?c:{})})})),expanded:(t=i.params.expanded)!==null&&t!==void 0&&t,invertsY:ov(i.params),max:rv(i.params,n.rawValue),parser:mt,pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",value:n,viewProps:i.viewProps})}});var ie=class{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(T(t))return!1;let e=t.x,s=t.y,n=t.z;return typeof e=="number"&&typeof s=="number"&&typeof n=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}},vu={toComponents:i=>i.getComponents(),fromComponents:i=>new ie(...i)};function av(i){return ie.isObject(i)?new ie(i.x,i.y,i.z):new ie}function lv(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y),i.writeProperty("z",t.z)}O({id:"input-point3d",type:"input",accept:(i,t)=>{if(!ie.isObject(i))return null;let e=M(t,(s=>Object.assign(Object.assign({},Xi(s)),{readonly:s.optional.constant(!1),x:s.optional.custom(ee),y:s.optional.custom(ee),z:s.optional.custom(ee)})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>av,constraint:i=>{return t=i.params,e=i.initialValue,new Je({assembly:vu,components:[It(Object.assign(Object.assign({},t),t.x),e.x),It(Object.assign(Object.assign({},t),t.y),e.y),It(Object.assign(Object.assign({},t),t.z),e.z)]});var t,e},equals:ie.equals,writer:i=>lv},controller:i=>{let t=i.value,e=i.constraint,s=[i.params.x,i.params.y,i.params.z];return new le(i.document,{assembly:vu,axes:t.rawValue.getComponents().map(((n,r)=>{var o;return ul({constraint:e.components[r],initialValue:n,params:Ee(i.params,(o=s[r])!==null&&o!==void 0?o:{})})})),parser:mt,value:t,viewProps:i.viewProps})}});var se=class{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.z=s,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(T(t))return!1;let e=t.x,s=t.y,n=t.z,r=t.w;return typeof e=="number"&&typeof s=="number"&&typeof n=="number"&&typeof r=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}},fu={toComponents:i=>i.getComponents(),fromComponents:i=>new se(...i)};function cv(i){return se.isObject(i)?new se(i.x,i.y,i.z,i.w):new se}function uv(i,t){i.writeProperty("x",t.x),i.writeProperty("y",t.y),i.writeProperty("z",t.z),i.writeProperty("w",t.w)}O({id:"input-point4d",type:"input",accept:(i,t)=>{if(!se.isObject(i))return null;let e=M(t,(s=>Object.assign(Object.assign({},Xi(s)),{readonly:s.optional.constant(!1),w:s.optional.custom(ee),x:s.optional.custom(ee),y:s.optional.custom(ee),z:s.optional.custom(ee)})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>cv,constraint:i=>{return t=i.params,e=i.initialValue,new Je({assembly:fu,components:[It(Object.assign(Object.assign({},t),t.x),e.x),It(Object.assign(Object.assign({},t),t.y),e.y),It(Object.assign(Object.assign({},t),t.z),e.z),It(Object.assign(Object.assign({},t),t.w),e.w)]});var t,e},equals:se.equals,writer:i=>uv},controller:i=>{let t=i.value,e=i.constraint,s=[i.params.x,i.params.y,i.params.z,i.params.w];return new le(i.document,{assembly:fu,axes:t.rawValue.getComponents().map(((n,r)=>{var o;return ul({constraint:e.components[r],initialValue:n,params:Ee(i.params,(o=s[r])!==null&&o!==void 0?o:{})})})),parser:mt,value:t,viewProps:i.viewProps})}}),O({id:"input-string",type:"input",accept:(i,t)=>{if(typeof i!="string")return null;let e=M(t,(s=>({readonly:s.optional.constant(!1),options:s.optional.custom(Vn)})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>fl,constraint:i=>(function(t){let e=[],s=ml(t.options);return s&&e.push(s),new re(e)})(i.params),writer:i=>ae},controller:i=>{let t=i.document,e=i.value,s=i.constraint,n=s&&Gi(s,Ye);return n?new oe(t,{props:new b({options:n.values.value("options")}),value:e,viewProps:i.viewProps}):new Qe(t,{parser:r=>r,props:b.fromObject({formatter:Sa}),value:e,viewProps:i.viewProps})},api:i=>typeof i.controller.value.rawValue!="string"?null:i.controller.valueController instanceof oe?new qi(i.controller):null});var Bi={monitor:{defaultInterval:200,defaultRows:3}},bu=_("mll"),Za=class{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(bu()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("textarea");s.classList.add(bu("i")),s.style.height=`calc(var(${Au("containerUnitSize")}) * ${e.rows})`,s.readOnly=!0,e.viewProps.bindDisabled(s),this.element.appendChild(s),this.textareaElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,s=[];this.value.rawValue.forEach((n=>{n!==void 0&&s.push(this.formatter_(n))})),t.textContent=s.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}},Qi=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Za(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}},_u=_("sgl"),tl=class{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(_u()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("input");s.classList.add(_u("i")),s.readOnly=!0,s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}},Wi=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new tl(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}};O({id:"monitor-bool",type:"monitor",accept:(i,t)=>{if(typeof i!="boolean")return null;let e=M(t,(s=>({readonly:s.required.constant(!0),rows:s.optional.number})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>vl},controller:i=>{var t;return i.value.rawValue.length===1?new Wi(i.document,{formatter:nu,value:i.value,viewProps:i.viewProps}):new Qi(i.document,{formatter:nu,rows:(t=i.params.rows)!==null&&t!==void 0?t:Bi.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}});var el=class extends ji{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}},Zt=_("grl"),il=class{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Zt()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let s=t.createElementNS(z,"svg");s.classList.add(Zt("g")),s.style.height=`calc(var(${Au("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(s),this.svgElem_=s;let n=t.createElementNS(z,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;let r=t.createElement("div");r.classList.add(Zt("t"),_("tt")()),this.element.appendChild(r),this.tooltipElem_=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,s=this.props_.get("min"),n=this.props_.get("max"),r=[];this.value.rawValue.forEach(((u,h)=>{if(u===void 0)return;let p=f(h,0,e,0,t.width),d=f(u,s,n,t.height,0);r.push([p,d].join(","))})),this.lineElem_.setAttributeNS(null,"points",r.join(" "));let o=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0)return void o.classList.remove(Zt("t","a"));let l=f(this.cursor_.rawValue,0,e,0,t.width),c=f(a,s,n,t.height,0);o.style.left=`${l}px`,o.style.top=`${c}px`,o.textContent=`${this.formatter_(a)}`,o.classList.contains(Zt("t","a"))||(o.classList.add(Zt("t","a"),Zt("t","in")),zs(o),o.classList.remove(Zt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Ji=class{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=F(-1),this.view=new il(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),Pn(t)){let s=new ft(this.view.element);s.emitter.on("down",this.onGraphPointerDown_),s.emitter.on("move",this.onGraphPointerMove_),s.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return bt(t,null,(e=>({max:e.required.number,min:e.required.number})),(e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0)))}exportProps(){return _t(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){let e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(f(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(f(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function qo(i){return T(i.format)?$(2):i.format}function gu(i){return i.view==="graph"}O({id:"monitor-number",type:"monitor",accept:(i,t)=>{if(typeof i!="number")return null;let e=M(t,(s=>({format:s.optional.function,max:s.optional.number,min:s.optional.number,readonly:s.required.constant(!0),rows:s.optional.number,view:s.optional.string})));return e?{initialValue:i,params:e}:null},binding:{defaultBufferSize:i=>gu(i)?64:1,reader:i=>rl},controller:i=>gu(i.params)?(function(t){var e,s,n;return new Ji(t.document,{formatter:qo(t.params),rows:(e=t.params.rows)!==null&&e!==void 0?e:Bi.monitor.defaultRows,props:b.fromObject({max:(s=t.params.max)!==null&&s!==void 0?s:100,min:(n=t.params.min)!==null&&n!==void 0?n:0}),value:t.value,viewProps:t.viewProps})})(i):(function(t){var e;return t.value.rawValue.length===1?new Wi(t.document,{formatter:qo(t.params),value:t.value,viewProps:t.viewProps}):new Qi(t.document,{formatter:qo(t.params),rows:(e=t.params.rows)!==null&&e!==void 0?e:Bi.monitor.defaultRows,value:t.value,viewProps:t.viewProps})})(i),api:i=>i.controller.valueController instanceof Ji?new el(i.controller):null}),O({id:"monitor-string",type:"monitor",accept:(i,t)=>{if(typeof i!="string")return null;let e=M(t,(s=>({multiline:s.optional.boolean,readonly:s.required.constant(!0),rows:s.optional.number})));return e?{initialValue:i,params:e}:null},binding:{reader:i=>fl},controller:i=>{var t;let e=i.value;return e.rawValue.length>1||i.params.multiline?new Qi(i.document,{formatter:Sa,rows:(t=i.params.rows)!==null&&t!==void 0?t:Bi.monitor.defaultRows,value:e,viewProps:i.viewProps}):new Wi(i.document,{formatter:Sa,value:e,viewProps:i.viewProps})}});var Zs=class{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return(t=this.controller_.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.props.set("title",t)}on(t,e){let s=e.bind(this);return this.controller_.emitter.on(t,(()=>{s(new ne(this))})),this}},sl=class extends ne{constructor(t,e,s){super(t),this.cell=e,this.index=s}},tn=class extends jt{constructor(t){super(t),this.cellToApiMap_=new Map,this.emitter_=new K;let e=this.controller.valueController;e.cellControllers.forEach(((s,n)=>{let r=new Zs(s);this.cellToApiMap_.set(s,r),s.emitter.on("click",(()=>{let o=n%e.size[0],a=Math.floor(n/e.size[0]);this.emitter_.emit("click",{event:new sl(this,r,[o,a])})}))}))}cell(t,e){let s=this.controller.valueController,n=s.cellControllers[e*s.size[0]+t];return this.cellToApiMap_.get(n)}on(t,e){let s=e.bind(this);return this.emitter_.on(t,(n=>{s(n.event)})),this}},en=class{constructor(t,e){this.size=e.size;let[s,n]=this.size,r=[];for(let o=0;o<n;o++)for(let a=0;a<s;a++){let l=new Gs(t,{props:b.fromObject(Object.assign({},e.cellConfig(a,o))),viewProps:zt.create()});r.push(l)}this.cellCs_=r,this.viewProps=zt.create(),this.viewProps.handleDispose((()=>{this.cellCs_.forEach((o=>{o.viewProps.set("disposed",!0)}))})),this.view=new Js(t,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${s}, 1fr)`,this.cellCs_.forEach((o=>{this.view.element.appendChild(o.view.element)}))}get cellControllers(){return this.cellCs_}},sn=class extends ke{constructor(t,e){let s=e.valueController,n=new Ge(t,{blade:e.blade,props:e.labelProps,valueController:s});super({blade:e.blade,view:n.view,viewProps:s.viewProps}),this.valueController=s,this.labelController=n}},hv=O({id:"buttongrid",type:"blade",accept(i){let t=M(i,(e=>({cells:e.required.function,size:e.required.array(e.required.number),view:e.required.constant("buttongrid"),label:e.optional.string})));return t?{params:t}:null},controller:i=>new sn(i.document,{blade:i.blade,labelProps:b.fromObject({label:i.params.label}),valueController:new en(i.document,{cellConfig:i.params.cells,size:i.params.size})}),api:i=>i.controller instanceof sn?new tn(i.controller):null}),nn=class extends jt{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get value(){return this.controller.valueController.value.rawValue}set value(t){this.controller.valueController.value.rawValue=t}on(t,e){let s=e.bind(this);return this.controller.valueController.value.emitter.on(t,(n=>{s(new qe(this,n.rawValue,n.options.last))})),this}};function ct(i,t,e){return i*(1-e)+t*e}function pv(i,t){let e=.25,s=.5,n=-1;for(let r=0;r<20;r++){let[o,a]=i.curve(s);if(s+=e*(o<t?1:-1),n=a,e*=.5,Math.abs(t-o)<.001)break}return n}var kt=class{constructor(t=0,e=0,s=1,n=1){this.cache_=[],this.comps_=[t,e,s,n]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(t){return!T(t)&&!!Array.isArray(t)&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="number"&&typeof t[3]=="number"}static equals(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2}curve(t){let e=ct(0,this.x1,t),s=ct(0,this.y1,t),n=ct(this.x1,this.x2,t),r=ct(this.y1,this.y2,t),o=ct(this.x2,1,t),a=ct(this.y2,1,t),l=ct(e,n,t),c=ct(s,r,t),u=ct(n,o,t),h=ct(r,a,t);return[ct(l,u,t),ct(c,h,t)]}y(t){if(this.cache_.length===0){let e=[];for(let s=0;s<100;s++)e.push(pv(this,f(s,0,99,0,1)));this.cache_=e}return this.cache_[Math.round(f(R(t,0,1),0,1,0,99))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}},wl={toComponents:i=>i.toObject(),fromComponents:i=>new kt(...i)};function dv(i){let t=$(2);return`cubic-bezier(${i.toObject().map((e=>t(e))).join(", ")})`}var wu=[0,.5,.5,1];function mv(i){let t=i.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!t)return new kt(...wu);let e=[t[1],t[2],t[3],t[4]].reduce(((s,n)=>{if(!s)return null;let r=Number(n);return isNaN(r)?null:[...s,r]}),[]);return new kt(...e??wu)}var Ce=_("cbz"),rn=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ce()),e.viewProps.bindClassModifiers(this.element),e.foldable.bindExpandedClass(this.element,Ce(void 0,"expanded")),pt(e.foldable,"completed",ce(this.element,Ce(void 0,"cpl")));let s=t.createElement("div");s.classList.add(Ce("h")),this.element.appendChild(s);let n=t.createElement("button");n.classList.add(Ce("b")),e.viewProps.bindDisabled(n);let r=t.createElementNS(z,"svg");r.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',n.appendChild(r),s.appendChild(n),this.buttonElement=n;let o=t.createElement("div");if(o.classList.add(Ce("t")),s.appendChild(o),this.textElement=o,e.pickerLayout==="inline"){let a=t.createElement("div");a.classList.add(Ce("p")),this.element.appendChild(a),this.pickerElement=a}else this.pickerElement=null}},Go=_("cbzp"),on=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Go()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("div");s.classList.add(Go("g")),this.element.appendChild(s),this.graphElement=s;let n=t.createElement("div");n.classList.add(Go("t")),this.element.appendChild(n),this.textElement=n}};function Wu(i,t){let e=new MutationObserver((n=>{for(let r of n)r.type==="childList"&&r.addedNodes.forEach((o=>{o.contains(o)&&(t(),e.disconnect())}))})),s=i.ownerDocument;e.observe(s.body,{attributes:!0,childList:!0,subtree:!0})}var te=_("cbzg"),an=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(te()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let s=t.createElement("div");s.classList.add(te("p")),this.element.appendChild(s),this.previewElement=s;let n=t.createElementNS(z,"svg");n.classList.add(te("g")),this.element.appendChild(n),this.svgElem_=n;let r=t.createElementNS(z,"path");r.classList.add(te("u")),this.svgElem_.appendChild(r),this.guideElem_=r;let o=t.createElementNS(z,"polyline");o.classList.add(te("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[t.createElement("div"),t.createElement("div")],this.handleElems_.forEach((a=>{a.classList.add(te("h")),this.element.appendChild(a)})),this.vectorElems_=[t.createElementNS(z,"line"),t.createElementNS(z,"line")],this.vectorElems_.forEach((a=>{a.classList.add(te("v")),this.svgElem_.appendChild(a)})),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=e.selection,this.handleElems_.forEach(((a,l)=>{var c,u;ht(this.sel_,(c=h=>h===l,u=ce(a,te("h","sel")),h=>u(c(h))))})),Wu(this.element,(()=>{this.refresh()}))}getVertMargin_(t){return .25*t}valueToPosition(t,e){let s=this.element.getBoundingClientRect(),n=s.width,r=s.height,o=this.getVertMargin_(r);return{x:f(t,0,1,0,n),y:f(e,0,1,r-o,o)}}positionToValue(t,e){let s=this.element.getBoundingClientRect(),n=s.width,r=s.height,o=this.getVertMargin_(r);return{x:R(f(t,0,n,0,1),0,1),y:f(e,r-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map((r=>{let o=this.valueToPosition(0,r),a=this.valueToPosition(1,r);return[`M ${o.x},${o.y}`,`L ${a.x},${a.y}`].join(" ")})).join(" "));let t=this.value_.rawValue,e=[],s=0;for(;;){let r=this.valueToPosition(...t.curve(s));if(e.push([r.x,r.y].join(",")),s>=1)break;s=Math.min(s+.05,1)}this.lineElem_.setAttributeNS(null,"points",e.join(" "));let n=t.toObject();[0,1].forEach((r=>{let o=this.valueToPosition(r,r),a=this.valueToPosition(n[2*r],n[2*r+1]),l=this.vectorElems_[r];l.setAttributeNS(null,"x1",String(o.x)),l.setAttributeNS(null,"y1",String(o.y)),l.setAttributeNS(null,"x2",String(a.x)),l.setAttributeNS(null,"y2",String(a.y));let c=this.handleElems_[r];c.style.left=`${a.x}px`,c.style.top=`${a.y}px`}))}onValueChange_(){this.refresh()}},$e=_("cbzprv"),ln=class{constructor(t,e){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add($e()),e.viewProps.bindClassModifiers(this.element);let s=t.createElementNS(z,"svg");s.classList.add($e("g")),this.element.appendChild(s),this.svgElem_=s;let n=t.createElementNS(z,"path");n.classList.add($e("t")),this.svgElem_.appendChild(n),this.ticksElem_=n;let r=t.createElement("div");r.classList.add($e("m")),this.element.appendChild(r),this.markerElem_=r,this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_),e.viewProps.handleDispose(this.onDispose_),Wu(this.element,(()=>{this.refresh()}))}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add($e("m","a")),this.startTime_=new Date().getTime()+400,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove($e("m","a"))}onDispose_(){this.stop()}updateMarker_(t){let e=this.value_.rawValue.y(R(t,0,1));this.markerElem_.style.left=100*e+"%"}refresh(){let t=this.svgElem_.getBoundingClientRect(),e=t.width,s=t.height,n=[],r=this.value_.rawValue;for(let o=0;o<24;o++){let a=f(o,0,23,0,1),l=f(r.y(a),0,1,0,e);n.push(`M ${l},0 v${s}`)}this.ticksElem_.setAttributeNS(null,"d",n.join(" "))}onTimer_(){if(this.startTime_===null)return;let t=new Date().getTime()-this.startTime_,e=t/1e3;this.updateMarker_(e),t>1400&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}};function Ho(i,t,e,s){let n=e-i,r=s-t;return Math.sqrt(n*n+r*r)}var cn=class{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=e.keyScale,this.value=e.value,this.sel_=F(0),this.viewProps=e.viewProps,this.view=new an(t,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new ln(t,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",(n=>{n.stopImmediatePropagation(),n.preventDefault(),this.prevView_.play()})),this.view.previewElement.appendChild(this.prevView_.element);let s=new ft(this.view.element);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(t,e,s){let n=this.sel_.rawValue,r=this.value.rawValue.toObject(),o=this.view.positionToValue(t.x,t.y),a=e?(function(l,c,u,h){let p=Ho(l,c,u,h),d=Math.atan2(h-c,u-l),m=Math.round(d/(Math.PI/4))*Math.PI/4;return{x:l+Math.cos(m)*p,y:c+Math.sin(m)*p}})(n,n,o.x,o.y):o;r[2*n]=a.x,r[2*n+1]=a.y,this.value.setRawValue(new kt(...r),s)}onPointerDown_(t){let e=t.data;if(!e.point)return;let s=this.value.rawValue,n=this.view.valueToPosition(s.x1,s.y1),r=Ho(e.point.x,e.point.y,n.x,n.y),o=this.view.valueToPosition(s.x2,s.y2),a=Ho(e.point.x,e.point.y,o.x,o.y);this.sel_.rawValue=r<=a?0:1,this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(t){let e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(t){let e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(t){Qs(t.key)&&t.preventDefault();let e=this.sel_.rawValue,s=this.value.rawValue.toObject(),n=this.keyScale_.rawValue;s[2*e]+=N(n,vt(t)),s[2*e+1]+=N(n,Se(t)),this.value.setRawValue(new kt(...s),{forceEmit:!1,last:!1})}onKeyUp_(t){Qs(t.key)&&t.preventDefault();let e=this.keyScale_.rawValue,s=N(e,vt(t)),n=N(e,Se(t));s===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},un=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new on(t,{viewProps:this.viewProps}),this.gc_=new cn(t,{keyScale:e.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);let s=Object.assign(Object.assign({},e.axis),{constraint:new Oi({max:1,min:0})}),n=Object.assign(Object.assign({},e.axis),{constraint:void 0});this.tc_=new le(t,{assembly:wl,axes:[s,n,s,n],parser:mt,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map((t=>t.inputElement))]}refresh(){this.gc_.refresh()}},Zi=class{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Xe.create(e.expanded),this.view=new rn(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Qe(t,{parser:mv,props:b.fromObject({formatter:dv}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=e.pickerLayout==="popup"?new Hi(t,{viewProps:this.viewProps}):null;let s=new un(t,{axis:e.axis,value:this.value,viewProps:this.viewProps});s.allFocusableElements.forEach((n=>{n.addEventListener("blur",this.onPopupChildBlur_),n.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ht(this.popC_.shows,(n=>{n&&s.refresh()})),Ae({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:n=>n,backward:(n,r)=>r})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Sn(this.foldable_,this.view.pickerElement))}onButtonBlur_(t){if(!this.popC_)return;let e=t.relatedTarget;e&&this.popC_.view.element.contains(e)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,s=pl(t);s&&e.contains(s)||s&&s===this.view.buttonElement&&!Pn(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_&&t.key==="Escape"&&(this.popC_.shows.rawValue=!1)}},vv=O({id:"cubicbezier",type:"blade",accept(i){let t=M(i,(e=>({value:e.required.array(e.required.number),view:e.required.constant("cubicbezier"),expanded:e.optional.boolean,label:e.optional.string,picker:e.optional.custom((s=>s==="inline"||s==="popup"?s:void 0))})));return t?{params:t}:null},controller(i){var t,e;let s=F(new kt(...i.params.value),{constraint:new Je({assembly:wl,components:[0,1,2,3].map((r=>r%2==0?new Oi({min:0,max:1}):void 0))}),equals:kt.equals}),n=new Zi(i.document,{axis:{textProps:b.fromObject({keyScale:.1,pointerScale:.01,formatter:$(2)})},expanded:(t=i.params.expanded)!==null&&t!==void 0&&t,pickerLayout:(e=i.params.picker)!==null&&e!==void 0?e:"popup",value:s,viewProps:i.viewProps});return new He(i.document,{blade:i.blade,props:b.fromObject({label:i.params.label}),value:s,valueController:n})},api:i=>i.controller instanceof He&&i.controller.valueController instanceof Zi?new nn(i.controller):null}),hn=class extends jt{begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}},pn=class{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(t){this.start_=t.getTime()}calculateFps_(t){if(this.timestamps_.length===0)return null;let e=this.timestamps_[0];return 1e3*(this.frameCount_-e.frameCount)/(t-e.time)}compactTimestamps_(){if(this.timestamps_.length<=20)return;let t=this.timestamps_.length-20;this.timestamps_.splice(0,t);let e=this.timestamps_[0].frameCount;this.timestamps_.forEach((s=>{s.frameCount-=e})),this.frameCount_-=e}end(t){if(this.start_===null)return;let e=t.getTime();this.duration_=e-this.start_,this.start_=null,this.fps_=this.calculateFps_(e),this.timestamps_.push({frameCount:this.frameCount_,time:e}),++this.frameCount_,this.compactTimestamps_()}},Li=_("fps"),dn=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Li()),e.viewProps.bindClassModifiers(this.element),this.graphElement=t.createElement("div"),this.graphElement.classList.add(Li("g")),this.element.appendChild(this.graphElement);let s=t.createElement("div");s.classList.add(Li("l")),this.element.appendChild(s);let n=t.createElement("span");n.classList.add(Li("v")),n.textContent="--",s.appendChild(n),this.valueElement=n;let r=t.createElement("span");r.classList.add(Li("u")),r.textContent="FPS",s.appendChild(r)}},mn=class{constructor(t,e){this.stopwatch_=new pn,this.onTick_=this.onTick_.bind(this),this.ticker_=e.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=e.value,this.viewProps=e.viewProps,this.view=new dn(t,{viewProps:this.viewProps}),this.graphC_=new Ji(t,{formatter:$(0),props:b.fromObject({max:e.maxValue,min:e.minValue}),rows:e.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose((()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()}))}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){let t=this.stopwatch_.fps;if(t!==null){let e=this.value_.rawValue;this.value_.rawValue=(function(s,n){let r=[...km(s),n];return r.length>s.length?r.splice(0,r.length-s.length):ku(r,s.length),r})(e,t),this.view.valueElement.textContent=t.toFixed(0)}}},vn=class extends ke{constructor(t,e){let s=e.valueController,n=new Ge(t,{blade:e.blade,props:e.labelProps,valueController:s});super({blade:e.blade,view:n.view,viewProps:s.viewProps}),this.valueController=s,this.labelController=n}};function fv(i,t){return t===0?new Ca:new ya(i,t??Bi.monitor.defaultInterval)}var bv=O({id:"fpsgraph",type:"blade",accept(i){let t=M(i,(e=>({view:e.required.constant("fpsgraph"),interval:e.optional.number,label:e.optional.string,rows:e.optional.number,max:e.optional.number,min:e.optional.number})));return t?{params:t}:null},controller(i){var t,e,s,n;let r=(t=i.params.interval)!==null&&t!==void 0?t:500;return new vn(i.document,{blade:i.blade,labelProps:b.fromObject({label:i.params.label}),valueController:new mn(i.document,{rows:(e=i.params.rows)!==null&&e!==void 0?e:2,maxValue:(s=i.params.max)!==null&&s!==void 0?s:90,minValue:(n=i.params.min)!==null&&n!==void 0?n:0,ticker:fv(i.document,r),value:F(Pm(80)),viewProps:i.viewProps})})},api:i=>i.controller instanceof vn?new hn(i.controller):null}),Q=class{constructor(t,e){this.min=t,this.max=e}static isObject(t){if(typeof t!="object"||t===null)return!1;let e=t.min,s=t.max;return typeof e=="number"&&typeof s=="number"}static equals(t,e){return t.min===e.min&&t.max===e.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}},xl={fromComponents:i=>new Q(i[0],i[1]),toComponents:i=>[i.min,i.max]},ts=class{constructor(t){this.edge=t}constrain(t){var e,s,n,r,o,a,l,c;if(t.min<=t.max)return new Q((s=(e=this.edge)===null||e===void 0?void 0:e.constrain(t.min))!==null&&s!==void 0?s:t.min,(r=(n=this.edge)===null||n===void 0?void 0:n.constrain(t.max))!==null&&r!==void 0?r:t.max);let u=(t.min+t.max)/2;return new Q((a=(o=this.edge)===null||o===void 0?void 0:o.constrain(u))!==null&&a!==void 0?a:u,(c=(l=this.edge)===null||l===void 0?void 0:l.constrain(u))!==null&&c!==void 0?c:u)}},Xo=_("rsltxt"),fn=class{constructor(t,e){this.sliderView_=e.sliderView,this.textView_=e.textView,this.element=t.createElement("div"),this.element.classList.add(Xo());let s=t.createElement("div");s.classList.add(Xo("s")),s.appendChild(this.sliderView_.element),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(Xo("t")),n.appendChild(this.textView_.element),this.element.appendChild(n)}},ye=_("rsl"),bn=class{constructor(t,e){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=e.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=t.createElement("div"),this.element.classList.add(ye()),e.viewProps.bindClassModifiers(this.element),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_);let s=t.createElement("div");s.classList.add(ye("t")),this.element.appendChild(s),this.trackElement=s;let n=t.createElement("div");n.classList.add(ye("b")),s.appendChild(n),this.barElement=n;let r=["min","max"].map((o=>{let a=t.createElement("div");return a.classList.add(ye("k"),ye("k",o)),s.appendChild(a),a}));this.knobElements=[r[0],r[1]],this.update_()}valueToX_(t){return 100*R(f(t,this.sliderProps_.get("min"),this.sliderProps_.get("max"),0,1),0,1)}update_(){let t=this.value_.rawValue;t.length===0?this.element.classList.add(ye(void 0,"zero")):this.element.classList.remove(ye(void 0,"zero"));let e=[this.valueToX_(t.min),this.valueToX_(t.max)];this.barElement.style.left=`${e[0]}%`,this.barElement.style.right=100-e[1]+"%",this.knobElements.forEach(((s,n)=>{s.style.left=`${e[n]}%`}))}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}},_n=class{constructor(t,e){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=e.sliderProps,this.viewProps=e.viewProps,this.value=e.value,this.view=new bn(t,{sliderProps:this.sliderProps,value:this.value,viewProps:e.viewProps});let s=new ft(this.view.trackElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(t){return t.point?f((t.point.x+this.ofs_())/t.bounds.width,0,1,this.sliderProps.get("min"),this.sliderProps.get("max")):null}onPointerDown_(t){if(!t.data.point)return;let e=t.data.point.x/t.data.bounds.width,s=this.value.rawValue,n=this.sliderProps.get("min"),r=this.sliderProps.get("max"),o=f(s.min,n,r,0,1),a=f(s.max,n,r,0,1);Math.abs(a-e)<=.025?this.grabbing_="max":Math.abs(o-e)<=.025?this.grabbing_="min":e>=o&&e<=a?(this.grabbing_="length",this.grabOffset_=f(e-o,0,1,0,r-n)):e<o?(this.grabbing_="min",this.onPointerMove_(t)):e>a&&(this.grabbing_="max",this.onPointerMove_(t))}applyPointToValue_(t,e){let s=this.valueFromData_(t);if(s===null)return;let n=this.sliderProps.get("min"),r=this.sliderProps.get("max");if(this.grabbing_==="min")this.value.setRawValue(new Q(s,this.value.rawValue.max),e);else if(this.grabbing_==="max")this.value.setRawValue(new Q(this.value.rawValue.min,s),e);else if(this.grabbing_==="length"){let o=this.value.rawValue.length,a=s-this.grabOffset_,l=a+o;a<n?(a=n,l=n+o):l>r&&(a=r-o,l=r),this.value.setRawValue(new Q(a,l),e)}}onPointerMove_(t){this.applyPointToValue_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.applyPointToValue_(t.data,{forceEmit:!0,last:!0}),this.grabbing_=null}},gn=class{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sc_=new _n(t,e);let s={constraint:e.constraint,textProps:e.textProps};this.tc_=new le(t,{assembly:xl,axes:[s,s],parser:e.parser,value:this.value,viewProps:e.viewProps}),this.view=new fn(t,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}};function _v(i){return Q.isObject(i)?new Q(i.min,i.max):new Q(0,0)}function gv(i,t){i.writeProperty("max",t.max),i.writeProperty("min",t.min)}var wv=O({id:"input-interval",type:"input",accept:(i,t)=>{if(!Q.isObject(i))return null;let e=M(t,(s=>Object.assign(Object.assign({},cl(s)),{readonly:s.optional.constant(!1)})));return e?{initialValue:new Q(i.min,i.max),params:e}:null},binding:{reader:i=>_v,constraint:i=>(function(t){let e=[],s=al(t);s&&e.push(s);let n=ol(t);return n&&e.push(n),new ts(new re(e))})(i.params),equals:Q.equals,writer:i=>gv},controller(i){let t=i.value,e=i.constraint;if(!(e instanceof ts))throw dt.shouldNeverHappen();let s=(t.rawValue.min+t.rawValue.max)/2,n=b.fromObject(ll(i.params,s)),r=e.edge&&Gi(e.edge,Pe);if(r)return new gn(i.document,{constraint:e.edge,parser:mt,sliderProps:new b({keyScale:n.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:n,value:t,viewProps:i.viewProps});let o={constraint:e.edge,textProps:n};return new le(i.document,{assembly:xl,axes:[o,o],parser:mt,value:t,viewProps:i.viewProps})}}),wn=class{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return(t=this.controller_.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.props.set("title",t)}},xn=class extends qe{constructor(t,e,s,n,r){super(t,n,r),this.cell=e,this.index=s}},Cn=class extends jt{constructor(t){super(t),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach((e=>{let s=new wn(e);this.cellToApiMap_.set(e,s)}))}get value(){return this.controller.value}cell(t,e){let s=this.controller.valueController,n=s.cellControllers[e*s.size[0]+t];return this.cellToApiMap_.get(n)}on(t,e){let s=e.bind(this);this.controller.value.emitter.on(t,(n=>{let r=this.controller.valueController,o=r.findCellByValue(n.rawValue);if(!o)return;let a=this.cellToApiMap_.get(o);if(!a)return;let l=r.cellControllers.indexOf(o);s(new xn(this,a,[l%r.size[0],Math.floor(l/r.size[0])],n.rawValue))}))}},Fi=_("rad"),yn=class{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Fi()),e.viewProps.bindClassModifiers(this.element);let s=t.createElement("label");s.classList.add(Fi("l")),this.element.appendChild(s);let n=t.createElement("input");n.classList.add(Fi("i")),n.name=e.name,n.type="radio",e.viewProps.bindDisabled(n),s.appendChild(n),this.inputElement=n;let r=t.createElement("div");r.classList.add(Fi("b")),s.appendChild(r);let o=t.createElement("div");o.classList.add(Fi("t")),r.appendChild(o),pt(e.props,"title",(a=>{o.textContent=a}))}},En=class{constructor(t,e){this.props=e.props,this.viewProps=e.viewProps,this.view=new yn(t,{name:e.name,props:this.props,viewProps:this.viewProps})}},Ze=class{constructor(t,e){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=e.size;let[s,n]=this.size;for(let r=0;r<n;r++)for(let o=0;o<s;o++){let a=new En(t,{name:e.groupName,props:b.fromObject(Object.assign({},e.cellConfig(o,r))),viewProps:zt.create()});this.cellCs_.push(a),this.cellValues_.push(e.cellConfig(o,r).value)}this.value=e.value,ht(this.value,(r=>{let o=this.findCellByValue(r);o&&(o.view.inputElement.checked=!0)})),this.viewProps=zt.create(),this.view=new Js(t,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${s}, 1fr)`,this.cellCs_.forEach((r=>{r.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(r.view.element)}))}get cellControllers(){return this.cellCs_}findCellByValue(t){let e=this.cellValues_.findIndex((s=>s===t));return e<0?null:this.cellCs_[e]}onCellInputChange_(t){let e=t.currentTarget,s=this.cellCs_.findIndex((n=>n.view.inputElement===e));s<0||(this.value.rawValue=this.cellValues_[s])}},xv=O({id:"radiogrid",type:"blade",accept(i){let t=M(i,(e=>({cells:e.required.function,groupName:e.required.string,size:e.required.array(e.required.number),value:e.required.raw,view:e.required.constant("radiogrid"),label:e.optional.string})));return t?{params:t}:null},controller(i){let t=F(i.params.value);return new He(i.document,{blade:i.blade,props:b.fromObject({label:i.params.label}),value:t,valueController:new Ze(i.document,{groupName:i.params.groupName,cellConfig:i.params.cells,size:i.params.size,value:t})})},api:i=>i.controller instanceof He&&i.controller.valueController instanceof Ze?new Cn(i.controller):null});function Cl(i){return O({id:"input-radiogrid",type:"input",accept(t,e){if(!i.isType(t))return null;let s=M(e,(n=>({cells:n.required.function,groupName:n.required.string,size:n.required.array(n.required.number),view:n.required.constant("radiogrid")})));return s?{initialValue:t,params:s}:null},binding:i.binding,controller:t=>new Ze(t.document,{cellConfig:t.params.cells,groupName:t.params.groupName,size:t.params.size,value:t.value})})}var Cv=Cl({isType:i=>typeof i=="number",binding:{reader:i=>rl,writer:i=>ae}}),yv=Cl({isType:i=>typeof i=="string",binding:{reader:i=>fl,writer:i=>ae}}),Ev="essentials",Pv='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz) * 5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',kv=[hv,vv,bv,wv,xv,Cl({isType:i=>typeof i=="boolean",binding:{reader:i=>vl,writer:i=>ae}}),Cv,yv];function Sv(i,t,e){let s=[],n=new Map;for(let[r,o]of Object.entries(e))o.category&&(n.has(o.category)||n.set(o.category,[]),n.get(o.category).push({key:r,...o}));for(let[r,o]of n){let a=i.addFolder({title:r});for(let l of o)if(typeof l.default=="string"&&l.default.startsWith("hsl(")){let u=a.addBinding(t,l.key,{label:l.label,picker:"inline",expanded:!1});l.onChange&&u.on("change",h=>{l.onChange(h.value,t)})}else if(l.isBoolean){let u={value:t[l.key]>.5};s.push({configKey:l.key,proxy:u}),a.addBinding(u,"value",{label:l.label}).on("change",h=>{t[l.key]=h.value?1:0})}else if(l.options){let u=a.addBinding(t,l.key,{label:l.label,options:l.options});l.onChange&&u.on("change",h=>{l.onChange(h.value,t)})}else{let u=a.addBinding(t,l.key,{label:l.label,min:l.min,max:l.max,step:l.step});l.onChange&&u.on("change",h=>{l.onChange(h.value,t)})}}i._boolProxies=s}var k={fps:0,frameTime:0,totalPassTime:0,passBreakdown:"\u2014",device:"\u2014",resolution:"\u2014",effectsBreakdown:"\u2014",gpuInfo:"\u2014"};function Vv(i,t,e,s,n){let r=null;n&&(r=i.addBlade({view:"fpsgraph",label:"FPS",rows:3}),i.addBlade({view:"separator"}));let o=i.addFolder({title:"Frame"});n||o.addBinding(k,"fps",{label:"FPS",readonly:!0,view:"graph",min:0,max:144,interval:200}),o.addBinding(k,"frameTime",{label:"Frame Time (ms)",readonly:!0,view:"graph",min:0,max:33.3,interval:200});let a=i.addFolder({title:"Render Passes"});a.addBinding(k,"totalPassTime",{label:"Total (ms)",readonly:!0,view:"graph",min:0,max:16,interval:200}),k.passBreakdown="\u2014",a.addBinding(k,"passBreakdown",{label:"Pass Details",readonly:!0,multiline:!0,rows:7});let l=i.addFolder({title:"System",expanded:!0});l.addBinding(k,"device",{label:"Device",readonly:!0,interval:2e3}),l.addBinding(k,"resolution",{label:"Resolution",readonly:!0,interval:2e3}),s.particleCount!==void 0&&(k.particleInfo="\u2014",l.addBinding(k,"particleInfo",{label:"Particles",readonly:!0,interval:2e3})),s.waveComplexity!==void 0&&(k.waveInfo="\u2014",l.addBinding(k,"waveInfo",{label:"Wave Layers",readonly:!0,interval:2e3})),k.effectsBreakdown="\u2014",l.addBinding(k,"effectsBreakdown",{label:"Post-FX",readonly:!0,multiline:!0,rows:5}),k.gpuInfo="\u2014",l.addBinding(k,"gpuInfo",{label:"GPU",readonly:!0,interval:5e3});function c(){let u=t.sampleData;if(!u)return;if(k.fps=u.fps,k.frameTime=parseFloat(u.avgFrameTime),k.device=`${e.device} ${e.isPortrait?"portrait":"landscape"} (${e.displaySize.width}\xD7${e.displaySize.height})`,k.resolution=`${e.renderSize.width}\xD7${e.renderSize.height} (${s.canvasResolutionMultiplier}\xD7)`,k.gpuInfo==="\u2014"&&t.gl){let p=t.gl.getExtension("WEBGL_debug_renderer_info");if(p){let d=t.gl.getParameter(p.UNMASKED_RENDERER_WEBGL);d=d.replace(/^ANGLE\s*\(/i,"").replace(/\)$/,"").replace(/Direct3D\d+/gi,"").replace(/\s+/g," ").trim(),k.gpuInfo=d||"Unknown"}else k.gpuInfo="Extension not available"}if(u.cpuPassTimings){let p=Object.entries(u.cpuPassTimings);k.totalPassTime=p.reduce((m,[v,E])=>m+E.cpu,0);let d=p.map(([m,v])=>`${m.padEnd(14)} ${v.cpu.toFixed(2)}ms`);k.passBreakdown=d.join(`
`)}let h=[];if(s.bloomIntensity!==void 0&&s.bloomIntensity>0){let p=s.bloomQuality!==void 0?`Q${s.bloomQuality}`:"";h.push(`Bloom        ${p} @ ${(s.bloomIntensity*100).toFixed(0)}%`)}if(s.blurIntensity!==void 0&&s.blurIntensity>0){let p=s.blurRadius!==void 0?`r${s.blurRadius.toFixed(1)}`:"";h.push(`Blur         ${p} @ ${(s.blurIntensity*100).toFixed(0)}%`)}if(s.chromaticIntensity!==void 0&&s.chromaticIntensity>0&&h.push(`Aberration   ${(s.chromaticIntensity*1e3).toFixed(1)} units`),s.grainIntensity!==void 0&&s.grainIntensity>0){let p=s.grainColored!==void 0&&s.grainColored>.5?"color":"mono";h.push(`Grain        ${(s.grainIntensity*100).toFixed(0)}% ${p}`)}s.particleCount!==void 0&&(k.particleInfo=s.particleCount.toLocaleString()),s.waveComplexity!==void 0&&(k.waveInfo=`${s.waveComplexity} layers`),k.effectsBreakdown=h.length>0?h.join(`
`):"None active"}return{fpsGraph:r,pollMetrics:c}}function Ju(i,t,e,s,n,r,o={name:"Tweakpane"}){let a=new i({title:o.name}),l=!1;if(t)try{a.registerPlugin(t),l=!0}catch(d){console.warn("Failed to register EssentialsPlugin:",d)}else console.warn("EssentialsPlugin not provided - FPS graph unavailable");let c=a.addTab({pages:[{title:"Controls"},{title:"Monitor"}]});Sv(c.pages[0],e,s);let{fpsGraph:u,pollMetrics:h}=Vv(c.pages[1],n,r,e,l),p=a.refresh.bind(a);return a.refresh=function(){let d=c.pages[0]._boolProxies||[];for(let{configKey:m,proxy:v}of d)v.value=e[m]>.5;p()},{pane:a,fpsGraph:u,pollMetrics:h}}var Rn=Re.isDev!==!1;console.log(`Running in ${Rn?"development":"production"} mode`);var El=class{static getAngle(t,e,s,n){return Tl.perlin3(t*n.noiseScale,e*n.noiseScale,s*n.noiseSpeed)*Math.PI*2}},Pl=class{constructor(t,e,s={x:1,y:1}){this.count=t,this.config=e,this.aspectCorrection=s,this.data=new Float32Array(t*6),this.attractorPos={x:0,y:0},this.noiseTime=0,this.initialize()}initialize(){for(let t=0;t<this.data.length;t+=6)this.respawn(t)}respawn(t){let e,s;if(this.config.spawnRandom>.5)e=Math.random()*2-1,s=Math.random()*2-1;else{let n=Math.random()*Math.PI*2,r=this.config.spawnRadius;e=Math.cos(n)*r*this.aspectCorrection.x,s=Math.sin(n)*r*this.aspectCorrection.y}this.data[t]=e,this.data[t+1]=s,this.data[t+2]=0,this.data[t+3]=0,this.data[t+4]=0,this.data[t+5]=(Math.random()-.5)*2}update(t){let{attractionStrength:e,maxSpeed:s,fadeOutDistance:n,flowFieldStrength:r}=this.config;this.noiseTime+=t;for(let o=0;o<this.data.length;o+=6){let a=this.data[o],l=this.data[o+1],c=this.data[o+2],u=this.data[o+3],h=this.data[o+4],p=this.attractorPos.x-a,d=this.attractorPos.y-l,m=p*p+d*d,v=Math.sqrt(m);if(v>.001){let B=e/(m+1e-4);c+=p*B,u+=d*B}if(r>0){let B=El.getAngle(a,l,this.noiseTime,this.config);c+=Math.cos(B)*r,u+=Math.sin(B)*r}let E=Math.sqrt(c*c+u*u);E>s&&(c=c/E*s,u=u/E*s),this.data[o]+=c,this.data[o+1]+=u,h+=t,this.data[o+4]=h;let P=this.data[o],D=this.data[o+1];v<n*.3||P<-1.4||P>1.4||D<-1.4||D>1.4?this.respawn(o):(this.data[o+2]=c,this.data[o+3]=u)}}getData(){return this.data}},kl=class{constructor(t,e,s,n,r=null){this.canvas=t,this.config=e,this.configSchema=s,this.responsive=n,this.metrics=r,this.time=0,this.lastTime=0,this.setupWebGL(),this.setupUtilities(),this.setupPrograms(),this.particleSystem=new Pl(e.particleCount,e,n.aspectCorrection),this.setupBuffers(),this.resize(),this.currentFB=0}getScaledConfig(t){let e=this.config[t];return this.configSchema[t]?.scalesWithResolution?e*this.config.canvasResolutionMultiplier:e}setupWebGL(){if(this.gl=this.canvas.getContext("webgl2",{alpha:!1,preserveDrawingBuffer:!1})||this.canvas.getContext("webgl",{alpha:!1}),!this.gl)throw new Error("WebGL not supported")}setupUtilities(){let t=this.gl;this.shaderUtil=new ls(t),this.bufferUtil=new os(t),this.quad=new as(t),this.bloom=new cs(t),this.blur=new ps(t),this.chromatic=new us(t),this.grain=new hs(t)}setupPrograms(){let t=this.gl;this.programs={particle:this.shaderUtil.createProgram(Vt.particle.vertex,Vt.particle.fragment),attractor:this.shaderUtil.createProgram(Vt.attractor.vertex,Vt.attractor.fragment),texture:this.shaderUtil.createProgram(Vt.texture.vertex,Vt.texture.fragment),fade:this.shaderUtil.createProgram(Vt.fade.vertex,Vt.fade.fragment)},this.locations={particle:this.shaderUtil.getAllLocations(this.programs.particle),attractor:this.shaderUtil.getAllLocations(this.programs.attractor),texture:this.shaderUtil.getAllLocations(this.programs.texture),fade:this.shaderUtil.getAllLocations(this.programs.fade)}}setupBuffers(){let t=this.gl;this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,this.particleSystem.getData(),t.DYNAMIC_DRAW),this.attractorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.attractorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}setupFramebuffers(){this.trailBuffers&&this.bufferUtil.deletePingPongBuffers(this.trailBuffers),this.trailBuffers=this.bufferUtil.createPingPongBuffers(this.width,this.height),this.bufferUtil.clearFramebuffer(this.trailBuffers.fb1,[0,0,0,1]),this.bufferUtil.clearFramebuffer(this.trailBuffers.fb2,[0,0,0,1])}resize(){let t=this.gl;this.width=this.responsive.renderSize.width,this.height=this.responsive.renderSize.height,t.viewport(0,0,this.width,this.height),this.setupFramebuffers(),console.log(`Renderer resize: ${this.width}\xD7${this.height}`)}renderToFramebuffer(){let t=this.gl,e=this.currentFB?this.trailBuffers.tex2:this.trailBuffers.tex1,s=this.currentFB?this.trailBuffers.fb1:this.trailBuffers.fb2,n=this.currentFB?this.trailBuffers.tex1:this.trailBuffers.tex2;t.bindFramebuffer(t.FRAMEBUFFER,s),t.viewport(0,0,this.width,this.height),this._renderTrailFade(e),this._renderParticles(),this._renderAttractor();let r=this._applyPostProcessing(n);this.blurredTexture=r}_renderTrailFade(t){let e=this.gl;this.metrics&&this.metrics.beginPass("trail-fade"),e.disable(e.BLEND),e.useProgram(this.programs.fade),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(this.locations.fade.u_texture,0),e.uniform1f(this.locations.fade.u_fadeAmount,this.config.trailFade),this.quad.bind(this.locations.fade.a_position),e.drawArrays(e.TRIANGLES,0,6),this.metrics&&this.metrics.endPass("trail-fade")}_renderParticles(){let t=this.gl;this.metrics&&this.metrics.beginPass("particles"),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE),t.useProgram(this.programs.particle),this.shaderUtil.setUniforms(this.programs.particle,{u_size:this.getScaledConfig("particleSize"),u_baseHue:this.config.baseHue,u_hueRange:this.config.hueRange,u_saturation:this.config.saturation,u_lightness:this.config.lightness,u_velocityBrightness:this.config.velocityBrightness,u_fadeOutDistance:this.config.fadeOutDistance,u_colorMode:this.config.colorMode==="lifetime"?1:0}),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.particleSystem.getData());let e=this.locations.particle;t.enableVertexAttribArray(e.a_position),t.vertexAttribPointer(e.a_position,2,t.FLOAT,!1,24,0),t.enableVertexAttribArray(e.a_velocity),t.vertexAttribPointer(e.a_velocity,2,t.FLOAT,!1,24,8),t.enableVertexAttribArray(e.a_age),t.vertexAttribPointer(e.a_age,1,t.FLOAT,!1,24,16),t.enableVertexAttribArray(e.a_hueOffset),t.vertexAttribPointer(e.a_hueOffset,1,t.FLOAT,!1,24,20),t.drawArrays(t.POINTS,0,this.particleSystem.count),this.metrics&&this.metrics.endPass("particles")}_renderAttractor(){let t=this.gl;this.metrics&&this.metrics.beginPass("attractor"),t.disable(t.BLEND),t.useProgram(this.programs.attractor);let e=1+Math.sin(this.time*this.config.attractorPulseSpeed)*this.config.attractorPulseAmount;t.uniform1f(this.locations.attractor.u_size,this.config.attractorSize*e),t.uniform2f(this.locations.attractor.u_attractorPos,0,0),t.uniform1f(this.locations.attractor.u_aspect,this.width/this.height),t.bindBuffer(t.ARRAY_BUFFER,this.attractorBuffer),t.enableVertexAttribArray(this.locations.attractor.a_position),t.vertexAttribPointer(this.locations.attractor.a_position,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,6),this.metrics&&this.metrics.endPass("attractor")}_applyPostProcessing(t){let e=t;return this.metrics&&this.metrics.beginPass("bloom"),e=this.bloom.apply(e,this.width,this.height,{intensity:this.config.bloomIntensity,threshold:this.config.bloomThreshold,radius:this.config.bloomRadius,iterations:Math.round(this.config.bloomQuality)}),this.metrics&&this.metrics.endPass("bloom"),this.config.blurIntensity>0&&(this.metrics&&this.metrics.beginPass("blur"),e=this.blur.blur(e,this.width,this.height,this.getScaledConfig("blurRadius")*this.config.blurIntensity),this.metrics&&this.metrics.endPass("blur")),this.config.chromaticIntensity>0&&(this.metrics&&this.metrics.beginPass("chromatic"),e=this.chromatic.apply(e,this.width,this.height,{intensity:this.config.chromaticIntensity,radialAmount:this.config.chromaticRadial}),this.metrics&&this.metrics.endPass("chromatic")),this.config.grainIntensity>0&&(this.metrics&&this.metrics.beginPass("grain"),e=this.grain.apply(e,this.width,this.height,{intensity:this.config.grainIntensity,size:this.config.grainSize,colored:this.config.grainColored>.5,animated:!0,lumaSensitivity:this.config.grainLuma}),this.metrics&&this.metrics.endPass("grain")),e}renderToScreen(){let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.width,this.height),t.clearColor(...this.config.backgroundColor),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE),t.useProgram(this.programs.texture),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.blurredTexture),t.uniform1i(this.locations.texture.u_texture,0),this.quad.bind(this.locations.texture.a_position),t.drawArrays(t.TRIANGLES,0,6)}render(t){try{let e=this.lastTime?t-this.lastTime:.016;this.lastTime=t,this.time=t,this.metrics&&this.metrics.beginFrame(),this.particleSystem.update(e),this.renderToFramebuffer(),this.renderToScreen(),this.currentFB=1-this.currentFB,this.metrics&&this.metrics.endFrame()}catch(e){console.error("Render error:",e)}}captureFrame(){return this.render(performance.now()*.001),this.canvas.toDataURL("image/png;base64")}},Sl=class{constructor(t){this.renderer=t,this.modalTrigger=document.querySelector("[data-modal-trigger]"),this.modal=document.querySelector("[data-modal-state]"),this.downloadButton=document.querySelector("[data-download]"),this.modalTrigger&&this.modal&&this.modalTrigger.addEventListener("click",()=>this.toggleModal()),this.downloadButton&&this.downloadButton.addEventListener("click",()=>this.downloadFrame()),this.setupLazyLoad()}toggleModal(){let t=this.modal.getAttribute("data-modal-state")==="open";this.modal.classList.toggle("modal-open"),this.modalTrigger.classList.toggle("trigger-open",!t),this.modal.setAttribute("data-modal-state",t?"false":"open")}downloadFrame(){let t=this.renderer.captureFrame(),e=document.createElement("a");e.download=(Re.file_name||"canvas_animation")+".png",e.href=t,e.click()}setupLazyLoad(){document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-lazyload]").forEach(t=>{t.style.display="block"})})}},An=new bs(ds),ti=An.config,ih=document.getElementById(Re.canvas_id||"canvas"),ei=new vs(ih,{resolutionMultiplier:ti.canvasResolutionMultiplier});ei.init();(ei.device==="mobile"||ei.device==="tablet")&&(Object.keys(ms).forEach(i=>{ti[i]!==void 0&&(ti[i]=ms[i])}),console.log("Applied mobile defaults:",ms));var ii=new kl(ih,ti,ds,ei,null);ei.onResize=()=>ii.resize();if(Rn){let i=new fs(ii.gl,ti);ii.metrics=i}var Zu,es,Vl;Rn&&({pane:Zu,fpsGraph:es,pollMetrics:Vl}=Ju(Ds,yl,ti,ds,ii.metrics,ei,Re),An.setPaneRef(Zu),An.setupPasteListener(),An.setupKeyboardShortcuts());Rn&&new Sl(ii);var th=0,eh=1e3/(Re.max_fps||60);function sh(i){requestAnimationFrame(sh);let t=i-th;t<eh||(th=i-t%eh,es&&es.begin(),ii.render(i*.001),es&&es.end(),Vl&&Vl())}requestAnimationFrame(sh);

